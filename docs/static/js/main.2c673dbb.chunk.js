(this["webpackJsonpthump-web-client"]=this["webpackJsonpthump-web-client"]||[]).push([[0],{22:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"i",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"h",(function(){return u})),n.d(t,"g",(function(){return h})),n.d(t,"m",(function(){return d})),n.d(t,"j",(function(){return p})),n.d(t,"k",(function(){return f})),n.d(t,"l",(function(){return v})),n.d(t,"p",(function(){return m})),n.d(t,"n",(function(){return y})),n.d(t,"q",(function(){return b})),n.d(t,"o",(function(){return w}));var o="wss://thumpy.space/api",i="#",a="client/id";function s(e){return JSON.parse(e).clientId}var r="user/all",c="user/event",l="user/force",u="user/xform",h="user/request_xforms";function d(e){return JSON.parse(e)}function p(e){return JSON.parse(e)}function f(e){return JSON.parse(e)}function v(e){return JSON.parse(e)}function m(e){return"user/update"+i+JSON.stringify(e)}function y(e){return c+i+JSON.stringify(e)}function b(e){return u+i+JSON.stringify(e)}function w(){return h+i}},27:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return u})),n.d(t,"h",(function(){return h}));var o=n(22),i="clock/now",a="clock/origin",s="clock/update",r=32,c=34,l=function(){return i+o.b},u=function(e){return s+o.b+JSON.stringify(e)};function h(e){return JSON.parse(e)}},705:function(e,t,n){e.exports=n(706)},706:function(e,t,n){"use strict";n.r(t);var o=n(31),i=n.n(o),a=n(543),s=n.n(a);n(711);!function(){var e=n(737).default;s.a.render(i.a.createElement(e,null),document.getElementById("root"))}()},71:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));var o=n(0),i=n(1),a=n(27),s=function(){function t(e,n){var i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(o.a)(this,t),this.global=void 0,this.conn=void 0,this.localOrigin=void 0,this.correction=0,this.precision=0,this.correction2=0,this.precision2=0,this.lowpass=.3,this.lastReqAt=0,this.lastRespAt=0,this.loopId=-1,this.syncInitial=0,this.serverOrigin=0,this.precisionNow=0,this.pingMs=0,this.syncPeriod=500,this.synced=!1,this.options=void 0,this.update=function(){i.conn.readyState===WebSocket.OPEN?(i.lastReqAt=i.nowRaw(),i.conn.send(Object(a.f)())):i.global.clearTimeout(i.loopId)},this.destroy=function(){i.global.clearTimeout(i.loopId)},this.global=e,this.options=s,this.localOrigin=e.performance.timeOrigin,this.conn=n,this.loopId=e.setInterval(this.update,this.syncPeriod)}return Object(i.a)(t,[{key:"nowRaw",value:function(){return e.performance.now()}},{key:"onClockOrigin",value:function(e){var t=JSON.parse(e).originMs;t?this.serverOrigin=t:console.error("[workerClock #onClockOrigin] Received empty response")}},{key:"onClockNow",value:function(e){var t=(JSON.parse(e)||{}).nowMs;if(t){this.lastRespAt=this.nowRaw();var n=this.lastRespAt-this.lastReqAt;this.pingMs=n;var o=t-(n/2+this.lastReqAt);0===this.correction?this.correction=o:this.correction=o*this.lowpass+this.correction*(1-this.lowpass);var i=o-this.correction;0===this.precision?this.precision=i:this.precision=i*this.lowpass+this.precision*(1-this.lowpass),this.correction2=this.precision*this.lowpass+this.correction2*(1-this.lowpass);var a=o-this.correction-this.correction2;0===this.precision2?this.precision2=a:this.precision2=a*this.lowpass+this.precision2*(1-this.lowpass);var s=this.now()-n/2-t;this.precisionNow=s*this.lowpass+this.precisionNow*(1-this.lowpass),!this.synced&&this.syncInitial++>6&&(this.synced=!0,this.global.clearTimeout(this.loopId),this.correction+=this.correction2,this.syncPeriod=2e3,this.loopId=this.global.setInterval(this.update,this.syncPeriod),this.options.onSynced&&this.options.onSynced())}else console.error("[workerClock #onClockNow] Received empty response")}},{key:"now",value:function(){var e=this.nowRaw(),t=1+(e-this.lastRespAt)/this.syncPeriod;return e+this.correction+this.correction2*t}},{key:"toGlobal",value:function(e){return e+this.correction+this.correction2}},{key:"toLocal",value:function(e){return e-this.correction-this.correction2}}]),t}()}).call(this,n(729))},711:function(e,t,n){},728:function(e,t){},736:function(e,t,n){},737:function(e,t,n){"use strict";n.r(t);var o=n(31),i=n.n(o),a=n(10),s=n(0),r=n(9),c=n(6),l=n(3),u=n(2),h=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n),(e=t.call(this)).w=0,e.clone=function(){return new n(e.x,e.y,e.z)},e.cloneMult=function(t){return e.clone().applyMult(t)},e.cloneAdd=function(t){return e.clone().applyAdd(t)},e.cloneSub=function(t){return e.clone().applySub(t)},e.isZero=function(){return 0===e.x&&0===e.y&&0===e.z},e.isOne=function(){return 1===e.x&&1===e.y&&1===e.z},e.isEqual=function(t){return e.x===t.x&&e.y===t.y&&e.z===t.z},e.normalize=function(){return e.applyMult(1/e.mag())},e.toArray=function(){return[e.x,e.y,e.z]},e.setFromArray=function(t){return e.x=t.length>0?t[0]:0,e.y=t.length>1?t[1]:e.x,e.z=t.length>2?t[2]:2===t.length?0:e.x,Object(c.a)(e)},e.applyMult=function(t){return t instanceof n?(e.x*=t.x,e.y*=t.y,e.z*=t.z,Object(c.a)(e)):(e.x*=t,e.y*=t,e.z*=t,Object(c.a)(e))},e.applyAdd=function(t){return t instanceof n?(e.x+=t.x,e.y+=t.y,e.z+=t.z,Object(c.a)(e)):(e.x+=t,e.y+=t,e.z+=t,Object(c.a)(e))},e.applySub=function(t){return t instanceof n?(e.x-=t.x,e.y-=t.y,e.z-=t.z,Object(c.a)(e)):(e.x-=t,e.y-=t,e.z-=t,Object(c.a)(e))},e.cloneMultMat=function(t){if(!t.length||16!==t.length)return console.error("[Vec #applyMult] invalid matrix provided for mult",t),e.clone();var o=new n;return o.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12],o.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13],o.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14],o.w=t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15],Math.abs(o.w)>Number.EPSILON&&o.applyMult(1/o.w),o};for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return e.setFromArray(i),e}return n}(window.p5.Vector),d=function e(t,n){var o=this;Object(s.a)(this,e),this.min=new h(-1),this.max=new h(1),this.clone=function(){return new e(o.min.clone(),o.max.clone())},this.cloneXform=function(e){return o.clone().applyXform(e)},this.applyXform=function(e){return e.applyTo(o.min),e.applyTo(o.max),o.sanitize(),o},this.sanitize=function(){if(o.min.x>o.max.x){var e=o.min.x;o.min.x=o.max.x,o.max.x=e}if(o.min.y>o.max.y){var t=o.min.y;o.min.y=o.max.y,o.max.y=t}if(o.min.z>o.max.z){var n=o.min.z;o.min.z=o.max.z,o.max.z=n}return o},this.pushInside=function(e){var t=new h;return o.min.x<e.min.x?t.x=e.min.x-o.min.x:o.max.x>e.max.x&&(t.x=e.max.x-o.max.x),o.min.y<e.min.y?t.y=e.min.y-o.min.y:o.max.y>e.max.y&&(t.y=e.max.y-o.max.y),o.min.z<e.min.z?t.z=e.min.z-o.min.z:o.max.z>e.max.z&&(t.z=e.max.z-o.max.z),t},this.centerAndSize=function(){return{center:new h((o.max.x+o.min.x)/2,(o.max.y+o.min.y)/2,(o.max.z+o.min.z)/2),size:new h(o.max.x-o.min.x,o.max.y-o.min.y,o.max.z-o.min.z)}},t&&(this.min=t),n&&(this.max=n)},p=function e(t,n,o){var i=this;Object(s.a)(this,e),this.pos=void 0,this.rot=void 0,this.scale=void 0,this.applyTo=function(e){e.applyMult(i.scale),e.applyAdd(i.pos)},this.pos=t||new h,this.rot=n||new h,this.scale=o||new h(1)},f=n(1),v=function(){function e(t){Object(s.a)(this,e),this.parent=void 0,this.drawDebug=void 0,this.parent=t}return Object(f.a)(e,[{key:"destroy",value:function(){console.log("[Component] destroyed")}},{key:"update",value:function(e){console.warn("[Component] update")}}]),e}(),m=new function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.objs=[],this.debug=!1,this.lastUpdate=void 0,this.addObj=function(e){return t.objs.unshift(e)},this.rmObj=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.objs=t.objs.filter((function(t){return t!==e||(n&&t.destroy(),!1)}))},this.getObjs=function(e){return t.objs.filter((function(t){return t instanceof e}))},this.getObj=function(e){return t.getObjs(e)[0]},this.update=function(){if(t.lastUpdate){var e=(new Date).valueOf(),n=(e-t.lastUpdate)/1e3;t.lastUpdate=e,t.objs.forEach((function(e){return e.update(n)}))}else t.lastUpdate=(new Date).valueOf()},this.draw=function(e){var n,o=Object(a.a)(t.objs);try{for(o.s();!(n=o.n()).done;){var i=n.value;i.draw(e),i.drawShadow(e),t.debug&&i.drawDebug(e)}}catch(s){o.e(s)}finally{o.f()}},this.draw2D=function(e,n){var o,i=n,s=i._renderer.uMVMatrix.copy().mult(i._renderer.uPMatrix),r=Object(a.a)(t.objs);try{for(r.s();!(o=r.n()).done;){o.value.draw2D(e,n,s.mat4)}}catch(c){r.e(c)}finally{r.f()}},n.debug&&(this.debug=!0)}({debug:!1}),y=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.children=[],this.comps=[],this.xform=new p,this.parent=void 0,this.drawFunc=void 0,this.drawShadowFunc=void 0,this.drawFunc2D=void 0,this.destroy=function(){t.comps.forEach((function(e){return e.destroy()})),t.children.forEach((function(e){return e.destroy()}))},this.rm=function(){t.parent?t.parent.rmChild(t):m.rmObj(t)},this.addChild=function(e){m.rmObj(e,!1),e.parent=t,t.children.push(e)},this.rmChild=function(e){t.children=t.children.filter((function(t){return t!==e||(t.destroy(),!1)}))},this.getChildren=function(e){return t.children.filter((function(t){return t instanceof e}))},this.getChild=function(e){return t.getChildren(e)[0]},this.addComp=function(e){t.comps.push(e)},this.rmComp=function(e){t.comps=t.comps.filter((function(t){return t!==e||(t.destroy(),!1)}))},this.getComps=function(e){return t.comps.filter((function(t){return t instanceof e}))},this.getComp=function(e){return t.getComps(e)[0]},this.drawDebug=function(e){t.comps.forEach((function(t){return t.drawDebug&&t.drawDebug(e)}))},this.applyXformToGraphics=function(e){var n=t.xform,o=n.pos,i=n.rot,a=n.scale;o.isZero()||e.translate(o.x,o.y,o.z),0!==i.z&&e.rotateZ(i.z),0!==i.y&&e.rotateY(i.y),0!==i.x&&e.rotateX(i.x),a.isOne()||e.scale(a.x,a.y,a.z)},this.drawFunc=n.draw,this.drawFunc2D=n.draw2D,this.parent=n.parent,n.children&&(this.children=n.children),n.comps&&(this.comps=n.comps),n.pos&&(this.xform.pos=n.pos),n.rot&&(this.xform.rot=n.rot),n.scale&&(this.xform.scale=n.scale),m.addObj(this)}return Object(f.a)(e,[{key:"update",value:function(e){this.comps.forEach((function(t){return t.update(e)})),this.children.forEach((function(t){return t.update(e)}))}},{key:"draw",value:function(e){e.push(),this.applyXformToGraphics(e),this.drawFunc&&this.drawFunc(e),this.children.forEach((function(t){return t.draw(e)})),e.pop()}},{key:"drawShadow",value:function(e){e.push();var t=this.xform,n=t.pos,o=t.rot,i=t.scale;e.translate(n.x,0,n.z),0!==o.y&&e.rotateY(o.y),e.scale(i.x,1,i.z),this.drawShadowFunc&&this.drawShadowFunc(e),this.children.forEach((function(t){return t.drawShadow(e)})),e.pop()}},{key:"draw2D",value:function(e,t,n){if(this.children.forEach((function(o){return o.draw2D(e,t,n)})),this.drawFunc2D){var o=this.xform,i=o.pos,a=o.scale,s=i.cloneMultMat(n);if(!(s.w<0||s.x<-1.2||s.x>1.2||s.y<-1.2||s.y>1.2)){for(var r=i.cloneAdd(a).cloneMultMat(n),c=i.cloneAdd(a.cloneMult(new h(1,-1,-1))).cloneMultMat(n),l=i.cloneAdd(a.cloneMult(new h(-1,-1,1))).cloneMultMat(n),u=0,d=[s,r,c,l];u<d.length;u++){var p=d[u];p.x=(p.x+1)*e.width/2,p.y=(1-p.y)*e.height/2,p.z=0}var f=Math.max(s.cloneSub(r).mag(),s.cloneSub(c).mag(),s.cloneSub(l).mag());e.push(),this.drawFunc2D(e,s,f),e.pop()}}}}]),e}(),b=new h(0,-9.82,0),w=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,n),(o=t.call(this,e)).force=new h,o.vel=new h,o.bounds=void 0,o.world=void 0,o.update=function(e){o.vel.applyAdd(b.cloneAdd(o.force).applyMult(e)),o.vel.applyMult(new h(.8,1,.8)),o.vel.magSq()<.01&&o.vel.applyMult(0);var t=o.parent.xform.pos;t.applyAdd(o.vel);var n=o.worldBounds().pushInside(o.world);n.isZero()||(t.applyAdd(n),0!==n.x&&(o.vel.x*=-.5),0!==n.y&&(o.vel.y*=-.5),0!==n.z&&(o.vel.z*=-.5))},o.drawDebug=function(e){var t=o.worldBounds().centerAndSize(),n=t.center,i=t.size;e.push(),e.noFill(),e.stroke(255,0,0),e.strokeWeight(1),e.translate(n.x,n.y,n.z),e.box(i.x,i.y,i.z),e.pop()},o.worldBounds=function(){return o.bounds.cloneXform(o.parent.xform)},o.bounds=i.bounds?i.bounds:new d,i.worldScale||(i.worldScale=1e3),o.world=new d(new h(-i.worldScale,0,-i.worldScale),new h(i.worldScale,i.worldScale,i.worldScale)),o}return n}(v),g=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e,o){var i;return Object(s.a)(this,n),(i=t.call(this,e)).cam=void 0,i.last=void 0,i.update=function(e){if(i.cam.state&&i.cam.state.center){var t=i.parent.xform.pos,n=t.x,o=t.y,a=t.z;i.cam.setCenter([n,o,a],0)}},i.cam=o,i}return n}(v),k=n(5),x=n(4),O=n(68),S=n.n(O),M={attack:"0:0.25:0",attackCurve:"linear",decay:"0:0.5:0",decayCurve:"linear",sustain:1,release:"0:0.5:0",releaseCurve:"linear"},C=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).envs={dip:new r.Envelope(M),stepLeft:new r.Envelope(M),stepRight:new r.Envelope(M),spinLeft:new r.Envelope(M),spinRight:new r.Envelope(M),headbang:new r.Envelope(M),armsLUpperY:new r.Envelope(M),armsLUpperZ:new r.Envelope(M),armsLLowerX:new r.Envelope(M),armsRUpperY:new r.Envelope(M),armsRUpperZ:new r.Envelope(M),armsRLowerX:new r.Envelope(M)},e.update=function(t){var n=e.parent,o=Object(c.a)(e).envs;n.xform.pos.y=-o.dip.value*A.leg.y*.8,n.stepLeftRight=.7*(o.stepRight.value-o.stepLeft.value),(n.parent||n).xform.rot.y+=20*t*(o.spinRight.value-o.spinLeft.value),n.rotHead.x=o.headbang.value*Math.PI/4,n.rotArms.l.upper.y=Math.PI*(.4-.7*o.armsLUpperY.value),n.rotArms.r.upper.y=Math.PI*(.4-.7*o.armsRUpperY.value),n.rotArms.l.upper.z=Math.PI*(1.1+o.armsLUpperZ.value),n.rotArms.r.upper.z=Math.PI*(1.1+o.armsRUpperZ.value),n.rotArms.l.lower.x=Math.PI*(.1+.7*o.armsLLowerX.value),n.rotArms.r.lower.x=Math.PI*(.1+.7*o.armsRLowerX.value)},e.noteEnvMap={0:e.envs.dip,1:e.envs.spinLeft,2:e.envs.headbang,3:e.envs.spinRight,4:e.envs.stepLeft,5:e.envs.stepRight,6:e.envs.armsLUpperZ,7:e.envs.armsRUpperZ,8:e.envs.armsLLowerX,9:e.envs.armsRLowerX,10:e.envs.armsLUpperY,11:e.envs.armsRUpperY},e.noteEvent=function(t,n){var o=n.kind,i=n.note,a=n.attack,s=e.noteEnvMap[i%12];"noteon"===o?s.triggerAttack(t,a):s.triggerRelease(t)},e.handleADSR=function(t){for(var n in e.envs){e.envs[n].set(t)}},e}return n}(v),A={leg:new h(.1,.5,.1),armUpper:new h(.1,.3,.1),armLower:new h(.1,.3,.1),body:new h(.4),neck:new h(.05),head:new h(.25)},I=function(){return{upper:new h(0,.4*Math.PI,1.1*Math.PI),lower:new h(.1*Math.PI,0,0)}},R=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,n),(e=t.call(this,o)).moves=void 0,e.rotHead=new h,e.rotArms={l:I(),r:I()},e.stepLeftRight=0,e.vol=.5,e.colors={stroke:{hue:0,sat:0,lgt:.9},body:{hue:0,sat:0,lgt:0},head:{hue:0,sat:0,lgt:0},armUpper:{hue:0,sat:0,lgt:0},armLower:{hue:0,sat:0,lgt:0},hand:{hue:0,sat:0,lgt:0}},e.noteEvent=function(t,n){n.attack&&(n.attack*=2*e.vol),e.moves.noteEvent(t,n)},e.handleCC=function(t){var n=t.evt,o=t.ctrls,i=t.localUser,a=t.time;if(n){i&&(o.controlchangeNext(n),r.Draw.schedule((function(){return o.controlchange(n)}),a));var s=o.getSliderForCtrl(n.controller.number);if(s){var c="0:"+n.value+":0";switch(s.label){case"vol":e.vol=n.value;break;case"mod":r.Draw.schedule((function(){return e.handleModwheel(n.value)}),a);break;case"a":e.moves.handleADSR({attack:c});break;case"d":e.moves.handleADSR({decay:c});break;case"s":e.moves.handleADSR({sustain:n.value});break;case"r":e.moves.handleADSR({release:c})}}else console.log("[DancerObj #handleCC] Unable to find control for CC event",t)}else console.log("[DancerObj #handleCC] Received CC call with missing info",t)},e.handleModwheel=function(t){var n=S()("".concat(t));for(var o in e.colors){var i=e.colors[o];i.hue=n.quick(),i.sat=t?.7*n.quick()+.3:0,i.lgt=.7*t,"stroke"===o&&(i.lgt=.9-i.lgt)}},e.setFill=function(t,n){var o=e.colors[n];t.fill(o.hue,o.sat,o.lgt)},e.drawFunc=function(t){var n=A.leg,o=A.body,i=e.colors.stroke;t.colorMode(t.HSL,1),t.stroke(i.hue,i.sat,i.lgt).strokeWeight(2),t.translate(e.stepLeftRight,-1+n.y+o.y,0),e.setFill(t,"body"),t.sphere(A.body.y,7,4),e.setFill(t,"head"),e.drawHead(t),e.drawArm(t,!0),e.drawArm(t,!1)},e.drawHead=function(t){var n=A.body,o=A.neck,i=A.head;t.push(),t.rotateX(e.rotHead.x),t.push(),t.translate(0,n.y+o.y+i.y,0),t.box(1.8*i.y,1.8*i.y,1.8*i.y),t.pop(),t.pop()},e.drawArm=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=A.body,i=A.armUpper,a=A.armLower,s=n?e.rotArms.l:e.rotArms.r;t.push(),n&&t.scale(-1,1,1),t.translate(o.x,.8*o.y,0),t.rotateZ(s.upper.z).rotateY(s.upper.y),t.translate(0,i.y/2,0),e.setFill(t,"armUpper"),t.box(i.x,i.y,i.z),t.translate(0,.025+i.y/2,0),t.rotateX(s.lower.x),t.translate(0,.025+a.y/2,0),e.setFill(t,"armLower"),t.box(a.x,a.y,a.z),t.translate(0,.05+a.y/2+a.x/2,0),e.setFill(t,"hand"),t.box(a.x,a.x,a.x),t.pop()},e.drawShadowFunc=function(t){t.push(),t.fill(30).noStroke(),t.rotateX(Math.PI/2),t.circle(e.stepLeftRight,0,2*A.body.x),t.pop()},e.moves=new C(Object(c.a)(e)),e.addComp(e.moves),e}return n}(y),j=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).phys=void 0,o.user=void 0,o.followCam=void 0,o.onForce=void 0,o.dancer=void 0,o.facing=void 0,o.keys={up:!1,down:!1,left:!1,right:!1,jump:!1,jumpInitial:!1,gain:100},o.drawFunc2D=function(e,t,n){var i=o.user,a=i.name,s=i.instrument,r=i.offset;if(!(n<15)){var c=Math.min(n,50),l=Math.min(n,200);e.translate(t.x,t.y),e.textAlign(e.CENTER,e.BOTTOM),e.fill(255),e.noStroke(),e.textSize(c/2),e.textStyle(e.BOLD),n<35?e.text(a,0,.8*-c):(e.text(a,0,.8*-l),e.fill(225),e.textSize(.3*c),e.textStyle(e.ITALIC),e.text("".concat(s," (@").concat(r>0?"+":"").concat(r,")"),0,.8*-l+.35*c))}},o.addFollowCam=function(e){o.followCam=new g(Object(c.a)(o),e),o.followCam.update(0),o.addComp(o.followCam)},o.getUserXform=function(){return{clientId:o.user.clientId,pos:o.xform.pos.toArray(),rot:o.xform.rot.toArray(),scale:o.xform.scale.toArray(),force:o.phys.force.toArray(),vel:o.phys.vel.toArray()}},o.setUserXform=function(e){o.xform.pos.setFromArray(e.pos),o.xform.rot.setFromArray(e.rot),o.xform.scale.setFromArray(e.scale),o.phys.force.setFromArray(e.force),o.phys.vel.setFromArray(e.vel)},o.setUserForce=function(e){o.phys.force.setFromArray(e.force)},o.keyPressed=function(e){return o.keyChanged(e,!0)},o.keyReleased=function(e){return o.keyChanged(e,!1)},o.keyChanged=function(e,t){switch(e.key){case"ArrowUp":o.keys.up=t;break;case"ArrowDown":o.keys.down=t;break;case"ArrowLeft":o.keys.left=t;break;case"ArrowRight":o.keys.right=t;break;case" ":o.keys.jump=t,o.keys.jumpInitial=t;break;default:return}o.keysUpdated()},o.keysUpdated=function(){var e=o.keys,t=e.up,n=e.down,i=e.left,a=e.right,s=e.jump,r=e.jumpInitial,c=e.gain,l=new h;if(l.x=i&&a?0:i?-c:a?c:0,l.y=r&&o.xform.pos.y<1.5*o.xform.scale.y?3*c:s?6:0,l.z=n&&t?0:t?c:n?-c:0,!o.followCam)return o.phys.force=l,void(o.onForce&&o.onForce(o.getUserXform()));var u=o.followCam.cam.centerAxes(),d=new h(u.x[0],0,u.x[2]),p=new h(u.z[0],0,u.z[2]),f=new h(0,l.y,0);f.applyAdd(d.applyMult(l.x)),f.applyAdd(p.applyMult(l.z)),o.phys.force=f,0===f.x&&0===f.z||(o.xform.rot.y=Math.atan2(f.x,f.z),o.facing=f.clone().normalize()),o.onForce&&o.onForce(o.getUserXform())},o.user=e.user,o.phys=new w(Object(c.a)(o),e.phys),o.comps=[o.phys],o.onForce=e.onForce,o.dancer=new R,o.facing=new h(0,0,-1),o.addChild(o.dancer),console.log("[Avatar] ctor",Object(c.a)(o)),o}return Object(f.a)(n,[{key:"update",value:function(e){Object(k.a)(Object(x.a)(n.prototype),"update",this).call(this,e),this.keys.jumpInitial&&(this.keys.jumpInitial=!1,this.keysUpdated())}}]),n}(y),L=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).origin2D=new h,e.scale2D=1,e}return Object(f.a)(n,[{key:"draw",value:function(e){if(De&&De.shaderBlackHole&&De.backbuffer){var t=De.instruments.blackHole;e.shader(De.shaderBlackHole),De.shaderBlackHole.setUniform("backbuffer",De.backbuffer),De.shaderBlackHole.setUniform("size",[e.width,e.height]),De.shaderBlackHole.setUniform("rotate",t.modwheel*Math.PI)}e.fill(0,0).noStroke(),Object(k.a)(Object(x.a)(n.prototype),"draw",this).call(this,e),e.resetShader()}}]),n}(y),T=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).hue=0,e.sat=0,e.lgt=.25,e.drawFunc=function(t){t.colorMode(t.HSL,1).noFill().strokeWeight(4).stroke(e.hue,e.sat,.25),t.rotateX(Math.PI/2),t.rect(-1,-1,2,2);var n=.05;t.rect(-n,-n,.1,.1),t.rect(-.55,-.55,.1,.1),t.rect(.45,-.55,.1,.1),t.rect(.45,.45,.1,.1),t.rect(-.55,.45,.1,.1)},e}return n}(y),D=[1,3,6,8,10],N=n(14),P=n(22),U=n(27),E=n(71),F=function e(t,n){var o=this;Object(s.a)(this,e),this.conn=void 0,this.clock=void 0,this.global=void 0,this.options=void 0,this.clientId=0,this.users=[],this.reopen=function(){o.conn.readyState===WebSocket.CLOSED&&(o.conn=o.newConn())},this.ready=function(){return o.conn&&o.conn.readyState===WebSocket.OPEN},this.newConn=function(){var e=new WebSocket(P.c);return e.onclose=function(e){888!==e.code?(console.warn("WebSocket closed, will attempt to reopen in a few seconds",e),setTimeout(o.reopen,5e3)):console.warn("Closing for good",e)},e.onopen=function(e){console.log("WebSocket opened",e),o.clock.destroy(),o.clock=new E.a(o.global,o.conn,o.options.clock)},e.onerror=function(e){console.error("WebSocket error",e)},e.onmessage=o.onMessage,e},this.onMessage=function(e){var t=function(e,t,n){var o=[],i=new RegExp(t,"g");for(;n--;){var a=i.lastIndex,s=i.exec(e);if(!s)break;o.push(e.slice(a,s.index))}return o.push(e.slice(i.lastIndex)),o}(e.data,P.b,1),n=Object(N.a)(t,2),i=n[0],a=n[1];switch(i){case U.c:case U.d:if(!o.clock)return void console.error("[WSClient #onMessage] No local clock ready to handle server clock message");i===U.d?o.clock.onClockOrigin(a):o.clock.onClockNow(a);break;case U.e:var s=Object(U.h)(a);o.options.onClockUpdate(s),console.log("[WSClient #onMessage] Received clockUpdate",s);break;case P.a:o.clientId=Object(P.i)(a),console.log("[WSClient #onMessage] Received clientId",o.clientId),o.options.onClientId(o.clientId);break;case P.d:o.users=Object(P.m)(a).filter((function(e){return!!e})),o.options.onUsers(o.users);break;case P.e:var r=Object(P.j)(a);o.options.onUserEvent(r);break;case P.f:var c=Object(P.k)(a);o.options.onUserForce(c);break;case P.h:var l=Object(P.l)(a);o.options.onUserXform(l);break;case P.g:console.log("[WSClient #onMessage] Received Xform request"),o.options.onUserRequestXforms();break;default:console.log("[WSClient #onMessage] Unhandled message",{head:i,body:a,parts:t},e)}},this.now=function(){return o.clock?o.clock.now():(console.error("[WSClient #now] No clock!"),-1)},this.getUser=function(e){var t,n=Object(a.a)(o.users);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.clientId===e)return i}}catch(s){n.e(s)}finally{n.f()}},this.global=t,this.options=n,this.conn=this.newConn(),this.clock=new E.a(this.global,this.conn,this.options.clock)};var z=n(7),_=n.n(z),H=n(11),V=n(13);function B(e){return{data:e.data,channel:e.target.number,kind:e.type,attack:e.attack,note:e.note&&e.note._number,release:e.release,value:e.value,controller:e.controller}}var X=Object(V.a)(Array(16).keys()).map((function(e){return e+1})),W=["controlchange","noteoff","noteon","pitchbend"],q=function e(t){var n=this;Object(s.a)(this,e),this.webMidi=null,this.enabled=!1,this.enable=function(){var e=Object(H.a)(_.a.mark((function e(t){var o,i,s,r,c,l,u,h,d,p;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.onMessage,i=t.onEnabled,s=window,r=s.WebMidi,e.prev=2,e.next=5,r.enable();case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),console.error("[MIDI #enable] Failed to enable MIDI",e.t0),e.abrupt("return");case 11:n.webMidi=r,n.enabled=!0,c=n.webMidi,l=c.inputs,u=c.outputs,console.log("[MIDI #enable] inputs",l),console.log("[MIDI #enable] outputs",u),i&&i(n.webMidi),h=Object(a.a)(l);try{for(p=function(){var e,t=d.value,n=Object(a.a)(W);try{var i=function(){var n=e.value;t.addListener(n,(function(e){return o(t.name,n,B(e))}),{channels:X})};for(n.s();!(e=n.n()).done;)i()}catch(s){n.e(s)}finally{n.f()}},h.s();!(d=h.n()).done;)p()}catch(f){h.e(f)}finally{h.f()}case 19:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),this.enable(t)};function G(e){return r.Frequency(e,"midi").toFrequency()}var Y=function(){return 2*Math.random()-1},Z=function(){return new h(Y(),Y(),Y())},J={},K=function(e){if(J[e])return{hue:J[e],sat:.8,lgt:.4};var t=e;switch(e){case"21":t="21###";break;case"22":t="22&$&";break;case"73":t="73##";break;case"77":t="77#"}return J[e]=S()(t).quick(),{hue:J[e],sat:.8,lgt:.4}},Q=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sliders:[]};Object(s.a)(this,e),this.sliders=void 0,this.update=function(e){var n,o=Object(a.a)(t.sliders);try{for(o.s();!(n=o.n()).done;){n.value.update(e)}}catch(i){o.e(i)}finally{o.f()}},this.draw=function(e){e.push();var n,o=t.sliders,i=30,s=Object(a.a)(o);try{for(s.s();!(n=s.n()).done;){var r=n.value;r.xx=i,r.draw(e),i+=r.width,["ff","a","d","s"].includes(r.label)||(["pb","pan"].includes(r.label)?i+=r.width/2:i+=r.width)}}catch(c){s.e(c)}finally{s.f()}e.pop()},this.mousePressed=function(e){var n,o=(De.cam||{}).mouse,i=Object(a.a)(t.sliders);try{for(i.s();!(n=i.n()).done;){if(n.value.mousePressed(e.mouseX,e.mouseY))return o&&(o.ismousedown=!1),!0}}catch(s){i.e(s)}finally{i.f()}return!1},this.mouseReleased=function(e){t.sliders.forEach((function(e){return e.mouseReleased()}))},this.controlchangeNext=function(e){var n=t.getSliderForCtrl(e.controller.number);return n&&!n.pressed&&(n.valueNext=e.value),n},this.controlchange=function(e){var n=t.getSliderForCtrl(e.controller.number);return n&&(n.value.value=e.value),n},this.pitchbendNext=function(e){var n=t.getSliderForPitchbend();return n&&!n.pressed&&(n.valueNext=e.value),n},this.pitchbend=function(e){var n=t.getSliderForPitchbend();return n&&(n.value.value=e.value),n},this.getSliderForLabel=function(e){return t.sliders.filter((function(t){return t.label===e}))[0]},this.getSliderForCtrl=function(e){return t.sliders.filter((function(t){return t.ctrl===e}))[0]},this.getSliderForPitchbend=function(){return t.sliders.filter((function(e){return e.pitchbend}))[0]},this.sliders=n.sliders},$=function(){function e(t){Object(s.a)(this,e),this.height=150,this.width=20,this.value=new r.Signal(0),this.valueNext=0,this.strokeWeight=4,this.xx=40,this.yy=100,this.pressed=!1,this.label=void 0,this.ctrl=void 0,this.pitchbend=void 0,this._wasPressed=!1,this._ee=0,this.valueLastSent=0,this.label=t.label,this.ctrl=t.ctrl,t.value&&this.set(t.value),this.pitchbend=!!t.pitchbend}return Object(f.a)(e,[{key:"update",value:function(e){if(!this.pressed)return this.pitchbend&&this._wasPressed&&(this.valueNext=0,this.sendValue()),void(this._wasPressed=!1);this._wasPressed=!0,this.setValueNext(e.mouseY)}},{key:"draw",value:function(e){e.colorMode(e.HSL,1),e.fill(0,0,.1).stroke(0,0,.7).strokeWeight(this.strokeWeight),e.rect(this.xx,this.yy,this.width,this.height);var t=K("".concat(this.ctrl));e.fill(t.hue,.3*t.sat,t.lgt).noStroke(),this.drawVal(e,this.valueNext),e.fill(t.hue,t.sat,t.lgt).noStroke(),this.drawVal(e,this.value.value),e.fill(0,0,.8).stroke(0).strokeWeight(1),e.textSize(10).textAlign(e.CENTER,e.TOP).textStyle(e.BOLD),e.text(this.label.toUpperCase(),this.xx+this.width/2,this.yy+this.height+5)}},{key:"drawVal",value:function(e,t){var n=this.width-this.strokeWeight,o=this.xx+this.strokeWeight/2;e.square(o,this.valueY(t),n)}},{key:"mousePressed",value:function(e,t){return!(e<this.xx||e>this.xx+this.width)&&(!(t<this.yy||t>this.yy+this.height)&&(this.setValueNext(t),this.pressed=!0,!0))}},{key:"mouseReleased",value:function(){this.pressed=!1}},{key:"setValueNext",value:function(e){var t=1-(e-(this.yy+this.width/2))/(this.height-this.width-this.strokeWeight/2);this.pitchbend?this.valueNext=Math.max(-1,Math.min(1,2*t-1)):this.valueNext=Math.max(0,Math.min(1,t)),this.sendValue()}},{key:"sendValue",value:function(){if(this.valueNext!==this.valueLastSent){this.valueLastSent=this.valueNext;var e={kind:this.pitchbend?"pitchbend":"controlchange",controller:this.pitchbend?void 0:{number:this.ctrl,name:this.label},value:this.valueNext};De.sendUserEvent("keyboard",e.kind,e)}}},{key:"valueY",value:function(e){var t=this.yy+this.width/2,n=this.height-this.width;return(1-(this.pitchbend?e/2+.5:e))*n+t-this.width/2+this.strokeWeight/2}},{key:"set",value:function(e){this.value.value=e,this.pressed||(this.valueNext=e)}}]),e}(),ee=function(){function e(){var t=this;Object(s.a)(this,e),this.ctrls=new Q({sliders:[new $({label:"pb",ctrl:-1,pitchbend:!0}),new $({label:"mod",ctrl:1,value:0}),new $({label:"ff",ctrl:21,value:.67}),new $({label:"fq",ctrl:22,value:0}),new $({label:"a",ctrl:71,value:.05}),new $({label:"d",ctrl:72,value:.1}),new $({label:"s",ctrl:73,value:1}),new $({label:"r",ctrl:74,value:.4}),new $({label:"pan",ctrl:27,value:.5}),new $({label:"vol",ctrl:28,value:.857})]}),this.panVol=void 0,this.handleDetune=void 0,this.handleModwheel=void 0,this.handleFilter=void 0,this.handleADSR=void 0,this.handlePitchbend=function(e){if(t.handleDetune){var n=e.evt,o=e.slider;o?t.handleDetune(o.value.value):n&&t.handleDetune(n.value)}}}return Object(f.a)(e,[{key:"loaded",value:function(){return!1}},{key:"noteon",value:function(e,t,n){}},{key:"noteoff",value:function(e,t,n){}},{key:"controlchange",value:function(e,t,n){var o=this;this.ctrls.controlchangeNext(n),r.Draw.schedule((function(){var t=o.ctrls.controlchange(n),i={avatar:e,evt:n,slider:t};o.handleCC(i)}),t)}},{key:"pitchbend",value:function(e,t,n){var o=this;this.ctrls.pitchbendNext(n),r.Draw.schedule((function(){var t=o.ctrls.pitchbend(n),i={avatar:e,evt:n,slider:t};o.handlePitchbend(i)}),t)}},{key:"handleCC",value:function(e){var t=e.slider;if(t){var n=t.label;if(t.pitchbend)this.handlePitchbend&&this.handlePitchbend(e);else{var o=t.value.value;if("mod"!==n)if(["ff","fq"].includes(n))this.handleFilter&&("ff"===n?this.handleFilter({frequency:Math.pow(10,3*o+1)}):this.handleFilter({Q:o*o*8}));else if(["a","d","s","r"].includes(n)){if(!this.handleADSR)return;switch(["a","d","r"].includes(n)?o=10*o*o*o*o+1e-4:o*=o,n){case"a":this.handleADSR({attack:o});break;case"d":this.handleADSR({decay:o});break;case"s":this.handleADSR({sustain:o});break;case"r":this.handleADSR({release:o})}}else"vol"!==n?"pan"!==n||this.panVol&&this.panVol.set({pan:2*o-1}):this.panVol&&(this.panVol.mute=!o,this.panVol.set({volume:70*o-60}));else this.handleModwheel&&this.handleModwheel(o)}}}}]),e}(),te=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n),(e=t.call(this)).panVol=void 0,e.reverb=void 0,e.filter=void 0,e.synth=void 0,e.freqNode=new r.Add,e.freq=new r.Signal(440),e.noiseGain=void 0,e.noise=void 0,e.modwheel=.3,e.ps=0,e.psSpread=7,e.objs=[],e.maxObjs=32,e.ii=0,e._attacks=0,e.noteon=function(t,n,o){var i=G(o.note);try{e._attacks?e.freq.exponentialRampToValueAtTime(i,n):(e.freq.setValueAtTime(i,n),e.synth.triggerAttack(i,n,o.attack))}catch(a){}e._attacks++,r.Draw.schedule((function(){return e.addBHObj(t,o)}),n)},e.noteoff=function(t,n,o){e._attacks=Math.max(0,e._attacks-1),e._attacks||e.synth.triggerRelease(n)},e.handleDetune=function(t){e.ps=t,e.synth.set({detune:100*t*e.psSpread})},e.handleModwheel=function(t){e.modwheel=t;var n=t*t;e.noiseGain.set({gain:n*e.freq.value*3})},e.handleFilter=function(t){return e.filter.set(t)},e.handleADSR=function(t){return e.synth.set({envelope:t})},e.lastPos={},e.addBHObj=function(t,n){var o=De.blackHole;if(o){var i=Object(c.a)(e),s=i.objs,r=i.maxObjs,l=t.user.clientId,u=t.xform.pos;e.lastPos[l]&&(u=e.lastPos[l]);var d=new h(Y(),Math.random(),Y()).applyMult(78);if(u=u.cloneAdd(d),e.ii++%16===0||u.y>1e3){var p,f=Object(a.a)(s);try{for(f.s();!(p=f.n()).done;){p.value.xform.scale.applyMult(.8)}}catch(S){f.e(S)}finally{f.f()}var v=t.facing,m=t.xform,y=m.pos,b=m.scale,w=Math.random()*Math.PI*2,g=v.cloneMult(520);u.x=y.x+g.x+3*b.x*Math.sin(w),u.y=y.y,u.z=y.z+g.z+3*b.x*Math.cos(w)}e.lastPos[l]=u;var k=new h(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),x=u.y/1e3;x*=x*x*10*130;var O=new ne(Object(c.a)(e),{noteEvt:n,pos:u,rot:k,scale:new h(91+x),twist:e.modwheel*e.modwheel,mass:n.attack||.7});s.unshift(O),o.addChild(O),s.length>r&&(o.rmChild(s[s.length-1]),e.objs=s.slice(0,r))}},e.panVol=new r.PanVol(0,0).toDestination(),e.reverb=new r.Reverb({decay:4,wet:.6}).connect(e.panVol),e.filter=new r.Filter({type:"lowpass"}).connect(e.reverb);var o=new r.PingPongDelay({delayTime:"4n",feedback:.6,wet:.3}).connect(e.filter);e.synth=(new r.Synth).connect(o),e.freqNode.connect(e.synth.frequency),e.freq.connect(e.freqNode),e.noiseGain=new r.Gain(100).connect(e.freqNode.addend),e.noise=new r.Noise({volume:0,playbackRate:.5,type:"brown"}).start().connect(e.noiseGain);var i,l=Object(a.a)(e.ctrls.sliders);try{for(l.s();!(i=l.n()).done;){var u=i.value;switch(u.label){case"mod":u.set(.3);break;case"ff":u.set(.9);break;case"fq":u.set(.25);break;case"a":u.set(.1);break;case"d":u.set(.3);break;case"s":u.set(.66);break;case"r":u.set(.6)}}}catch(v){l.e(v)}finally{l.f()}var d,p=Object(a.a)(e.ctrls.sliders);try{for(p.s();!(d=p.n()).done;){var f=d.value;e.handleCC({slider:f})}}catch(v){p.e(v)}finally{p.f()}return e}return Object(f.a)(n,[{key:"loaded",value:function(){return!0}},{key:"handleCC",value:function(e){Object(k.a)(Object(x.a)(n.prototype),"handleCC",this).call(this,e);var t=e.evt;if(t){var o=t.controller.number,i=t.value*t.value;switch(!0){case 23===o:this.noise.set({playbackRate:2*i});break;case 24===o:this.synth.set({portamento:2*i})}}}}]),n}(ee),ne=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e,o){var i;return Object(s.a)(this,n),(i=t.call(this,o)).inst=void 0,i.createdAt=void 0,i.noteEvt=void 0,i.scaleOrig=void 0,i.voice=null,i.hue=Math.random(),i.mass=void 0,i.twist=0,i.update=function(e){var t=1-i.inst.modwheel;t=1-t*t,i.xform.rot.applyAdd(Z().applyMult(e*t))},i.origin2D=new h,i.scale2D=1,i.drawFunc=function(e){De.shaderBlackHole&&(De.shaderBlackHole.setUniform("origin",[i.origin2D.x/e.width,i.origin2D.y/e.height]),De.shaderBlackHole.setUniform("scale",i.scale2D/e.width),De.shaderBlackHole.setUniform("rotate",i.twist*Math.PI),De.shaderBlackHole.setUniform("mass",i.mass)),e.sphere(1,3,4)},i.drawFunc2D=function(e,t,n){i.origin2D=t,i.scale2D=Math.min(2*e.height,n)},i.inst=e,i.createdAt=(new Date).valueOf()/1e3,i.noteEvt=o.noteEvt,i.scaleOrig=i.xform.scale.clone(),i.mass=1-o.mass,i.mass=1-i.mass*i.mass,o.twist&&(i.twist=Math.random()>.5?o.twist:-o.twist),i}return n}(y),oe=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(s.a)(this,n),(e=t.call(this)).lr=-1,e.noteon=function(e,t,n){e.dancer.noteEvent(t,n)},e.noteoff=function(e,t,n){e.dancer.noteEvent(t,n)},e.ctrls.sliders=[new $({label:"mod",ctrl:1,value:0}),new $({label:"a",ctrl:71,value:.25}),new $({label:"d",ctrl:72,value:.25}),new $({label:"s",ctrl:73,value:1}),new $({label:"r",ctrl:74,value:.5}),new $({label:"vol",ctrl:28,value:.5})],e}return Object(f.a)(n,[{key:"loaded",value:function(){return!0}},{key:"controlchange",value:function(e,t,n){e.dancer.handleCC({evt:n,ctrls:this.ctrls,localUser:e===De.avatar,time:t})}}]),n}(ee),ie=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var o;Object(s.a)(this,n),(o=t.call(this)).panVol=void 0,o.filter=void 0,o.pitchShift=void 0,o.sampler=void 0,o.ps=0,o.psSpread=7,o.noteon=function(e,t,n){o.sampler.triggerAttack(G(n.note),t,n.attack)},o.noteoff=function(e,t,n){o.sampler.triggerRelease(G(n.note),t)},o.handleDetune=function(e){o.ps=e,o.pitchShift.pitch=o.ps*o.psSpread},o.handleModwheel=function(e){var t=o.ctrls.getSliderForLabel("ff");t&&(t.set(e),o.handleCC({slider:t}));var n=o.ctrls.getSliderForLabel("fq");if(n){var i=Math.sin(e*Math.PI),a=1-e;a=1-a*a*a,n.set(.2*i+0+.2*a),o.handleCC({slider:n})}},o.handleFilter=function(e){return o.filter.set(e)},o.panVol=new r.PanVol(0,0).toDestination(),o.filter=new r.Filter({type:"bandpass"}).connect(o.panVol),o.pitchShift=(new r.PitchShift).connect(o.filter),o.sampler=e.connect(o.pitchShift),o.ctrls.sliders=[new $({label:"pb",ctrl:-1,pitchbend:!0}),new $({label:"mod",ctrl:1,value:0}),new $({label:"ff",ctrl:21,value:.67}),new $({label:"fq",ctrl:22,value:0}),new $({label:"pan",ctrl:27,value:.5}),new $({label:"vol",ctrl:28,value:.857})];var i,c=Object(a.a)(o.ctrls.sliders);try{for(c.s();!(i=c.n()).done;){var l=i.value;o.handleCC({slider:l})}}catch(u){c.e(u)}finally{c.f()}return o}return Object(f.a)(n,[{key:"loaded",value:function(){return this.sampler.loaded}}]),n}(ee),ae=["BD0010.WAV","BD0050.WAV","SD7510.WAV","CP.WAV","CH.WAV","OH10.WAV","LT00.WAV","MT00.WAV","HT00.WAV","LC00.WAV","MC00.WAV","HC00.WAV","CB.WAV","CY0075.WAV","MA.WAV","RS.WAV"];var se=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,function(){for(var e={},t=0;t<ae.length;++t)e[t]=ae[t%ae.length];return new r.Sampler({urls:e,release:1,baseUrl:"/samples/808/"})}())).sketch=void 0,o.noteon=function(e,t,n){var i=o.modNote(n.note);o.sampler.triggerAttack(G(i),t,n.attack),r.Draw.schedule((function(){var e=o.sketch,t=e.bgCol,n=e.ground;t.hue=Math.random(),t.sat=.4*Math.random()+.5,n.hue=t.hue,n.sat=t.sat,n.lgt=1.35*t.lgt}),t)},o.noteoff=function(e,t,n){var i=o.modNote(n.note);o.sampler.triggerRelease(G(i),t)},o.sketch=e,o}return Object(f.a)(n,[{key:"modNote",value:function(e){return(e+12)%ae.length}}]),n}(ie),re=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n),(e=t.call(this)).chorus=void 0,e.filter=void 0,e.amGain=void 0,e.synth=void 0,e.amOsc=void 0,e.panVol=void 0,e.ps=0,e.psSpread=7,e.harmonicity=new r.Multiply(3.03),e.freq=440,e.obj=void 0,e.wave=void 0,e.fft=void 0,e._attacks=0,e.noteon=function(t,n,o){e.freq=G(o.note)/2;try{e._attacks?e.synth.setNote(e.freq,n):e.synth.triggerAttack(e.freq,n,o.attack)}catch(i){}e._attacks++},e.noteoff=function(t,n,o){e._attacks=Math.max(0,e._attacks-1),e._attacks||e.synth.triggerRelease(n)},e.handleDetune=function(t){e.ps=t,e.synth.set({detune:100*t*e.psSpread})},e.handleModwheel=function(t){var n=Math.sin(t*Math.PI),o=1-n;o=1-o*o;var i=Math.pow(2,Math.floor(32*(1-t))/8-1);e.harmonicity.value=i,e.amOsc.volume.value=t<.5?60*o-60:0;var a=e.ctrls.getSliderForLabel("ff");a&&(a.set(t),e.handleCC({slider:a}));var s=e.ctrls.getSliderForLabel("fq");s&&(s.set(n*n*n*.35),e.handleCC({slider:s}))},e.handleFilter=function(t){return e.filter.set(t)},e.handleADSR=function(t){return e.synth.set({envelope:t})},e.panVol=new r.PanVol(0,0).toDestination(),e.chorus=new r.Chorus(.15,30,1).connect(e.panVol),e.filter=new r.Filter({type:"bandpass"}).connect(e.chorus),e.amGain=new r.Gain(1).connect(e.filter),e.synth=new r.Synth({oscillator:{type:"fatsawtooth",count:4,spread:59},portamento:.25}).connect(e.amGain);var o=(new r.AudioToGain).connect(e.amGain.gain);e.amOsc=new r.OmniOscillator({type:"fatsquare",count:3,spread:30}).start().connect(o),e.synth.frequency.chain(e.harmonicity,e.amOsc.frequency),e.wave=new r.Waveform(32),e.panVol.connect(e.wave),e.fft=new r.FFT({size:16,normalRange:!0}),e.panVol.connect(e.fft);var i=m.getObj(ce);e.obj=i||new ce(Object(c.a)(e),{scale:new h(4)});var l,u=Object(a.a)(e.ctrls.sliders);try{for(u.s();!(l=u.n()).done;){var d=l.value;switch(d.label){case"mod":d.set(1);break;case"a":d.set(.6);break;case"d":d.set(.07);break;case"s":d.set(1);break;case"r":d.set(.7)}}}catch(y){u.e(y)}finally{u.f()}var p,f=Object(a.a)(e.ctrls.sliders);try{for(f.s();!(p=f.n()).done;){var v=p.value;e.handleCC({slider:v})}}catch(y){f.e(y)}finally{f.f()}return e}return Object(f.a)(n,[{key:"loaded",value:function(){return!0}},{key:"handleCC",value:function(e){Object(k.a)(Object(x.a)(n.prototype),"handleCC",this).call(this,e);var t=e.evt;if(t){var o=t.controller.number,i=t.value*t.value;switch(!0){case 23===o:this.harmonicity.value=20*i;break;case 24===o:this.synth.set({portamento:2*i})}}}}]),n}(ee),ce=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e,o){var i;return Object(s.a)(this,n),(i=t.call(this,o)).inst=void 0,i.hue=0,i.every=0,i.ff=0,i.drawFunc=function(e){e.rotateX(i.ff/59371),e.rotateY(i.ff/-37523),e.rotateZ(i.ff/294783);for(var t=i.inst.fft.getValue(),n=[],o=2;o<t.length;o++)n[o-2]=t[o]*o*100;var a=Math.max.apply(Math,[.001].concat(Object(V.a)(n)));n=n.map((function(e){return e/a})).filter((function(e){return e>.05}));var s=i.inst.wave.getValue().filter((function(e){return Math.abs(e)>5e-4}));e.colorMode(e.HSL,1),e.noFill().strokeWeight(3);for(var r=0;r<s.length;r++){var c=2e3*s[r];i.ff++;var l=i.ff%n.length||0,u=(l/t.length*6.7+i.ff/1e5%1)%1,h=(n[l]||0)/2+.5;e.stroke(u,h,.5),e.rotateZ(2*Math.PI/s.length),e.line(0,0,0,c)}e.rotateX(-Math.PI/2);for(var d=0;d<s.length;d++){var p=2e3*s[d];i.ff++;var f=i.ff%n.length||0,v=(f/t.length*6.7+i.ff/1e5%1)%1,m=(n[f]||0)/2+.5;e.stroke(v,m,.5),e.rotateZ(2*Math.PI/s.length),e.line(0,0,0,p)}e.rotateY(-Math.PI/2);for(var y=0;y<s.length;y++){var b=2e3*s[y];i.ff++;var w=i.ff%n.length||0,g=(w/t.length*6.7+i.ff/1e5%1)%1,k=(n[w]||0)/2+.5;e.stroke(g,k,.5),e.rotateZ(2*Math.PI/s.length),e.line(0,0,0,b)}},i.inst=e,i}return n}(y),le=["MA.WAV","RS.WAV"];var ue=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,function(){for(var e={},t=0;t<le.length;++t)e[t]=le[t%le.length];return new r.Sampler({urls:e,release:1,baseUrl:"/samples/808/"})}())).sketch=void 0,o.noteon=function(e,t,n){var i=o.modNote(n.note);o.sampler.triggerAttack(G(i),t,n.attack)},o.noteoff=function(e,t,n){var i=o.modNote(n.note);o.sampler.triggerRelease(G(i),t)},o.sketch=e,o.panVol.set({volume:-10}),o.panVol.mute=!0,o}return Object(f.a)(n,[{key:"modNote",value:function(e){return e%le.length}}]),n}(ie),he={A0:"A0.mp3",C1:"C1.mp3","D#1":"Ds1.mp3","F#1":"Fs1.mp3",A1:"A1.mp3",C2:"C2.mp3","D#2":"Ds2.mp3","F#2":"Fs2.mp3",A2:"A2.mp3",C3:"C3.mp3","D#3":"Ds3.mp3","F#3":"Fs3.mp3",A3:"A3.mp3",C4:"C4.mp3","D#4":"Ds4.mp3","F#4":"Fs4.mp3",A4:"A4.mp3",C5:"C5.mp3","D#5":"Ds5.mp3","F#5":"Fs5.mp3",A5:"A5.mp3",C6:"C6.mp3","D#6":"Ds6.mp3","F#6":"Fs6.mp3",A6:"A6.mp3",C7:"C7.mp3","D#7":"Ds7.mp3","F#7":"Fs7.mp3",A7:"A7.mp3",C8:"C8.mp3"};var de=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.call(this,new r.Sampler({urls:he,release:1,baseUrl:"https://tonejs.github.io/audio/salamander/"}))}return n}(ie),pe=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(s.a)(this,n),(e=t.call(this)).synth=void 0,e.filter=void 0,e.filterVol=void 0,e.reverb=void 0,e.panVol=void 0,e.ps=0,e.psSpread=7,e.modwheel=.6,e.objs=[],e.maxObjs=24,e.ii=0,e.noteon=function(t,n,o){e.synth.triggerAttack(G(o.note),n,o.attack),r.Draw.schedule((function(){return e.addSynthObj(t,o)}),n)},e.noteoff=function(t,n,o){var i=G(o.note);r.Draw.schedule((function(){var t,n=Object(a.a)(e.synth._activeVoices);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.released||o.midi!==i||o.voice.triggerRelease(r.immediate())}}catch(s){n.e(s)}finally{n.f()}}),"+".concat(n-r.immediate()))},e.handleDetune=function(t){e.ps=t,e.synth.set({detune:100*t*e.psSpread})},e.handleModwheel=function(t){e.modwheel=t;var n=e.ctrls.getSliderForLabel("ff");n&&(n.set(t),e.handleCC({slider:n}));var o=e.ctrls.getSliderForLabel("fq");if(o){var i=Math.sin(t*Math.PI),a=1-t;a=1-a*a*a,o.set(.2*i+.06+.2*a),e.handleCC({slider:o})}},e.handleFilter=function(t){return e.filter.set(t)},e.handleADSR=function(t){return e.synth.set({envelope:t})},e.lastPos={},e.addSynthObj=function(t,n){var o=Object(c.a)(e),i=o.objs,s=o.maxObjs,r=t.user.clientId,l=t.xform.pos;e.lastPos[r]&&(l=e.lastPos[r]);var u=new h(Y(),Math.random(),Y()).applyMult(60);if(l=l.cloneAdd(u),e.ii++%8===0||l.y>1e3){var d,p=Object(a.a)(i);try{for(p.s();!(d=p.n()).done;){d.value.xform.scale.applyMult(.6)}}catch(O){p.e(O)}finally{p.f()}var f=t.facing,v=t.xform,y=v.pos,b=v.scale,w=Math.random()*Math.PI*2,g=f.cloneMult(400);l.x=y.x+g.x+3*b.x*Math.sin(w),l.y=y.y,l.z=y.z+g.z+3*b.x*Math.cos(w)}e.lastPos[r]=l;var k=new h(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),x=new fe(Object(c.a)(e),{noteEvt:n,pos:l,rot:k,scale:new h(100)});i.unshift(x),m.addObj(x),i.length>s&&(m.rmObj(i[i.length-1]),e.objs=i.slice(0,s))},e.panVol=new r.PanVol(0,0).toDestination(),e.reverb=new r.Reverb({decay:4,wet:.6}).connect(e.panVol),e.filterVol=new r.Volume(0).connect(e.reverb),e.filter=new r.Filter({type:"bandpass"}).connect(e.filterVol),e.synth=new r.PolySynth(r.Synth,{oscillator:{type:"fatsquare",count:3,spread:30}}).connect(e.filter);var o,i=Object(a.a)(e.ctrls.sliders);try{for(i.s();!(o=i.n()).done;){var l=o.value;switch(l.label){case"mod":l.set(.6);break;case"a":l.set(.01);break;case"d":l.set(.4);break;case"s":l.set(.66);break;case"r":l.set(.5)}}}catch(f){i.e(f)}finally{i.f()}var u,d=Object(a.a)(e.ctrls.sliders);try{for(d.s();!(u=d.n()).done;){var p=u.value;e.handleCC({slider:p})}}catch(f){d.e(f)}finally{d.f()}return e}return Object(f.a)(n,[{key:"loaded",value:function(){return!0}}]),n}(ee),fe=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e,o){var i;return Object(s.a)(this,n),(i=t.call(this,o)).polySynth=void 0,i.hue=Math.random(),i.lgt=.3,i.update=function(e){var t=1-i.polySynth.modwheel;t=1-t*t,i.lgt=.8*t+.2,i.hue+=(2*Math.random()-1)*e*t,i.hue<0?i.hue+=1:i.hue>1&&(i.hue-=1),i.xform.rot.applyAdd(Z().applyMult(e*t))},i.drawFunc=function(e){e.colorMode(e.HSL,1),e.fill(i.hue,.8,i.lgt),e.stroke(i.hue,.8,i.lgt-.2),e.strokeWeight(1),e.sphere(1,3,4),e.colorMode(e.RGB,255)},i.polySynth=e,i}return n}(y),ve={},me={LIBRARY:"p5.EasyCam",VERSION:"1.0.10",AUTHOR:"p5.EasyCam authors",SOURCE:"https://github.com/freshfork/p5.EasyCam",toString:function(){return this.LIBRARY+" v"+this.VERSION+" by "+this.AUTHOR+" ("+this.SOURCE+")"}},ye=function(){function e(t,n){if(Object(s.a)(this,e),t instanceof window.p5.RendererGL){void 0===(n=n||{}).distance&&(n.distance=500),void 0===n.center&&(n.center=[0,0,0]),void 0===n.rotation&&(n.rotation=ge.identity()),void 0===n.viewport&&(n.viewport=[0,0,t.width,t.height]),this.INFO=me,this.setCanvas(t);var o=this;this.cam=o,this.LOOK=[0,0,1],this.UP=[0,1,0],this.AXIS=new function(){this.YAW=1,this.PITCH=2,this.ROLL=4,this.ALL=this.YAW|this.PITCH|this.ROLL},this.SHIFT_CONSTRAINT=0,this.FIXED_CONSTRAINT=0,this.DRAG_CONSTRAINT=0,this.scale_rotation=.001,this.scale_pan=2e-4,this.scale_zoom=.001,this.scale_zoomwheel=20,this.distance_min_limit=.01,this.distance_min=1,this.distance_max=Number.MAX_VALUE,this.state={distance:n.distance,center:n.center.slice(),rotation:n.rotation.slice(),copy:function(e){return(e=e||{}).distance=this.distance,e.center=this.center.slice(),e.rotation=this.rotation.slice(),e}},this.state_reset=this.state.copy(),this.state_pushed=this.state.copy(),this.viewport=n.viewport.slice(),this.mouse={cam:o,curr:[0,0,0],prev:[0,0,0],dist:[0,0,0],mwheel:0,isPressed:!1,istouchdown:!1,ismousedown:!1,BUTTON:{LMB:1,MMB:2,RMB:4},button:0,mouseDragLeft:o.mouseDragRotate.bind(o),mouseDragCenter:o.mouseDragPan.bind(o),mouseDragRight:o.mouseDragZoom.bind(o),mouseWheelAction:o.mouseWheelZoom.bind(o),touchmoveSingle:o.mouseDragRotate.bind(o),touchmoveMulti:function(){o.mouseDragPan(),o.mouseDragZoom()},insideViewport:function(e,t){var n=o.viewport[0],i=n+o.viewport[2],a=o.viewport[1],s=a+o.viewport[3];return e>n&&e<i&&t>a&&t<s},solveConstraint:function(){var e=this.dist[0],t=this.dist[1];this.shiftKey&&!o.SHIFT_CONSTRAINT&&Math.abs(e-t)>1&&(o.SHIFT_CONSTRAINT=Math.abs(e)>Math.abs(t)?o.AXIS.YAW:o.AXIS.PITCH),o.DRAG_CONSTRAINT=o.AXIS.ALL,o.FIXED_CONSTRAINT&&(o.DRAG_CONSTRAINT=o.FIXED_CONSTRAINT),o.SHIFT_CONSTRAINT&&(o.DRAG_CONSTRAINT=o.SHIFT_CONSTRAINT)},updateInput:function(e,t,n){var i=o.mouse,a=o.P5.pixelDensity();i.prev[0]=i.curr[0],i.prev[1]=i.curr[1],i.prev[2]=i.curr[2],i.curr[0]=e,i.curr[1]=t,i.curr[2]=n,i.dist[0]=-(i.curr[0]-i.prev[0])/a,i.dist[1]=-(i.curr[1]-i.prev[1])/a,i.dist[2]=-(i.curr[2]-i.prev[2])/a},mousedown:function(e){var t=o.mouse;0===e.button&&(t.button|=t.BUTTON.LMB),1===e.button&&(t.button|=t.BUTTON.MMB),2===e.button&&(t.button|=t.BUTTON.RMB),t.insideViewport(e.x,e.y)&&(t.updateInput(e.x,e.y,e.y),t.ismousedown=t.button>0,t.isPressed=t.ismousedown,o.SHIFT_CONSTRAINT=0)},mousedrag:function(){var e=o.mouse;if(e.ismousedown){var t=o.P5.mouseX,n=o.P5.mouseY,i=n;e.updateInput(t,n,i),e.solveConstraint();var a=e.button&e.BUTTON.LMB,s=e.button&e.BUTTON.MMB,r=e.button&e.BUTTON.RMB;a&&e.mouseDragLeft&&e.mouseDragLeft(),s&&e.mouseDragCenter&&e.mouseDragCenter(),r&&e.mouseDragRight&&e.mouseDragRight()}},mouseup:function(e){var t=o.mouse;0===e.button&&(t.button&=~t.BUTTON.LMB),1===e.button&&(t.button&=~t.BUTTON.MMB),2===e.button&&(t.button&=~t.BUTTON.RMB),t.ismousedown=t.button>0,t.isPressed=t.istouchdown||t.ismousedown,o.SHIFT_CONSTRAINT=0},dblclick:function(e){var t=e.x,n=e.y;o.mouse.insideViewport(t,n)&&o.reset()},wheel:function(e){var t=e.x,n=e.y,i=o.mouse;i.insideViewport(t,n)&&(i.mwheel=.01*e.deltaY,i.mouseWheelAction&&i.mouseWheelAction())},evaluateTouches:function(e){var t,n,i,a=e.touches,s=0,r=0,c=0,l=a.length;for(t=0;t<l;t++)s+=a[t].clientX,r+=a[t].clientY;for(s/=l,r/=l,t=0;t<l;t++)n=s-a[t].clientX,i=r-a[t].clientY,c+=Math.sqrt(n*n+i*i);c/=l,o.mouse.updateInput(s,r,-c)},touchstart:function(e){e.preventDefault(),e.stopPropagation();var t=o.mouse;t.evaluateTouches(e),t.istouchdown=t.insideViewport(t.curr[0],t.curr[1]),t.isPressed=o.mouse.istouchdown||o.mouse.ismousedown,t.dbltap(e)},touchmove:function(e){e.preventDefault(),e.stopPropagation();var t=o.mouse;t.istouchdown&&(t.evaluateTouches(e),t.solveConstraint(),1===e.touches.length?t.touchmoveSingle():(t.touchmoveMulti(),t.tapcount=0))},touchend:function(e){e.preventDefault(),e.stopPropagation();var t=o.mouse;t.istouchdown=!1,t.isPressed=t.istouchdown||t.ismousedown,o.SHIFT_CONSTRAINT=0,t.tapcount>=2&&(t.insideViewport(t.curr[0],t.curr[1])&&o.reset(),t.tapcount=0)},tapcount:0,dbltap:function(e){0===o.mouse.tapcount++&&setTimeout((function(){o.mouse.tapcount=0}),350)},shiftKey:!1,keydown:function(e){var t=o.mouse;t.shiftKey||(t.shiftKey=16===e.keyCode)},keyup:function(e){var t=o.mouse;t.shiftKey&&(t.shiftKey=16!==e.keyCode,t.shiftKey||(o.SHIFT_CONSTRAINT=0))}},this.attachMouseListeners(),this.auto_update=!0,this.P5.registerMethod("pre",(function(){o.auto_update&&o.update()})),this.dampedZoom=new be((function(e){o.zoom(e*o.getZoomMult())})),this.dampedPanX=new be((function(e){o.panX(e*o.getPanMult())})),this.dampedPanY=new be((function(e){o.panY(e*o.getPanMult())})),this.dampedPanZ=new be((function(e){o.panZ(e*o.getPanMult())})),this.dampedRotX=new be((function(e){o.rotateX(e*o.getRotationMult())})),this.dampedRotY=new be((function(e){o.rotateY(e*o.getRotationMult())})),this.dampedRotZ=new be((function(e){o.rotateZ(e*o.getRotationMult())})),this.timedRot=new we(o.setInterpolatedRotation.bind(o)),this.timedPan=new we(o.setInterpolatedCenter.bind(o)),this.timedzoom=new we(o.setInterpolatedDistance.bind(o))}else console.log("renderer needs to be an instance of p5.RendererGL")}return Object(f.a)(e,[{key:"setCanvas",value:function(e){e instanceof window.p5.RendererGL?(this.renderer=e,e._pInst instanceof window.p5?this.graphics=e:this.graphics=e._pInst,this.P5=this.graphics._pInst):(this.graphics=void 0,this.renderer=void 0)}},{key:"getCanvas",value:function(){return this.renderer}},{key:"attachListener",value:function(e,t,n,o){e&&e!==n.el&&(this.detachListener(n),n.el=e,n.ev=t,n.op=o,n.el.addEventListener(n.ev,n,n.op))}},{key:"detachListener",value:function(e){e.el&&(e.el.removeEventListener(e.ev,e,e.op),e.el=void 0)}},{key:"attachMouseListeners",value:function(e){var t=this.cam,n=t.mouse;if(e=e||t.renderer){var o={passive:!1},i=e.elt;t.attachListener(i,"mousedown",n.mousedown,o),t.attachListener(i,"mouseup",n.mouseup,o),t.attachListener(i,"wheel",n.wheel,o),t.attachListener(i,"touchstart",n.touchstart,o),t.attachListener(i,"touchend",n.touchend,o),t.attachListener(i,"touchmove",n.touchmove,o),t.attachListener(window,"keydown",n.keydown,o),t.attachListener(window,"keyup",n.keyup,o)}}},{key:"removeMouseListeners",value:function(){var e=this.cam,t=e.mouse;e.detachListener(t.mousedown),e.detachListener(t.mouseup),e.detachListener(t.wheel),e.detachListener(t.keydown),e.detachListener(t.keyup),e.detachListener(t.touchstart),e.detachListener(t.touchend),e.detachListener(t.touchmove)}},{key:"dispose",value:function(){}},{key:"getAutoUpdate",value:function(){return this.auto_update}},{key:"setAutoUpdate",value:function(e){this.auto_update=e}},{key:"update",value:function(){var e=this.cam;e.mouse.mousedrag();var t=!1;t|=e.dampedZoom.update(),t|=e.dampedPanX.update(),t|=e.dampedPanY.update(),t|=e.dampedPanZ.update(),t|=e.dampedRotX.update(),t|=e.dampedRotY.update(),(t|=e.dampedRotZ.update())?(e.timedRot.stop(),e.timedPan.stop(),e.timedzoom.stop()):(e.timedRot.update(),e.timedPan.update(),e.timedzoom.update()),e.apply()}},{key:"apply",value:function(e){var t=this.cam;(e=e||t.renderer)&&(this.camEYE=this.getPosition(this.camEYE),this.camLAT=this.getCenter(this.camLAT),this.camRUP=this.getUpVector(this.camRUP),void 0===e._curCamera?e.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]):e._curCamera.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]))}},{key:"setViewport",value:function(e){this.viewport=e.slice()}},{key:"getViewport",value:function(){return this.viewport}},{key:"mouseWheelZoom",value:function(){var e=this.mouse;this.dampedZoom.addForce(e.mwheel*this.scale_zoomwheel)}},{key:"mouseDragZoom",value:function(){var e=this.mouse;this.dampedZoom.addForce(-e.dist[2])}},{key:"mouseDragPan",value:function(){var e=this.mouse;this.dampedPanX.addForce(this.DRAG_CONSTRAINT&this.AXIS.YAW?e.dist[0]:0),this.dampedPanY.addForce(this.DRAG_CONSTRAINT&this.AXIS.PITCH?e.dist[1]:0)}},{key:"mouseDragRotate",value:function(){var e=this,t=e.mouse,n=t.curr[0],o=t.curr[1],i=t.dist[0],a=t.dist[1],s=2*Math.min(Math.max((n-e.viewport[0])/e.viewport[2],0),1)-1,r=2*Math.min(Math.max((o-e.viewport[1])/e.viewport[3],0),1)-1;e.DRAG_CONSTRAINT&e.AXIS.YAW&&e.dampedRotY.addForce(+i*(1-r*r)),e.DRAG_CONSTRAINT&e.AXIS.PITCH&&e.dampedRotX.addForce(-a*(1-s*s)),e.DRAG_CONSTRAINT&e.AXIS.ROLL&&(e.dampedRotZ.addForce(-i*r),e.dampedRotZ.addForce(+a*s))}},{key:"getZoomMult",value:function(){return this.state.distance*this.scale_zoom}},{key:"getPanMult",value:function(){return this.state.distance*this.scale_pan}},{key:"getRotationMult",value:function(){return Math.pow(Math.log10(1+this.state.distance),.5)*this.scale_rotation}},{key:"zoom",value:function(e){var t=this.cam,n=t.state.distance+e;n<t.distance_min&&(n=t.distance_min,t.dampedZoom.stop()),n>t.distance_max&&(n=t.distance_max,t.dampedZoom.stop()),t.state.distance=n}},{key:"panX",value:function(e){var t=this.cam.state;if(e){var n=ge.applyToVec3(t.rotation,[e,0,0]);xe.add(t.center,n,t.center)}}},{key:"panY",value:function(e){var t=this.cam.state;if(e){var n=ge.applyToVec3(t.rotation,[0,e,0]);xe.add(t.center,n,t.center)}}},{key:"panZ",value:function(e){var t=this.cam.state;if(e){var n=ge.applyToVec3(t.rotation,[0,0,e]);xe.add(t.center,n,t.center)}}},{key:"panGround",value:function(e,t,n){var o=this.centerAxes();xe.mult(o.x,e,o.x),xe.mult(o.z,n,o.z);var i=[0,0,0];xe.add(o.x,o.z,i),i[1]=t,xe.add(this.cam.state.center,i,this.cam.state.center)}},{key:"centerAxes",value:function(){var e=this.cam.state,t=ge.applyToVec3(e.rotation,[1,0,0]);t[1]=0;var n=xe.mag(t);0===n&&(console.warn("[EasyCam] No magnitude for screenX vector",t),n=1),xe.mult(t,1/n,t);var o=[0,0,0];return xe.cross(t,[0,1,0],o),{x:t,y:[0,1,0],z:o}}},{key:"pan",value:function(e,t,n){this.cam.panX(e),this.cam.panY(t),this.cam.panZ(n)}},{key:"rotateX",value:function(e){this.cam.rotate([1,0,0],e)}},{key:"rotateY",value:function(e){this.cam.rotate([0,1,0],e)}},{key:"rotateZ",value:function(e){this.cam.rotate([0,0,1],e)}},{key:"rotate",value:function(e,t){var n=this.cam.state;if(t){var o=ge.create({axis:e,angle:t});ge.applyToRotation(n.rotation,o,n.rotation)}}},{key:"setInterpolatedDistance",value:function(e,t,n){this.cam.state.distance=ke.mix(e,t,ke.smoothstep(n))}},{key:"setInterpolatedCenter",value:function(e,t,n){this.cam.state.center=xe.mix(e,t,ke.smoothstep(n))}},{key:"setInterpolatedRotation",value:function(e,t,n){this.cam.state.rotation=ge.slerp(e,t,n)}},{key:"setDistanceMin",value:function(e){this.distance_min=Math.max(e,this.distance_min_limit),this.zoom(0)}},{key:"setDistanceMax",value:function(e){this.distance_max=e,this.zoom(0)}},{key:"setDistance",value:function(e,t){this.timedzoom.start(this.state.distance,e,t,[this.dampedZoom])}},{key:"getDistance",value:function(){return this.state.distance}},{key:"setCenter",value:function(e,t){this.timedPan.start(this.state.center,e,t,[this.dampedPanX,this.dampedPanY])}},{key:"getCenter",value:function(){return this.state.center}},{key:"setRotation",value:function(e,t){this.timedRot.start(this.state.rotation,e,t,[this.dampedRotX,this.dampedRotY,this.dampedRotZ])}},{key:"getRotation",value:function(){return this.state.rotation}},{key:"getPosition",value:function(e){var t=this.cam,n=t.state;return e=xe.assert(e),ge.applyToVec3(n.rotation,t.LOOK,e),xe.mult(e,n.distance,e),xe.add(e,n.center,e),e}},{key:"getUpVector",value:function(e){var t=this.cam,n=t.state;return e=xe.assert(e),ge.applyToVec3(n.rotation,t.UP,e),e}},{key:"getState",value:function(){return this.state.copy()}},{key:"setState",value:function(e,t){e&&(this.setDistance(e.distance,t),this.setCenter(e.center,t),this.setRotation(e.rotation,t))}},{key:"pushState",value:function(){return this.state_pushed=this.getState()}},{key:"popState",value:function(e){this.setState(this.state_pushed,e)}},{key:"pushResetState",value:function(){return this.state_reset=this.getState()}},{key:"reset",value:function(e){this.setState(this.state_reset,e)}},{key:"setRotationScale",value:function(e){this.scale_rotation=e}},{key:"setPanScale",value:function(e){this.scale_pan=e}},{key:"setZoomScale",value:function(e){this.scale_zoom=e}},{key:"setWheelScale",value:function(e){this.scale_zoomwheel=e}},{key:"getRotationScale",value:function(){return this.scale_rotation}},{key:"getPanScale",value:function(){return this.scale_pan}},{key:"getZoomScale",value:function(){return this.scale_zoom}},{key:"getWheelScale",value:function(){return this.scale_zoomwheel}},{key:"setDamping",value:function(e){this.dampedZoom.damping=e,this.dampedPanX.damping=e,this.dampedPanY.damping=e,this.dampedPanZ.damping=e,this.dampedRotX.damping=e,this.dampedRotY.damping=e,this.dampedRotZ.damping=e}},{key:"setDefaultInterpolationTime",value:function(e){this.timedRot.default_duration=e,this.timedPan.default_duration=e,this.timedzoom.default_duration=e}},{key:"setRotationConstraint",value:function(e,t,n){var o=this.cam;o.FIXED_CONSTRAINT=0,o.FIXED_CONSTRAINT|=e?o.AXIS.YAW:0,o.FIXED_CONSTRAINT|=t?o.AXIS.PITCH:0,o.FIXED_CONSTRAINT|=n?o.AXIS.ROLL:0}},{key:"beginHUD",value:function(e,t,n){var o=this.cam;if(e=e||o.renderer){this.pushed_rendererState=e.push();var i=e.drawingContext,a=void 0!==t?t:e.width,s=void 0!==n?n:e.height,r=Number.MAX_VALUE;i.flush(),i.disable(i.DEPTH_TEST),this.pushed_uMVMatrix=e.uMVMatrix.copy(),this.pushed_uPMatrix=e.uPMatrix.copy(),e.resetMatrix(),e._curCamera.ortho(0,a,-s,0,-r,+r)}}},{key:"endHUD",value:function(e){var t=this.cam;if(e=e||t.renderer){var n=e.drawingContext;n.flush(),e.uMVMatrix.set(this.pushed_uMVMatrix),e.uPMatrix.set(this.pushed_uPMatrix),n.enable(n.DEPTH_TEST),e.pop(this.pushed_rendererState)}}}]),e}(),be=function(){function e(t){Object(s.a)(this,e),this.value=0,this.damping=.85,this.action=t}return Object(f.a)(e,[{key:"addForce",value:function(e){this.value+=e}},{key:"update",value:function(){var e=this.value*this.value>1e-6;return e?(this.action(this.value),this.value*=this.damping):this.stop(),e}},{key:"stop",value:function(){this.value=0}}]),e}(),we=function(){function e(t){Object(s.a)(this,e),this.default_duration=300,this.action=t}return Object(f.a)(e,[{key:"start",value:function(e,t,n,o){for(var i in o)o[i].stop();this.valA=e,this.valB=t,this.duration=void 0===n?this.default_duration:n,this.timer=(new Date).getTime(),this.active=this.duration>0,this.active||this.interpolate(1)}},{key:"update",value:function(){if(this.active){var e=((new Date).getTime()-this.timer)/this.duration;e>.995?(this.interpolate(1),this.stop()):this.interpolate(e)}}},{key:"interpolate",value:function(e){this.action(this.valA,this.valB,e)}},{key:"stop",value:function(){this.active=!1}}]),e}(),ge={assert:function(e){return void 0===e||e.constructor!==Array?[1,0,0,0]:e},identity:function(){return[1,0,0,0]},applyToVec3:function(e,t,n){var o=Object(N.a)(t,3),i=o[0],a=o[1],s=o[2],r=Object(N.a)(e,4),c=r[0],l=r[1],u=r[2],h=r[3],d=l*i+u*a+h*s;return(n=xe.assert(n))[0]=2*(c*(i*c-(u*s-h*a))+d*l)-i,n[1]=2*(c*(a*c-(h*i-l*s))+d*u)-a,n[2]=2*(c*(s*c-(l*a-u*i))+d*h)-s,n},applyToRotation:function(e,t,n){var o=Object(N.a)(e,4),i=o[0],a=o[1],s=o[2],r=o[3],c=Object(N.a)(t,4),l=c[0],u=c[1],h=c[2],d=c[3];return(n=ge.assert(n))[0]=l*i-(u*a+h*s+d*r),n[1]=u*i+l*a+(h*r-d*s),n[2]=h*i+l*s+(d*a-u*r),n[3]=d*i+l*r+(u*s-h*a),n},slerp:function(e,t,n,o){var i=Object(N.a)(e,4),a=i[0],s=i[1],r=i[2],c=i[3],l=Object(N.a)(t,4),u=l[0],h=l[1],d=l[2],p=l[3],f=a*u+s*h+r*d+c*p;f<0&&(u=-u,h=-h,d=-d,p=-p,f=-f);var v,m,y=Math.acos(f),b=Math.sqrt(1-f*f);return b>.001?(v=Math.sin((1-n)*y)/b,m=Math.sin(n*y)/b):(v=1-n,m=n),(o=ge.assert(o))[0]=v*a+m*u,o[1]=v*s+m*h,o[2]=v*r+m*d,o[3]=v*c+m*p,ge.create({rotation:o,normalize:!0},o)},create:function(e,t){if(t=ge.assert(t),e.axis){var n=e.axis,o=e.angle,i=xe.mag(n);if(0===i)return;var a=-.5*o,s=Math.sin(a)/i;return t[0]=Math.cos(a),t[1]=s*n[0],t[2]=s*n[1],t[3]=s*n[2],t}if(e.rotation){if(t[0]=e.rotation[0],t[1]=e.rotation[1],t[2]=e.rotation[2],t[3]=e.rotation[3],e.normalize){var r=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]);t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r}return t}if(e.angles_xyz){var c=-.5*e.angles_xyz[0],l=-.5*e.angles_xyz[1],u=-.5*e.angles_xyz[2],h=[Math.cos(c),Math.sin(c),0,0],d=[Math.cos(l),0,Math.sin(l),0],p=[Math.cos(u),0,0,Math.sin(u)];return ge.applyToRotation(d,p,t),ge.applyToRotation(h,t,t),t}}},ke={mix:function(e,t,n){return e*(1-n)+t*n},smoothstep:function(e){return e*e*(3-2*e)},smootherstep:function(e){return e*e*e*(e*(6*e-15)+10)}},xe={assert:function(e){return void 0===e||e.constructor!==Array?[0,0,0]:e},isScalar:function(e){return void 0!==e&&e.constructor!==Array},add:function(e,t,n){return n=this.assert(n),this.isScalar(t)?(n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2]),n},mult:function(e,t,n){return n=this.assert(n),this.isScalar(t)?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t):(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2]),n},magSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},mag:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,n){return(n=this.assert(n))[0]=e[1]*t[2]-e[2]*t[1],n[1]=e[2]*t[0]-e[0]*t[2],n[2]=e[0]*t[1]-e[1]*t[0],n},angle:function(e,t){var n=this.mag(e)*this.mag(t);if(0===n)return 0;var o=this.dot(e,t),i=.9999*n;if(o<-i||o>i){var a=this.cross(e,t);return o>=0?Math.asin(this.mag(a)/n):Math.PI-Math.asin(this.mag(a)/n)}return Math.acos(o/n)},mix:function(e,t,n,o){return(o=this.assert(o))[0]=ke.mix(e[0],t[0],n),o[1]=ke.mix(e[1],t[1],n),o[2]=ke.mix(e[2],t[2],n),o}};ye.INFO=me,Object.freeze(me),ve.EasyCam=ye,ve.DampedAction=be,ve.Interpolation=we,ve.Rotation=ge,ve.Vec3=xe,ve.Scalar=ke;function Oe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e,i=t,a=n?.1:1;i<a&&(i*=1e3,o="m".concat(e)),i<a&&(i*=1e3,o="\xb5".concat(e));var s=i>=10?0:i>=1?1:2;return"".concat(i.toFixed(s)).concat(o)}var Se=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(s.a)(this,e),this.pp=void 0,this.nameCustomized=!1,this.inputs={},this.hidden=!1,this.clockOpts={bpm:95},this.help=!1,this.helpRetoggle={loops:!0,dial:!0},this.helpImg=void 0,this.pingBeats=0,this.bpm=function(){return t.inputs.bpm?t.inputs.bpm.value():t.clockOpts.bpm},this.isFocused=function(){for(var e in t.inputs){var n=t.inputs[e];if(n&&n.focused)return!0}return!1},this.toggleHide=function(){t.pp&&(t.hidden=!t.hidden,t.setup(t.pp),t.hidden||t.setupInputsBPM())},this.toggleHelp=function(){if(t.pp){var e=De.loops;t.help=!t.help,t.help&&(t.helpRetoggle.loops=!e.hidden,t.helpRetoggle.dial=!e.hiddenDial),t.helpRetoggle.loops&&e.toggleHide(),t.helpRetoggle.dial&&e.toggleHideDial(),t.setup(t.pp),t.help||t.hidden||t.setupInputsBPM()}},this.setup=function(e){if(t.pp=e,t.helpImg||(t.helpImg=e.loadImage("/help-overlay.png")),t.hidden||t.help){for(var n in t.inputs){var o=t.inputs[n];o&&(o.remove(),delete t.inputs[n])}t.setupInputsHide(t.pp)}else t.setupInputsUser(De.ws.clientId),t.setupInputsInstrument(),t.setupInputsHide(e)},this.setupInputsHide=function(e){t.inputs.hide&&t.inputs.hide.remove(),t.inputs.hideLoops&&t.inputs.hideLoops.remove(),t.inputs.hideDial&&t.inputs.hideDial.remove(),t.inputs.showHelp&&t.inputs.showHelp.remove();var n=De.loops;t.inputs.showHelp=e.createButton(t.help?"Hide Help":"Show Help");var o=t.inputs.showHelp,i=e.width-o.width-50,a=e.height-o.height-10;if(o.position(i,a),o.mousePressed(t.toggleHelp),!t.help){i-=100,t.inputs.hide=e.createButton(t.hidden?"Show Settings":"Hide Settings"),t.inputs.hideLoops=e.createButton(n.toggleHideText()),t.inputs.hideDial=e.createButton(n.toggleHideDialText());var s=t.inputs,r=s.hide,c=s.hideLoops,l=s.hideDial;c.position(i,a),c.mousePressed((function(){n.toggleHide(),c.elt.innerHTML=n.toggleHideText()})),i-=130,l.position(i,a),l.mousePressed((function(){n.toggleHideDial(),l.elt.innerHTML=n.toggleHideDialText()})),i-=110,r.position(i,a),r.mousePressed(t.toggleHide)}},this.setupInputsUser=function(e){var n=De.user,o=t.nameCustomized?n.name:"User ".concat(De.ws.clientId);if(t.hidden)""===n.name&&De.updateUser({name:o});else if(t.pp){t.inputs.name&&t.inputs.name.remove(),t.inputs.latency&&t.inputs.latency.remove(),t.inputs.name=t.pp.createInput(o),t.inputs.latency=t.pp.createInput("".concat(De.user.offset));var i=t.inputs,a=i.name,s=i.latency;a.size(80),a.position(20,40),a.input((function(){t.nameCustomized=!0,De.updateUser({name:a.value()})})),a.elt.onfocus=function(){return a.focused=!0},a.elt.onblur=function(){return a.focused=!1},De.updateUser({name:a.value()},!1),s.size(50),s.position(a.x+a.width+10,40);var r=function(){var e=parseFloat(s.value());Number.isNaN(e)||(De.updateUser({offset:e}),De.loops.updateRecOffset(e))};s.input((function(){console.log("[SketchInputs #inputs.latency] Changed:",s.value()),r()})),s.elt.onfocus=function(){return s.focused=!0},s.elt.onblur=function(){return s.focused=!1},r()}else console.log("[SketchInputs #setupInputsUser] Attempted to setup user input before sketch was initialized")},this.setupInputsInstrument=function(){if(t.pp&&t.inputs.latency&&!t.hidden){t.inputs.instrument&&t.inputs.instrument.remove();var e=t.pp.createSelect();e.position(t.inputs.latency.x+t.inputs.latency.width+10,40);var n=De.user.instrument;for(var o in e.size(130),De.instruments)e.option(o),o===n&&e.selected(o);e.changed((function(){De.updateUser({instrument:e.value()})})),e.elt.onfocus=function(){return e.focused=!0},e.elt.onblur=function(){return e.focused=!1},t.inputs.instrument=e,De.updateUser({instrument:e.value()},!1)}},this.setupInputsMidi=function(e){if(t.pp&&t.inputs.instrument&&!t.hidden){t.inputs.inputDevice&&t.inputs.inputDevice.remove();var n=(e||{inputs:[]}).inputs,o=t.pp.createSelect(),i=t.inputs.instrument;o.position(i.x+i.width+10,40),o.option("keyboard");var s,r=Object(a.a)(n);try{for(r.s();!(s=r.n()).done;){var c=s.value._midiInput;c?o.option(c.name):console.error("[SketchInputs #setupInputsMidi] Received a midi input with missing data")}}catch(l){r.e(l)}finally{r.f()}o.selected(De.user.inputDevice),o.changed((function(){De.updateUser({inputDevice:o.value()})})),o.elt.onfocus=function(){return o.focused=!0},o.elt.onblur=function(){return o.focused=!1},t.inputs.inputDevice=o,De.updateUser({inputDevice:o.value()},!1)}},this.setupInputsBPM=function(){if(t.pp&&!t.hidden){t.inputs.bpm&&t.inputs.bpm.remove();var e=t.pp.createSlider(30,200,t.clockOpts.bpm);e.position(20,t.pp.height-40),e.size(300),e.input((function(){t.clockOpts.bpm=e.value(),t.clockOpts.clientId=De.user.clientId,t.sendClockUpdate(t.clockOpts)})),e.elt.onfocus=function(){return e.focused=!0},e.elt.onblur=function(){return e.focused=!1},t.inputs.bpm=e}},this.draw=function(e){if(t.help)t.drawHelp(e);else if(!t.hidden)for(var n in t.drawClockStats(e),e.textSize(12).textAlign(e.LEFT,e.BOTTOM).textStyle(e.BOLD),e.fill(255).strokeWeight(1).stroke(0),t.inputs){var o=t.inputs[n];if(o){var i=o.x+3,a=o.y-5;switch(!0){case"hide"===n:case"hideLoops"===n:case"hideDial"===n:case"showHelp"===n:continue;case"latency"===n:e.push();var s=parseFloat(o.value()),r="";Number.isNaN(s)?(e.fill(255,40,40),r=" (NaN!)"):t.pingBeats>s/2&&(e.fill(255,128,0),r=" (check ping)"),e.text("".concat(n.toUpperCase()).concat(r,"\n","in beats"),i,a),e.pop();break;case n in De.user:e.text(n.toUpperCase(),i,a);break;default:e.text("".concat(n.toUpperCase(),": ").concat(o.value()),i,a)}}}},this.drawClockStats=function(e){e.push(),e.colorMode(e.HSL,1);var n=function(){return e.fill(0,0,.7).textAlign(e.RIGHT,e.BOTTOM)},o=function(t){return e.textAlign(e.LEFT,e.BOTTOM).fill(0,t?1:0,t?.65:.85)},i=De.beatMs(),a=e.height-140;if(e.fill(.58,.8,.65).strokeWeight(1).stroke(0),e.textAlign(e.LEFT,e.BOTTOM).textSize(13).textStyle(e.BOLD),e.text("Clock stats (B = beat = ".concat(Oe("s",i/1e3),")"),20,a),e.textSize(12).strokeWeight(1),a+=20,!De.ws.ready())return o(!0).text("NO CONNECTION TO SERVER",20,a),void e.pop();var s=De.user.offset,r=De.ws.clock,c=r.precisionNow,l=r.pingMs;t.pingBeats=l/i;var u=Math.abs(c),h="".concat(Oe("s",u/1e3)," (").concat(Oe("B",u/i,!0),")"),d="".concat(Oe("s",l/1e3)," (").concat(Oe("B",t.pingBeats,!0),")");n().text("precision:",80,a),o(u/i>=1/32).text(h,85,a),a+=20,n().text("ping:",80,a),o(t.pingBeats>s/2).text(d,85,a),e.pop()},this.drawHelp=function(e){if(t.helpImg){var n=t.helpImg.height/t.helpImg.width,o=e.width-80,i=n*o,a=(e.height-i)/2;e.background(60,220),e.image(t.helpImg,40,a,o,i)}},this.sendClockUpdate=function(e){var t=De.ws,n=t.conn;(0,t.ready)()?n.send(Object(U.g)(e)):console.warn("[SketchInputs #sendClockUpdate] Can't send bpm update, websocket connection is not open")},this.onClockUpdate=function(e){t.clockOpts=e,t.inputs.bpm&&t.inputs.bpm.value(e.bpm)},this.keyPressed=function(e){var n;switch(e.key){case"c":n=!0;break;case"v":n=!1;break;default:return}for(var o=De.user.instrument,i=Object.keys(De.instruments),a=0;a<i.length;a++){if(i[a]===o){var s=void 0;return s=n?0===a?i[i.length-1]:i[a-1]:a===i.length-1?i[0]:i[a+1],t.inputs.instrument&&t.inputs.instrument.selected(s),void De.updateUser({instrument:s})}}},this.nameCustomized=n},Me=n(693),Ce=n.n(Me),Ae=function e(t){var n=this;Object(s.a)(this,e),this.sketch=void 0,this.audioKeys=void 0,this.keyPressed=function(e){var t=e.note,o=e.velocity;if(!n.sketch.keyboardInputDisabled()){var i=n.sketch.pp;if((!i||!i.keyIsDown(17))&&"keyboard"===n.sketch.user.inputDevice){var a={kind:"noteon",note:t,attack:o/128};n.sketch.sendUserEvent("keyboard","noteon",a)}}},this.keyReleased=function(e){var t=e.note;if(!n.sketch.keyboardInputDisabled()&&"keyboard"===n.sketch.user.inputDevice){var o={kind:"noteoff",note:t};n.sketch.sendUserEvent("keyboard","noteoff",o)}},this.sketch=t,this.audioKeys=new Ce.a({polyphony:1/0,velocity:95}),this.audioKeys.down(this.keyPressed),this.audioKeys.up(this.keyReleased)},Ie=n(8),Re=n(739),je=function e(t){var n=this;if(Object(s.a)(this,e),this.opts=void 0,this.id=void 0,this.xx=0,this.yy=0,this.evts=[],this.headPlay=0,this.headRec=0,this.isActive=!1,this.isDial=!1,this.isRecording=!1,this.isMuted=!1,this.loaded=!1,this.pgControls=void 0,this.pgNotes=void 0,this.needsRenderControls=!1,this.needsRenderNotes=!1,this.save=function(){var e=n.id,t=n.isMuted,o=n.evts,i=n.opts,a={id:e,beats:i.beats,evts:o,isMuted:t};i.sketch.localStorage.setItem(e,JSON.stringify(a))},this.load=function(){var e=n.id,t=n.opts,o=t.sketch.localStorage.getItem(e);if(!o||""===o)return n.loaded=!1,!1;var i=JSON.parse(o);return t.beats=i.beats,n.evts=i.evts,n.evts.forEach((function(e){return e.evt.timestamp=0})),n.isMuted=i.isMuted,n.loaded=!0,!0},this.remove=function(){n.opts.sketch.localStorage.removeItem(n.id)},this.setRadius=function(e){e!==n.opts.radius&&(n.opts.radius=e,n.pgControls&&(n.needsRenderControls=!0),n.pgNotes&&(n.needsRenderNotes=!0))},this.loopLenMs=function(){return n.opts.beats*n.opts.sketch.beatMs()},this.loopUserEvent=function(e){var t=n.opts.sketch,o=t.offsetMs(),i=t.nowMs(),s=n.timeGlobalToLoopNorm(i+o),r={evt:e,loopTime:s},c=e.midiEvent,l=c.kind,u=c.note;if("noteoff"===l){var h,d=n.filterNote(n.attackEvents(),u),p=null,f=1,v=s+1,m=Object(a.a)(d);try{for(m.s();!(h=m.n()).done;){var y=h.value,b=v-(y.loopTime>s?y.loopTime:y.loopTime+1);b<f&&(f=b,p=y)}}catch(w){m.e(w)}finally{m.f()}return p?p.release=r:console.warn("[Loop #loopUserEvent] No attack event found for release",r),void(n.needsRenderNotes=!0)}"controlchange"!==l&&"pitchbend"!==l||(n.needsRenderControls=!0),"noteon"!==l&&"noteoff"!==l||(n.needsRenderNotes=!0),n.evts.push(r)},this.sanitizeEvents=function(){n.evts=n.evts.filter((function(e){return"noteon"!==e.evt.midiEvent.kind||e.release}))},this.updateClientId=function(e){var t,o=Object(a.a)(n.evts);try{for(o.s();!(t=o.n()).done;){var i=t.value;i.evt.clientId=e,i.release&&(i.release.evt.clientId=e)}}catch(s){o.e(s)}finally{o.f()}},this.attackEvents=function(){return n.evts.filter((function(e){return"noteon"===e.evt.midiEvent.kind}))},this.releaseEvents=function(){return n.evts.filter((function(e){return"noteoff"===e.evt.midiEvent.kind}))},this.controlEvents=function(){return n.evts.filter((function(e){return"controlchange"===e.evt.midiEvent.kind||"pitchbend"===e.evt.midiEvent.kind}))},this.sortByLoopTime=function(e){return e.sort((function(e,t){return e.loopTime>t.loopTime?1:-1}))},this.groupByController=function(e){var t,n={},o=Object(a.a)(e);try{for(o.s();!(t=o.n()).done;){var i=t.value,s=i.evt.midiEvent.controller,r=s?s.number:0;n[r]||(n[r]=[]),n[r].push(i)}}catch(c){o.e(c)}finally{o.f()}return n},this.filterNote=function(e,t){return e.filter((function(e){return e.evt.midiEvent.note===t}))},this.clearAllEvents=function(){n.evts=[],n.save(),n.pgControls&&(n.needsRenderControls=!0),n.pgNotes&&(n.needsRenderNotes=!0)},this.update=function(){var e=n.opts.sketch,t=e.nowMs(),o=e.offsetMs(),i=n.timeGlobalToLoopNorm(t),s=n.timeGlobalToLoopNorm(t+o),r=n.headRec;if(n.headPlay=i,n.headRec=s,!n.isMuted){var c,l=Object(a.a)(n.evts);try{for(l.s();!(c=l.n()).done;){var u=c.value,h=u.evt,d=u.loopTime,p=u.release,f=d;if(!(h.timestamp>t-e.beatMs()/2)&&(s<r&&(f<=s&&(f+=1),s+=1),r<f&&f<=s&&(e._sendUserEvent(Object(Ie.a)(Object(Ie.a)({},u.evt),{},{timestamp:n.timeLoopNormToGlobal(t+o,f)})),p))){var v=p.loopTime-d;v<=0&&(v+=1),e._sendUserEvent(Object(Ie.a)(Object(Ie.a)({},p.evt),{},{timestamp:n.timeLoopNormToGlobal(t+o,f+v)}))}}}catch(m){l.e(m)}finally{l.f()}}},this.recStartedAt=null,this.draw=function(e,t,o){var i=n.opts,a=i.beats,s=i.radius,r=n.isActive,c=n.isDial,l=n.isMuted,u=n.isRecording;n.xx=t,n.yy=o,u?(null===n.recStartedAt&&(n.recStartedAt=n.headRec),e.fill(30).stroke(255,0,0).strokeWeight(4)):(n.recStartedAt=null,e.fill(30).stroke(0).strokeWeight(2)),e.circle(n.xx,n.yy,2*s+(u?2:0));for(var h=0;h<a;h++){var d=h%4===0,p=0===h;e.stroke(p?180:d?130:80),e.strokeWeight(p?3:d?2:1);var f=h/a;n.drawLine(e,s,f)}n.drawEvents(e),l&&(e.fill(30,150).noStroke(),e.circle(n.xx,n.yy,2*s));var v=n.headPlay,m=n.headRec;if(c||u){var y=Math.ceil(v*a)%a/a,b=Math.ceil(m*a)%a/a,w=100;if(c&&(e.fill(0,200,0,60).noStroke(),n.drawArc(e,s,y),w=140),e.fill(180,0,0,w).noStroke(),m!==v){var g=u?s:.7*s;u&&null!==n.recStartedAt?n.drawArc(e,g,m,n.recStartedAt):n.drawArc(e,g,b,v)}}if(!r&&l||(l?e.stroke(100).strokeWeight(3):e.stroke(0,200,0).strokeWeight(3),n.drawLine(e,s,v)),c||r){e.stroke(200,0,0).strokeWeight(4);var k=u?s:.7*s;n.drawLine(e,k,m)}},this.drawEvents=function(e){n.isDial||(n.drawControls(e),n.drawNotes(e))},this.drawControls=function(e){var t=n.opts.radius;if(n.needsRenderControls){n.needsRenderControls=!1,n.pgControls||(n.pgControls=e.createGraphics(100,100));var o=[n.xx,n.yy],i=o[0],a=o[1];n.xx=t,n.yy=t,n.renderControls(),n.xx=i,n.yy=a}n.pgControls&&e.image(n.pgControls,n.xx-t,n.yy-t)},this.drawNotes=function(e){var t=n.opts.radius;if(n.needsRenderNotes){n.needsRenderNotes=!1,n.pgNotes||(n.pgNotes=e.createGraphics(100,100));var o=[n.xx,n.yy],i=o[0],a=o[1];n.xx=t,n.yy=t,n.renderNotes(),n.xx=i,n.yy=a}n.pgNotes&&e.image(n.pgNotes,n.xx-t,n.yy-t),n.isRecording&&n._drawNotes(e,!0)},this.drawLine=function(e,t,o){var i=2*Math.PI*o,a=n.xx+(t-2)*Math.sin(i),s=n.yy-(t-2)*Math.cos(i);e.line(n.xx,n.yy,a,s)},this.drawArc=function(e,t,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Math.PI*(2*o-.5),s=Math.PI*(2*i-.5);e.arc(n.xx,n.yy,2*t,2*t,s,a)},this.renderControls=function(){if(n.pgControls){var e=n.pgControls;e.clear();var t=n.groupByController(n.sortByLoopTime(n.controlEvents()));if(Object.keys(t).length){var o=n.opts.radius;for(var i in e.strokeWeight(2).noFill(),e.colorMode(e.HSL,1),t)for(var a=K(i),s=t[i].length,r=0;r<s;r++){var c=t[i][r],l=c.loopTime,u=c.evt,h=r===s-1?0:r+1,d=t[i][h].loopTime,p=u.midiEvent,f=p.kind,v=p.value,m=o*(.3+.65*("pitchbend"===f?v/2+.5:v));e.stroke(a.hue,a.sat,a.lgt),n.drawArc(e,m,d,l)}}}},this.renderNotes=function(){n.pgNotes&&(n.pgNotes.clear(),n._drawNotes(n.pgNotes))},this._drawNotes=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=12,i=n.opts.radius;e.strokeWeight(i/o).noFill(),e.colorMode(e.HSL,1);var s,r=Object(a.a)(n.attackEvents());try{for(r.s();!(s=r.n()).done;){var c=s.value,l=c.loopTime,u=c.evt,h=c.release,d=u.midiEvent,p=d.note,f=d.attack,v=n.headRec;if(h){if(t)continue;v=h.loopTime}var m=i*(.3+p%o*.7/o),y=p%12,b=D.includes(y)?.5+y/36:y/36,w=f?1-f:.5;w=1-w*w,e.stroke(b,w,.4),n.drawArc(e,m,v,l)}}catch(g){r.e(g)}finally{r.f()}e.colorMode(e.RGB,255)},this.timeGlobalToLoop=function(e){return(e-n.opts.sketch.downbeat)/n.loopLenMs()},this.timeGlobalToLoopNorm=function(e){var t=n.timeGlobalToLoop(e);return t-Math.floor(t)},this.timeLoopToGlobal=function(e){var t=n.opts.sketch,o=n.loopLenMs();return t.downbeat+e*o},this.timeLoopNormToGlobal=function(e,t){var o=n.loopLenMs();return n.timeLastLoopStartMs(e)+t*o},this.timeLastLoopStartMs=function(e){var t=n.opts.sketch,o=n.loopLenMs(),i=n.timeGlobalToLoop(e);return t.downbeat+Math.floor(i)*o},this.hitTest=function(e,t){var o=n.opts.radius;return!(e<n.xx-o||e>n.xx+o)&&!(t<n.yy-o||t>n.yy+o)},this.opts=t,t.id){if(this.id=t.id,this.load())return console.log("[Loop #ctor] Loaded loop ".concat(t.id," from local storage")),this.needsRenderControls=!0,void(this.needsRenderNotes=!0);console.error("[Loop #ctor] Failed to load loop ".concat(t.id," from local storage"))}else this.id=Object(Re.a)();t.isDial?this.isDial=!0:this.isActive=!0},Le=function e(t){var n=this;Object(s.a)(this,e),this.sketch=void 0,this.dial=void 0,this.loops=[],this.activeLoop=void 0,this.inputs={},this.recLock=!1,this.hidden=!1,this.hiddenDial=!1,this.saveLoopRefs=function(){var e=n.sketch.localStorage;e.setItem("activeLoop",n.activeLoop.id),e.setItem("loops",JSON.stringify(n.loops.map((function(e){return e.id}))))},this.load=function(){var e=n.sketch,t=e.localStorage,o=t.getItem("loops"),i={beats:8,radius:35,sketch:e},s=t.getItem("activeLoop"),r=null;if(o&&""!==o){var c,l=JSON.parse(o),u=Object(a.a)(l);try{for(u.s();!(c=u.n()).done;){var h=c.value,d=new je(Object(Ie.a)({id:h},i));d.loaded&&(n.loops.push(d),h===s&&(r=d))}}catch(p){u.e(p)}finally{u.f()}}return r?(n.activeLoop=r,r):(n.activeLoop=new je(i),n.loops.push(n.activeLoop),n.activeLoop)},this.update=function(){n.dial.update(),n.loops.forEach((function(e){return e.update()}))},this.draw=function(e){var t=n.activeLoop,o=n.didSetup,i=n.hidden,s=n.hiddenDial;i?o&&(n.inputs.loopLen.remove(),n.inputs.newLoopBtn.remove(),n.didSetup=!1):o||n.setupInputs(e);var r=n.inputs,c=r.loopLen,l=r.newLoopBtn,u=50,h=u+20,d=e.width-20;if(!i){t.isActive=!0,t.setRadius(u),t.isRecording=n.isRecording(e),d-=u+20,t.draw(e,d,h),e.fill(210).stroke(0).strokeWeight(1),e.textSize(14).textAlign(e.CENTER,e.TOP),e.text("Active loop: ".concat(c.value()," beats"),d,h+u+10),c.position(d-60,h+u+30);var p=Math.max(48,Math.floor(l.elt.offsetWidth/2));l.position(d-p,h+u+60),d-=u+20}if(s||(d-=(u=n.dial.opts.radius)+20,n.dial.draw(e,d,h),e.fill(210).stroke(0).strokeWeight(1),e.textSize(14).textAlign(e.CENTER,e.TOP),e.text("Metronome",d,h+u+10)),!i){var f=h=l.y+l.elt.offsetHeight+20;u=35,d=e.width-u-20;var v,m=Object(a.a)(n.inactiveLoops());try{for(m.s();!(v=m.n()).done;){var y=v.value;y.isActive=!1,y.setRadius(35),h+=u,y.draw(e,d,h),e.keyIsDown(16)&&(e.fill(50,150).noStroke(),e.circle(d,h,2*u),e.fill(200).textSize(12).textStyle(e.NORMAL).textAlign(e.CENTER,e.CENTER),e.text("Click to\ndelete",d,h)),(h+=u+20)>e.height-3*u&&(h=f,d-=2*u+20)}}catch(b){m.e(b)}finally{m.f()}}},this.didSetup=!1,this.setupInputs=function(e){n.didSetup=!0,n.inputs.loopLen=e.createSlider(1,64,n.activeLoop.opts.beats),n.inputs.newLoopBtn=e.createButton("Add new loop");var t=n.inputs,o=t.loopLen,i=t.newLoopBtn;o.size(120),o.input((function(){n.activeLoop.opts.beats=o.value(),n.activeLoop.save()})),i.mousePressed(n.addLoop)},this.dialBeats=function(e){return 4*Math.ceil((e+1)/4)},this.updateRecOffset=function(e){n.dial.opts.beats=n.dialBeats(e)},this.loopUserEvent=function(e){n.activeLoop.loopUserEvent(e)},this.clearAll=function(){n.loops.forEach((function(e){return e.clearAllEvents()}))},this.clearActiveLoop=function(){n.activeLoop.clearAllEvents()},this.updateClientId=function(e){n.loops.forEach((function(t){return t.updateClientId(e)}))},this.toggleActiveLoopMute=function(){var e=n.activeLoop;e.isMuted=!e.isMuted,e.save()},this.muteAll=function(){var e,t=Object(a.a)(n.loops);try{for(t.s();!(e=t.n()).done;){var o=e.value;o.isMuted||(o.isMuted=!0,o.save())}}catch(i){t.e(i)}finally{t.f()}},this.toggleHide=function(){return n.hidden=!n.hidden},this.toggleHideText=function(){return n.hidden?"Show Loops":"Hide Loops"},this.toggleHideDial=function(){return n.hiddenDial=!n.hiddenDial},this.toggleHideDialText=function(){return n.hiddenDial?"Show Metronome":"Hide Metronome"},this.stopRecording=function(){n.activeLoop.sanitizeEvents(),n.activeLoop.save()},this.addLoop=function(){n.activeLoop=new je({beats:n.inputs.loopLen.value(),radius:50,sketch:n.sketch}),n.loops.push(n.activeLoop),n.saveLoopRefs()},this.inactiveLoops=function(){return n.loops.filter((function(e){return e!==n.activeLoop}))},this.mousePressed=function(e){var t,o=!1,i=Object(a.a)(n.inactiveLoops());try{var s=function(){var i=t.value;if(i.hitTest(e.mouseX,e.mouseY))return o=!0,e.keyIsDown(16)?(i.remove(),n.loops=n.loops.filter((function(e){return e!==i})),"break"):(n.activateLoop(i),"break")};for(i.s();!(t=i.n()).done;){if("break"===s())break}}catch(r){i.e(r)}finally{i.f()}o&&n.saveLoopRefs()},this.activateLoop=function(e){n.inputs.loopLen.value(e.opts.beats),n.activeLoop.isActive=!1,n.activeLoop=e,e.isActive=!0},this.keyPressed=function(e){if(8!==e.keyCode&&46!==e.keyCode){if(13===e.keyCode||3===e.keyCode)return n.recLock=!n.recLock,void(n.recLock||n.stopRecording());switch(e.key){case"\\":case"|":case"m":return void(e.keyIsDown(17)?n.muteAll():n.toggleActiveLoopMute());case"[":case",":return n.activatePrev();case"]":case".":return n.activateNext()}}else n.clearActiveLoop()},this.activatePrev=function(){for(var e=n.loops,t=0;t<e.length;t++)if(e[t]===n.activeLoop)return void(0===t?n.activateLoop(e[e.length-1]):n.activateLoop(e[t-1]))},this.activateNext=function(){for(var e=n.loops,t=0;t<e.length;t++)if(e[t]===n.activeLoop)return void(t===e.length-1?n.activateLoop(e[0]):n.activateLoop(e[t+1]))},this.keyReleased=function(e){16===e.keyCode&&n.stopRecording()},this.isRecording=function(e){return n.recLock||!!e&&e.keyIsDown(16)},this.sketch=t.sketch,this.dial=new je({beats:this.dialBeats(t.recOffset),radius:50,sketch:t.sketch,isDial:!0}),this.activeLoop=this.load()},Te=function(e){if(0===e)return new h(1e3,31,1e3);var t=function(){return Math.random()-.5};return new h(1e3*t()/2,31,1e3*t()/2)};var De=new function e(t){var n=this;Object(s.a)(this,e),this.width=0,this.height=0,this.started=!1,this.syncing=!0,this.downbeat=r.now(),this.transportStarted=!1,this._bpm=95,this._bpmNext=95,this.bgCol={hue:.5,sat:0,lgt:.2},this.localStorage=void 0,this.ws=void 0,this.midi=void 0,this.audioKeys=void 0,this.instruments=void 0,this.instSliders=new Q,this.inputs=void 0,this.loops=void 0,this.user={clientId:0,name:"",instrument:"dancer",inputDevice:"keyboard",offset:2},this.users=[],this.avatar=void 0,this.avatars=[],this.pp=void 0,this.pg=void 0,this.backbuffer=void 0,this.cam=void 0,this.ground=new T({pos:new h(0,-1,0),scale:new h(1e3)}),this.blackHole=new L,this.loadFromStorage=function(){var e=n.localStorage.getItem("user");return e&&""!==e?(n.user=JSON.parse(e),!0):(console.error("No stored user"),!1)},this.destroy=function(){n.ws.conn.close(888,"sketch destroyed")},this.timeGlobalToTone=function(e){var t=r.context.rawContext._nativeAudioContext.getOutputTimestamp(),o=t.contextTime,i=t.performanceTime;return o+(n.ws.clock.toLocal(e)-i)/1e3},this.timeToneToGlobal=function(e){var t=r.context.rawContext._nativeAudioContext.getOutputTimestamp(),o=t.contextTime,i=t.performanceTime+1e3*(e-o);return n.ws.clock.toGlobal(i)},this.setSize=function(e,t){n.width=e,n.height=t},this.shaderBlackHole=void 0,this.sketch=function(e){n.pp=e,e.pixelDensity(1),e.preload=function(){n.shaderBlackHole=e.loadShader("/shaders/simple.vert","/shaders/blackHole.frag")},e.setup=function(){return n.setup(e)},e.draw=function(){return n.draw(e)},e.mousePressed=function(){return n.mousePressed(e)},e.mouseReleased=function(){return n.mouseReleased(e)},e.keyPressed=function(){return n.keyPressed(e)},e.keyReleased=function(){return n.keyReleased(e)}},this.setup=function(e){console.log("[Sketch #setup] ".concat(n.width," x ").concat(n.height)),e.createCanvas(n.width,n.height),n.pg=e.createGraphics(n.width,n.height,"webgl"),n.pg.textureWrap(e.REPEAT);var t,o=(t=n.width,1<<31-Math.clz32(t));n.backbuffer=e.createGraphics(o,o,e.WEBGL),console.log("bbsize",o,n.backbuffer.width,n.backbuffer.height),n.cam=new ye(n.pg._renderer,{distance:100}),n.cam.setDistanceMin(40),n.cam.setDistanceMax(3e3),n.cam.rotateX(-Math.PI/8),n.cam.attachMouseListeners(e._renderer),n.cam.setViewport([0,0,n.width,n.height]),n.cam.rotateZ(Math.PI),n.avatar.addFollowCam(n.cam),n.inputs.setup(e)},this.draw=function(e){n.instSliders.update(e),n.loops.update(),m.update(),e.colorMode(e.HSL,1).background(n.bgCol.hue,n.bgCol.sat,n.bgCol.lgt,.3).colorMode(e.RGB,255);var t=n.pg;if(t){t.perspective(Math.PI/3,t.width/t.height,1,1e4),t.clear(),m.draw(t),e.image(t,0,0);var o=n.backbuffer;if(o){var i=o.width,a=o.height;o.image(t,-i/2,-a/2,i,a)}n.inputs.help||m.draw2D(e,t)}if(n.inputs.draw(e),n.inputs.hidden||n.instSliders.draw(e),n.loops.draw(e),!n.inputs.help){var s=!1;for(var r in n.instruments)if(!n.instruments[r].loaded()){s=!0;break}s?n.drawMessage(e,"Loading instruments..."):n.syncing&&n.drawMessage(e,"Syncing clock with server...")}},this.drawMessage=function(e,t){e.fill(200),e.strokeWeight(0),e.textSize(20),e.textAlign(e.CENTER,e.CENTER),e.textStyle(e.BOLDITALIC),e.text(t,e.width/2,e.height/2)},this.mousePressed=function(e){n.started||(n.started=!0,r.start(),console.log("[Sketch #mousePressed] Started Tone")),n.instSliders.mousePressed(e)||n.loops.mousePressed(e)},this.mouseReleased=function(e){n.instSliders.mouseReleased(e)},this.keyboardInputDisabled=function(){return n.inputs.isFocused()},this.keyPressed=function(e){n.keyboardInputDisabled()||(e.keyIsDown(27)?n.inputs.toggleHelp():(n.avatar.keyPressed(e),n.loops.keyPressed(e),n.inputs.keyPressed(e)))},this.keyReleased=function(e){n.keyboardInputDisabled()||(n.avatar.keyReleased(e),n.loops.keyReleased(e))},this.updateUser=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(n.user=Object.assign(n.user,e),n.localStorage.setItem("user",JSON.stringify(n.user)),t&&n.sendUserUpdate(),e.instrument){var o=n.instruments[e.instrument];n.instSliders=o.ctrls}},this.getUser=function(e){if(e===n.user.clientId)return n.user;var t,o=Object(a.a)(n.users);try{for(o.s();!(t=o.n()).done;){var i=t.value;if(e===i.clientId)return i}}catch(s){o.e(s)}finally{o.f()}return n.user},this.getAvatar=function(e){if(e===n.user.clientId)return n.avatar;var t,o=Object(a.a)(n.avatars);try{for(o.s();!(t=o.n()).done;){var i=t.value;if(e===i.user.clientId)return i}}catch(s){o.e(s)}finally{o.f()}return null},this.getAvatarSafe=function(e){var t=n.getAvatar(e);return t||(console.warn("[Sketch #getAvatarSafe] Can't find avatar for client",e),n.avatar)},this.sendUserUpdate=function(){var e=n.ws,t=e.conn;(0,e.ready)()?t.send(Object(P.p)(n.user)):console.warn("[Sketch #sendUserUpdate] Can't send user update, websocket connection is not open")},this.sendUserXform=function(e){var t=n.ws,o=t.conn;(0,t.ready)()?o.send(Object(P.q)(e)):console.warn("[Sketch #sendUserXform] Can't send user xform, websocket connection is not open")},this.sendUserRequestXforms=function(){var e=n.ws,t=e.conn;(0,e.ready)()?t.send(Object(P.o)()):console.warn("[Sketch #sendUserRequestXforms] Can't request other users' xforms, websocket connection is not open")},this.sendUserEvent=function(e,t,o){var i=n.user.instrument;if(o.controller)switch(o.controller.number){case 79:r.Destination.volume.value=50*(o.value-1);case 19:return void(r.Destination.mute=!o.value);case 117:return void(o.value&&(n.loops.recLock=!n.loops.recLock));case 18:case 78:i="metronome";break;case 17:case 77:i="synth";break;case 16:case 76:i="eightOhEight";break;case 15:case 75:i="piano"}var a=n.offsetMs(),s={clientId:n.user.clientId,instrument:i,midiEvent:o,timestamp:n.nowMs()+a};n.loops.isRecording(n.pp)&&n.loops.loopUserEvent(s),n._sendUserEvent(s)},this._sendUserEvent=function(e){var t=n.ws,o=t.conn;(0,t.ready)()?o.send(Object(P.n)(e)):n.onUserEvent(e)},this.onUserEvent=function(e){var t=e.clientId,o=e.instrument,i=e.midiEvent,a=e.timestamp,s=i.data,c=i.channel,l=i.kind,u=n.instruments[o];if(u){if(u.loaded()){var h="metronome"===o;if(!h||!n.syncing){var d=n.timeGlobalToTone(a);if(!(d<0))if(d-r.immediate()<-1)console.log("[Sketch #onUserEvent] Received event ".concat(r.immediate()-d," seconds late"));else{var p=n.getAvatarSafe(t);switch(l){case"noteon":var f=i;u.noteon(p,d,f),h&&n.onMetronome(d,f.note);break;case"noteoff":var v=i;u.noteoff(p,d,v);break;case"controlchange":var m=i;u.controlchange(p,d,m);break;case"pitchbend":var y=i;u.pitchbend(p,d,y);break;default:console.warn("[Sketch #onUserEvent] Unhandled MIDI event on channel ".concat(c,":"),l,s,e)}}}}}else console.error("[Sketch #onUserEvent] Unable to find instrument",o)},this.onMetronome=function(e,t){if(!n.transportStarted&&t===U.b)return console.log("[Sketch #onUserEvent] Downbeat synced with server. BPM:",n._bpmNext),n.transportStarted=!0,void n.setNewDownbeat(e);t===U.a&&(console.log("[Sketch #onUserEvent] Received new downbeat from server, will update clock in ".concat((e-r.immediate()).toFixed(1)," seconds")),r.Draw.schedule((function(){console.log("[Sketch #onUserEvent] BPM updated:",n._bpmNext),n.setNewDownbeat(e)}),e))},this.setNewDownbeat=function(e){n.downbeat=n.timeToneToGlobal(e),n._bpm=n._bpmNext,n.inputs.onClockUpdate({bpm:n._bpm,clientId:0}),r.Transport.bpm.value=n._bpm},this.onUsers=function(e){var t,o=Object(a.a)(e);try{var i=function(){var e=t.value;if(e.clientId===n.user.clientId)return"continue";var o=n.users.filter((function(t){return t.clientId===e.clientId}));if(!o.length)return n.users.push(e),n.avatars.push(new j({user:e,pos:Te(e.clientId),scale:new h(20),phys:{worldScale:1e3}})),"continue";o.length>1&&console.warn("[Sketch #onUsers] Found more than one user for clientId #".concat(e.clientId),e.clientId,e.name);var i=o[0];Object.assign(i,e)};for(o.s();!(t=o.n()).done;)i()}catch(l){o.e(l)}finally{o.f()}var s,r=Object(a.a)(n.users);try{var c=function(){var t=s.value;if(e.some((function(e){return e.clientId===t.clientId})))return"continue";var o=n.getAvatar(t.clientId);o?m.rmObj(o):console.warn("[Sketch #onUsers] Unable to find avatar for dropped user #".concat(t.clientId),t.name),n.users=n.users.filter((function(e){return e.clientId!==t.clientId})),n.avatars=n.avatars.filter((function(e){return e.user.clientId!==t.clientId}))};for(r.s();!(s=r.n()).done;)c()}catch(l){r.e(l)}finally{r.f()}},this.onUserForce=function(e){var t=e.clientId,o=n.getAvatar(t);o?o.setUserForce(e):console.warn("[Sketch #onUserForce] No avatar for user",t)},this.onUserXform=function(e){var t=e.clientId,o=n.getAvatar(t);o?o.setUserXform(e):console.warn("[Sketch #onUserXform] No avatar for user",t)},this.bpm=function(){return n.transportStarted?n._bpm:n.inputs.bpm()},this.bps=function(){return n.bpm()/60},this.beatMs=function(){return 1e3/n.bps()},this.beatSec=function(){return 1/n.bps()},this.offsetMs=function(){return n.beatMs()*n.user.offset},this.offsetSec=function(){return n.beatSec()*n.user.offset},this.nowMs=function(){return n.ws.now()},console.log("[Sketch #ctor]"),this.localStorage=t.localStorage;var o=this.loadFromStorage();this.inputs=new Se(o),this.loops=new Le({sketch:this,recOffset:this.user.offset}),this.avatar=new j({user:this.user,pos:Te(1),scale:new h(30),phys:{worldScale:1e3},onForce:this.sendUserXform}),this.ws=new F(window,{clock:{onSynced:function(){n.syncing=!1,n.transportStarted=!1,n.inputs.setupInputsBPM()}},onClientId:function(e){n.user.clientId=e,n.inputs.setupInputsUser(e),n.loops.updateClientId(e),n.sendUserUpdate(),n.sendUserXform(n.avatar.getUserXform()),n.sendUserRequestXforms()},onClockUpdate:function(e){0===e.clientId?n._bpmNext=e.bpm:n.inputs.onClockUpdate(e)},onUsers:this.onUsers,onUserEvent:this.onUserEvent,onUserForce:this.onUserForce,onUserXform:this.onUserXform,onUserRequestXforms:function(){return n.sendUserXform(n.avatar.getUserXform())}}),this.instruments={dancer:new oe,polysquare:new pe,blackHole:new te,hoover:new re,eightOhEight:new se(this),piano:new de,metronome:new ue(this)},this.midi=new q({onEnabled:this.inputs.setupInputsMidi,onMessage:this.sendUserEvent}),this.audioKeys=new Ae(this),window.Tone=r,window.me=this}(window),Ne=function(){var e=Object(o.useRef)(null),t=Object(o.useRef)("Loading");return Object(o.useEffect)((function(){if(!e.current)return t.current="Internal component error",void console.warn("[VideoOutput #useEffect] Can't find component reference");var n=e.current;n.childNodes[0]&&n.removeChild(n.childNodes[0]);var o=n.clientWidth,i=n.clientHeight;De.setSize(o,i);var a=new window.p5(De.sketch,n);return function(){De.destroy(),a.remove(),console.log("[VideoOutput #useEffect.return]")}})),i.a.createElement("div",{ref:e,style:{display:"flex",flex:1,alignItems:"center",justifyContent:"center",color:"white"}},t.current)};n(736),t.default=function(){return i.a.createElement("div",{className:"App",style:{display:"flex",flexDirection:"column",position:"absolute",backgroundColor:"#383838",top:0,left:0,right:0,bottom:0}},i.a.createElement(Ne,null))}}},[[705,1,2]]]);
//# sourceMappingURL=main.2c673dbb.chunk.js.map