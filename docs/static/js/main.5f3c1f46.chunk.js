(this["webpackJsonpthump-web-client"]=this["webpackJsonpthump-web-client"]||[]).push([[0],{23:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return a})),n.d(e,"h",(function(){return s})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return u})),n.d(e,"g",(function(){return l})),n.d(e,"l",(function(){return d})),n.d(e,"i",(function(){return h})),n.d(e,"j",(function(){return p})),n.d(e,"k",(function(){return f})),n.d(e,"n",(function(){return m})),n.d(e,"m",(function(){return v})),n.d(e,"o",(function(){return y}));var o="wss://thumpy.space/api",i="#",a="client/id";function s(t){return JSON.parse(t).clientId}var r="user/all",c="user/event",u="user/force",l="user/xform";function d(t){return JSON.parse(t)}function h(t){return JSON.parse(t)}function p(t){return JSON.parse(t)}function f(t){return JSON.parse(t)}function m(t){return"user/update"+i+JSON.stringify(t)}function v(t){return c+i+JSON.stringify(t)}function y(t){return l+i+JSON.stringify(t)}},35:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return u}));var o=n(23),i="clock/now",a="clock/origin",s="clock/update",r=function(){return i+o.b},c=function(t){return s+o.b+JSON.stringify(t)};function u(t){return JSON.parse(t)}},67:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return s}));var o=n(0),i=n(1),a=n(35),s=function(){function e(t,n){var i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(o.a)(this,e),this.global=void 0,this.conn=void 0,this.localOrigin=void 0,this.correction=0,this.precision=0,this.correction2=0,this.precision2=0,this.lowpass=.3,this.lastReqAt=0,this.lastRespAt=0,this.loopId=-1,this.syncInitial=0,this.serverOrigin=0,this.precisionNow=0,this.syncPeriod=500,this.synced=!1,this.options=void 0,this.update=function(){i.conn.readyState===WebSocket.OPEN?(i.lastReqAt=i.nowRaw(),i.conn.send(Object(a.d)())):i.global.clearTimeout(i.loopId)},this.global=t,this.options=s,this.localOrigin=t.performance.timeOrigin,this.conn=n,this.loopId=t.setInterval(this.update,this.syncPeriod)}return Object(i.a)(e,[{key:"nowRaw",value:function(){return t.performance.now()}},{key:"onClockOrigin",value:function(t){var e=JSON.parse(t).originMs;e?this.serverOrigin=e:console.error("[workerClock #onClockOrigin] Received empty response")}},{key:"onClockNow",value:function(t){var e=(JSON.parse(t)||{}).nowMs;if(e){this.lastRespAt=this.nowRaw();var n=this.lastRespAt-this.lastReqAt,o=e-(n/2+this.lastReqAt);0===this.correction?this.correction=o:this.correction=o*this.lowpass+this.correction*(1-this.lowpass);var i=o-this.correction;0===this.precision?this.precision=i:this.precision=i*this.lowpass+this.precision*(1-this.lowpass),this.correction2=this.precision*this.lowpass+this.correction2*(1-this.lowpass);var a=o-this.correction-this.correction2;0===this.precision2?this.precision2=a:this.precision2=a*this.lowpass+this.precision2*(1-this.lowpass);var s=this.now()-n/2-e;this.precisionNow=s*this.lowpass+this.precisionNow*(1-this.lowpass),!this.synced&&this.syncInitial++>6&&(this.synced=!0,this.global.clearTimeout(this.loopId),this.correction+=this.correction2,this.syncPeriod=2e3,this.loopId=this.global.setInterval(this.update,this.syncPeriod),this.options.onSynced&&this.options.onSynced())}else console.error("[workerClock #onClockNow] Received empty response")}},{key:"now",value:function(){var t=this.nowRaw(),e=1+(t-this.lastRespAt)/this.syncPeriod;return t+this.correction+this.correction2*e}},{key:"toGlobal",value:function(t){return t+this.correction+this.correction2}},{key:"toLocal",value:function(t){return t-this.correction-this.correction2}}]),e}()}).call(this,n(717))},701:function(t,e,n){t.exports=n(702)},702:function(t,e,n){"use strict";n.r(e);var o=n(29),i=n.n(o),a=n(539),s=n.n(a);n(707);!function(){var t=n(725).default;s.a.render(i.a.createElement(t,null),document.getElementById("root"))}()},707:function(t,e,n){},724:function(t,e,n){},725:function(t,e,n){"use strict";n.r(e);var o=n(29),i=n.n(o),a=n(11),s=n(0),r=n(16),c=n(12),u=n(23),l=n(35),d=n(67),h=function t(e,n){var o=this;Object(s.a)(this,t),this.conn=void 0,this.clock=void 0,this.global=void 0,this.options=void 0,this.clientId=0,this.users=[],this.reopen=function(){o.conn.readyState===WebSocket.CLOSED&&(o.conn=o.newConn())},this.ready=function(){return o.conn&&o.conn.readyState===WebSocket.OPEN},this.newConn=function(){var t=new WebSocket(u.c);return t.onclose=function(t){888!==t.code?(console.warn("WebSocket closed, will attempt to reopen in a few seconds",t),setTimeout(o.reopen,5e3)):console.warn("Closing for good",t)},t.onopen=function(t){console.log("WebSocket opened",t),o.clock=new d.a(o.global,o.conn,o.options.clock)},t.onerror=function(t){console.error("WebSocket error",t)},t.onmessage=o.onMessage,t},this.onMessage=function(t){var e=function(t,e,n){var o=[],i=new RegExp(e,"g");for(;n--;){var a=i.lastIndex,s=i.exec(t);if(!s)break;o.push(t.slice(a,s.index))}return o.push(t.slice(i.lastIndex)),o}(t.data,u.b,1),n=Object(c.a)(e,2),i=n[0],a=n[1];switch(i){case l.a:case l.b:if(!o.clock)return void console.error("[WSClient #onMessage] No local clock ready to handle server clock message");i===l.b?o.clock.onClockOrigin(a):o.clock.onClockNow(a);break;case l.c:var s=Object(l.f)(a);o.options.onClockUpdate(s),console.log("[WSClient #onMessage] Received clockUpdate",s);break;case u.a:o.clientId=Object(u.h)(a),console.log("[WSClient #onMessage] Received clientId",o.clientId),o.options.onClientId(o.clientId);break;case u.d:o.users=Object(u.l)(a).filter((function(t){return!!t})),console.log("[WSClient #onMessage] Received users",o.users),o.options.onUsers(o.users);break;case u.e:var r=Object(u.i)(a);o.options.onUserEvent(r);break;case u.f:var d=Object(u.j)(a);o.options.onUserForce(d);break;case u.g:var h=Object(u.k)(a);o.options.onUserXform(h);break;default:console.log("[WSClient #onMessage] Unhandled message",{head:i,body:a,parts:e},t)}},this.now=function(){return o.clock?o.clock.now():(console.error("[WSClient #now] No clock!"),-1)},this.getUser=function(t){var e,n=Object(a.a)(o.users);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.clientId===t)return i}}catch(s){n.e(s)}finally{n.f()}},this.global=e,this.options=n,this.conn=this.newConn(),this.clock=new d.a(this.global,this.conn,this.options.clock)};var p=n(7),f=n.n(p),m=n(9),v=n(13);function y(t){return{data:t.data,channel:t.target.number,kind:t.type,attack:t.attack,note:t.note&&t.note._number,release:t.release,value:t.value,controller:t.controller}}var w=Object(v.a)(Array(16).keys()).map((function(t){return t+1})),b=["controlchange","noteoff","noteon","pitchbend"],g=function t(e){var n=this;Object(s.a)(this,t),this.webMidi=null,this.enabled=!1,this.enable=function(){var t=Object(m.a)(f.a.mark((function t(e){var o,i,s,r,c,u,l,d,h,p;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.onMessage,i=e.onEnabled,s=window,r=s.WebMidi,t.prev=2,t.next=5,r.enable();case 5:t.next=11;break;case 7:return t.prev=7,t.t0=t.catch(2),console.error("[MIDI #enable] Failed to enable MIDI",t.t0),t.abrupt("return");case 11:n.webMidi=r,n.enabled=!0,c=n.webMidi,u=c.inputs,l=c.outputs,console.log("[MIDI #enable] inputs",u),console.log("[MIDI #enable] outputs",l),i&&i(n.webMidi),d=Object(a.a)(u);try{for(p=function(){var t,e=h.value,n=Object(a.a)(b);try{var i=function(){var n=t.value;e.addListener(n,(function(t){return o(e.name,n,y(t))}),{channels:w})};for(n.s();!(t=n.n()).done;)i()}catch(s){n.e(s)}finally{n.f()}},d.s();!(h=d.n()).done;)p()}catch(f){d.e(f)}finally{d.f()}case 19:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e){return t.apply(this,arguments)}}(),this.enable(e)},k=n(1),x=n(3),O=n(2),S=function(){function t(){Object(s.a)(this,t)}return Object(k.a)(t,[{key:"loaded",value:function(){return!1}},{key:"noteon",value:function(t,e,n){}},{key:"noteoff",value:function(t,e,n){}},{key:"controlchange",value:function(t,e,n){}},{key:"pitchbend",value:function(t,e,n){}}]),t}();function I(t){return r.Frequency(t,"midi").toFrequency()}var A=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this)).sampler=void 0,o.pitchShift=void 0,o.panVol=void 0,o.ps=0,o.psSpread=7,o.noteon=function(t,e,n){o.sampler.triggerAttack(I(n.note),e,n.attack)},o.noteoff=function(t,e,n){o.sampler.triggerRelease(I(n.note),e)},o.controlchange=function(t,e,n){var i=n.controller.number,a=null;switch(!0){case 1===i:a=function(){o.psSpread=12*n.value,o.pitchShift.pitch=o.ps*o.psSpread};break;case 75<=i&&i<=79:a=function(){o.panVol.mute=!n.value,o.panVol.volume.value=50*(n.value-1)};break;case 15<=i&&i<=19:a=function(){o.panVol.mute=!n.value};break;case 28===i:a=function(){o.panVol.pan.value=2*n.value-1};break;default:console.log("[Sampler #controlchange] Unsupported CC event on channel ".concat(n.channel,":"),n.controller,n.value)}a&&r.Draw.schedule(a,e)},o.pitchbend=function(t,e,n){r.Draw.schedule((function(){o.ps=n.value,o.pitchShift.pitch=o.ps*o.psSpread}),e)},o.panVol=new r.PanVol(0,0).toDestination(),o.pitchShift=(new r.PitchShift).connect(o.panVol),o.sampler=t.connect(o.pitchShift),o}return Object(k.a)(n,[{key:"loaded",value:function(){return this.sampler.loaded}}]),n}(S),M=["BD0010.WAV","BD0050.WAV","SD7510.WAV","CP.WAV","CH.WAV","OH10.WAV","LT00.WAV","MT00.WAV","HT00.WAV","LC00.WAV","MC00.WAV","HC00.WAV","CB.WAV","CY0075.WAV","MA.WAV","RS.WAV"];var C=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,function(){for(var t={},e=0;e<M.length;++e)t[e]=M[e%M.length];return new r.Sampler({urls:t,release:1,baseUrl:"/samples/808/"})}())).sketch=void 0,o.noteon=function(t,e,n){var i=o.modNote(n.note);o.sampler.triggerAttack(I(i),e,n.attack)},o.noteoff=function(t,e,n){var i=o.modNote(n.note);o.sampler.triggerRelease(I(i),e)},o.sketch=t,o}return Object(k.a)(n,[{key:"modNote",value:function(t){return(t+12)%M.length}}]),n}(A),R=["MA.WAV","RS.WAV"];var T=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,function(){for(var t={},e=0;e<R.length;++e)t[e]=R[e%R.length];return new r.Sampler({urls:t,release:1,baseUrl:"/samples/808/"})}())).sketch=void 0,o.noteon=function(t,e,n){var i=o.modNote(n.note);o.sampler.triggerAttack(I(i),e,n.attack),i%R.length===0?r.Draw.schedule((function(){o.sketch.ground.hue=Math.random(),o.sketch.ground.sat=.4*Math.random()+.5}),e):r.Draw.schedule((function(){o.sketch.bgCol.hue=Math.random(),o.sketch.bgCol.sat=.4*Math.random()+.5}),e)},o.noteoff=function(t,e,n){var i=o.modNote(n.note);o.sampler.triggerRelease(I(i),e)},o.sketch=t,o.panVol.set({volume:-10}),o.panVol.mute=!0,o}return Object(k.a)(n,[{key:"modNote",value:function(t){return t%R.length}}]),n}(A),j={A0:"A0.mp3",C1:"C1.mp3","D#1":"Ds1.mp3","F#1":"Fs1.mp3",A1:"A1.mp3",C2:"C2.mp3","D#2":"Ds2.mp3","F#2":"Fs2.mp3",A2:"A2.mp3",C3:"C3.mp3","D#3":"Ds3.mp3","F#3":"Fs3.mp3",A3:"A3.mp3",C4:"C4.mp3","D#4":"Ds4.mp3","F#4":"Fs4.mp3",A4:"A4.mp3",C5:"C5.mp3","D#5":"Ds5.mp3","F#5":"Fs5.mp3",A5:"A5.mp3",C6:"C6.mp3","D#6":"Ds6.mp3","F#6":"Fs6.mp3",A6:"A6.mp3",C7:"C7.mp3","D#7":"Ds7.mp3","F#7":"Fs7.mp3",A7:"A7.mp3",C8:"C8.mp3"};var D=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(){return Object(s.a)(this,n),e.call(this,new r.Sampler({urls:j,release:1,baseUrl:"https://tonejs.github.io/audio/salamander/"}))}return n}(A),U=n(28),N=n(6),z=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(){var t;Object(s.a)(this,n),(t=e.call(this)).w=0,t.clone=function(){return new n(t.x,t.y,t.z)},t.cloneMult=function(e){return t.clone().applyMult(e)},t.cloneAdd=function(e){return t.clone().applyAdd(e)},t.cloneSub=function(e){return t.clone().applySub(e)},t.isZero=function(){return 0===t.x&&0===t.y&&0===t.z},t.isOne=function(){return 1===t.x&&1===t.y&&1===t.z},t.isEqual=function(e){return t.x===e.x&&t.y===e.y&&t.z===e.z},t.normalize=function(){return t.applyMult(1/t.mag())},t.toArray=function(){return[t.x,t.y,t.z]},t.setFromArray=function(e){return t.x=e.length>0?e[0]:0,t.y=e.length>1?e[1]:t.x,t.z=e.length>2?e[2]:2===e.length?0:t.x,Object(N.a)(t)},t.applyMult=function(e){return e instanceof n?(t.x*=e.x,t.y*=e.y,t.z*=e.z,Object(N.a)(t)):(t.x*=e,t.y*=e,t.z*=e,Object(N.a)(t))},t.applyAdd=function(e){return e instanceof n?(t.x+=e.x,t.y+=e.y,t.z+=e.z,Object(N.a)(t)):(t.x+=e,t.y+=e,t.z+=e,Object(N.a)(t))},t.applySub=function(e){return e instanceof n?(t.x-=e.x,t.y-=e.y,t.z-=e.z,Object(N.a)(t)):(t.x-=e,t.y-=e,t.z-=e,Object(N.a)(t))},t.cloneMultMat=function(e){if(!e.length||16!==e.length)return console.error("[Vec #applyMult] invalid matrix provided for mult",e),t.clone();var o=new n;return o.x=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12],o.y=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13],o.z=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14],o.w=e[3]*t.x+e[7]*t.y+e[11]*t.z+e[15],Math.abs(o.w)>Number.EPSILON&&o.applyMult(1/o.w),o};for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return t.setFromArray(i),t}return n}(window.p5.Vector),P=function t(e,n){var o=this;Object(s.a)(this,t),this.min=new z(-1),this.max=new z(1),this.clone=function(){return new t(o.min.clone(),o.max.clone())},this.cloneXform=function(t){return o.clone().applyXform(t)},this.applyXform=function(t){return t.applyTo(o.min),t.applyTo(o.max),o.sanitize(),o},this.sanitize=function(){if(o.min.x>o.max.x){var t=o.min.x;o.min.x=o.max.x,o.max.x=t}if(o.min.y>o.max.y){var e=o.min.y;o.min.y=o.max.y,o.max.y=e}if(o.min.z>o.max.z){var n=o.min.z;o.min.z=o.max.z,o.max.z=n}return o},this.pushInside=function(t){var e=new z;return o.min.x<t.min.x?e.x=t.min.x-o.min.x:o.max.x>t.max.x&&(e.x=t.max.x-o.max.x),o.min.y<t.min.y?e.y=t.min.y-o.min.y:o.max.y>t.max.y&&(e.y=t.max.y-o.max.y),o.min.z<t.min.z?e.z=t.min.z-o.min.z:o.max.z>t.max.z&&(e.z=t.max.z-o.max.z),e},this.centerAndSize=function(){return{center:new z((o.max.x+o.min.x)/2,(o.max.y+o.min.y)/2,(o.max.z+o.min.z)/2),size:new z(o.max.x-o.min.x,o.max.y-o.min.y,o.max.z-o.min.z)}},e&&(this.min=e),n&&(this.max=n)},E=function t(e,n,o){var i=this;Object(s.a)(this,t),this.pos=void 0,this.rot=void 0,this.scale=void 0,this.applyTo=function(t){t.applyMult(i.scale),t.applyAdd(i.pos)},this.pos=e||new z,this.rot=n||new z,this.scale=o||new z(1)},_=function(){function t(e){Object(s.a)(this,t),this.parent=void 0,this.drawDebug=void 0,this.parent=e}return Object(k.a)(t,[{key:"destroy",value:function(){console.log("[Component] destroyed")}},{key:"update",value:function(t){console.warn("[Component] update")}}]),t}(),F=new function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t),this.objs=[],this.debug=!1,this.lastUpdate=void 0,this.addObj=function(t){return e.objs.push(t)},this.rmObj=function(t){e.objs=e.objs.filter((function(e){return e!==t||(e.destroy(),!1)}))},this.update=function(){if(e.lastUpdate){var t=(new Date).valueOf(),n=(t-e.lastUpdate)/1e3;e.lastUpdate=t,e.objs.forEach((function(t){return t.update(n)}))}else e.lastUpdate=(new Date).valueOf()},this.draw=function(t){var n,o=Object(a.a)(e.objs);try{for(o.s();!(n=o.n()).done;){var i=n.value;i.draw(t),e.debug&&i.drawDebug(t)}}catch(s){o.e(s)}finally{o.f()}},this.draw2D=function(t,n){var o,i=n,s=i._renderer.uMVMatrix.copy().mult(i._renderer.uPMatrix),r=Object(a.a)(e.objs);try{for(r.s();!(o=r.n()).done;){o.value.draw2D(t,n,s.mat4)}}catch(c){r.e(c)}finally{r.f()}},n.debug&&(this.debug=!0)}({debug:!1}),L=function(){function t(e){var n=this;Object(s.a)(this,t),this.comps=[],this.xform=new E,this.drawFunc=void 0,this.drawFunc2D=void 0,this.destroy=function(){n.comps.forEach((function(t){return t.destroy()}))},this.rm=function(){F.rmObj(n)},this.addComp=function(t){n.comps.push(t)},this.rmComponent=function(t){n.comps=n.comps.filter((function(e){return e!==t||(e.destroy(),!1)}))},this.getComps=function(t){return n.comps.filter((function(e){return e instanceof t}))},this.getComp=function(t){var e=n.getComps(t);return e.length?e[0]:null},this.drawDebug=function(t){n.comps.forEach((function(e){return e.drawDebug&&e.drawDebug(t)}))},this.applyXformToGraphics=function(t){var e=n.xform,o=e.pos,i=e.rot,a=e.scale;o.isZero()||t.translate(o.x,o.y,o.z),0!==i.z&&t.rotateZ(i.z),0!==i.y&&t.rotateY(i.y),0!==i.x&&t.rotateX(i.x),a.isOne()||t.scale(a.x,a.y,a.z)},this.drawFunc=e.draw,this.drawFunc2D=e.draw2D,e.comps&&(this.comps=e.comps),e.pos&&(this.xform.pos=e.pos),e.rot&&(this.xform.rot=e.rot),e.scale&&(this.xform.scale=e.scale),F.addObj(this)}return Object(k.a)(t,[{key:"update",value:function(t){this.comps.forEach((function(e){return e.update(t)}))}},{key:"draw",value:function(t){t.push(),this.applyXformToGraphics(t),this.drawFunc&&this.drawFunc(t),t.pop()}},{key:"draw2D",value:function(t,e,n){if(this.drawFunc2D){var o=this.xform,i=o.pos,a=o.scale,s=i.cloneMultMat(n);if(!(s.w<0||s.x<-1.2||s.x>1.2||s.y<-1.2||s.y>1.2)){for(var r=i.cloneAdd(a).cloneMultMat(n),c=i.cloneAdd(a.cloneMult(new z(1,-1,-1))).cloneMultMat(n),u=i.cloneAdd(a.cloneMult(new z(-1,-1,1))).cloneMultMat(n),l=0,d=[s,r,c,u];l<d.length;l++){var h=d[l];h.x=(h.x+1)*t.width/2,h.y=(1-h.y)*t.height/2,h.z=0}var p=Math.max(s.cloneSub(r).mag(),s.cloneSub(c).mag(),s.cloneSub(u).mag());t.push(),this.drawFunc2D(t,s,p),t.pop()}}}}]),t}(),V=new z(0,-9.82,0),X=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(t){var o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,n),(o=e.call(this,t)).force=new z,o.vel=new z,o.bounds=void 0,o.world=void 0,o.update=function(t){o.vel.applyAdd(V.cloneAdd(o.force).applyMult(t)),o.vel.applyMult(new z(.8,1,.8)),o.vel.magSq()<.01&&o.vel.applyMult(0);var e=o.parent.xform.pos;e.applyAdd(o.vel);var n=o.worldBounds().pushInside(o.world);n.isZero()||(e.applyAdd(n),0!==n.x&&(o.vel.x*=-.5),0!==n.y&&(o.vel.y*=-.5),0!==n.z&&(o.vel.z*=-.5))},o.drawDebug=function(t){var e=o.worldBounds().centerAndSize(),n=e.center,i=e.size;t.push(),t.noFill(),t.stroke(255,0,0),t.strokeWeight(1),t.translate(n.x,n.y,n.z),t.box(i.x,i.y,i.z),t.pop()},o.worldBounds=function(){return o.bounds.cloneXform(o.parent.xform)},o.bounds=i.bounds?i.bounds:new P,i.worldScale||(i.worldScale=1e3),o.world=new P(new z(-i.worldScale,0,-i.worldScale),new z(i.worldScale,i.worldScale,i.worldScale)),o}return n}(_),W=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(t,o){var i;return Object(s.a)(this,n),(i=e.call(this,t)).cam=void 0,i.last=void 0,i.update=function(t){if(i.cam.state&&i.cam.state.center){var e=i.parent.xform.pos,n=e.x,o=e.y,a=e.z;i.cam.setCenter([n,o,a],0)}},i.cam=o,i}return n}(_),B=n(5),Y=n(4),H=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(t){var o;return Object(s.a)(this,n),(o=e.call(this,t)).phys=void 0,o.user=void 0,o.followCam=void 0,o.onForce=void 0,o.keys={up:!1,down:!1,left:!1,right:!1,jump:!1,jumpInitial:!1,gain:150},o.render=function(t){t.fill(0),t.stroke(255),t.strokeWeight(2),t.sphere(1,7,7)},o.render2D=function(t,e,n){var i=o.user,a=i.name,s=i.instrument,r=i.offset;if(!(n<15)){var c=Math.min(n,50);t.translate(e.x,e.y),t.textAlign(t.CENTER,t.BOTTOM),t.fill(255),t.noStroke(),t.textSize(c/2),t.textStyle(t.BOLD),n<35?t.text(a,0,.8*-c):(t.text(a,0,1.1*-c),t.fill(225),t.textSize(.3*c),t.textStyle(t.ITALIC),t.text("".concat(s," (@").concat(r>0?"+":"").concat(r,")"),0,.75*-c))}},o.addFollowCam=function(t){o.followCam=new W(Object(N.a)(o),t),o.followCam.update(0),o.addComp(o.followCam)},o.getUserXform=function(){return{clientId:o.user.clientId,pos:o.xform.pos.toArray(),rot:o.xform.rot.toArray(),scale:o.xform.scale.toArray(),force:o.phys.force.toArray(),vel:o.phys.vel.toArray()}},o.setUserXform=function(t){o.xform.pos.setFromArray(t.pos),o.xform.rot.setFromArray(t.rot),o.xform.scale.setFromArray(t.scale),o.phys.force.setFromArray(t.force),o.phys.vel.setFromArray(t.vel)},o.setUserForce=function(t){o.phys.force.setFromArray(t.force)},o.keyPressed=function(t){return o.keyChanged(t,!0)},o.keyReleased=function(t){return o.keyChanged(t,!1)},o.keyChanged=function(t,e){switch(t.key){case"ArrowUp":o.keys.up=e;break;case"ArrowDown":o.keys.down=e;break;case"ArrowLeft":o.keys.left=e;break;case"ArrowRight":o.keys.right=e;break;case" ":o.keys.jump=e,o.keys.jumpInitial=e;break;default:return}o.keysUpdated()},o.keysUpdated=function(){var t=o.keys,e=t.up,n=t.down,i=t.left,a=t.right,s=t.jump,r=t.jumpInitial,c=t.gain,u=new z;if(u.x=i&&a?0:i?-c:a?c:0,u.y=r&&o.xform.pos.y<1.5*o.xform.scale.y?2*c:s?5:0,u.z=n&&e?0:e?c:n?-c:0,!o.followCam)return o.phys.force=u,void(o.onForce&&o.onForce(o.getUserXform()));var l=o.followCam.cam.centerAxes(),d=new z(l.x[0],l.x[1],l.x[2]),h=new z(l.z[0],l.z[1],l.z[2]),p=new z(0,u.y,0);p.applyAdd(d.applyMult(u.x)),p.applyAdd(h.applyMult(u.z)),o.phys.force=p,o.onForce&&o.onForce(o.getUserXform())},o.user=t.user,o.phys=new X(Object(N.a)(o),t.phys),o.comps=[o.phys],o.onForce=t.onForce,o.drawFunc||(o.drawFunc=o.render),o.drawFunc2D||(o.drawFunc2D=o.render2D),console.log("[Avatar] ctor",Object(N.a)(o)),o}return Object(k.a)(n,[{key:"update",value:function(t){Object(B.a)(Object(Y.a)(n.prototype),"update",this).call(this,t),this.keys.jumpInitial&&(this.keys.jumpInitial=!1,this.keysUpdated())}},{key:"draw",value:function(t){Object(B.a)(Object(Y.a)(n.prototype),"draw",this).call(this,t);var e=this.xform,o=e.pos,i=e.scale;t.push(),t.fill(30),t.noStroke(),t.translate(o.x,0,o.z),t.scale(i.x,0,i.z),t.rotateX(Math.PI/2),t.circle(0,0,2),t.pop()}}]),n}(L),Z=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,n);var i=o.draw;return o.draw=function(e){e.colorMode(e.HSL,1),e.angleMode(e.RADIANS),e.fill(t.hue,t.sat,.3),e.noStroke(),e.rotateX(Math.PI/2),e.rect(-1,-1,2,2),i&&i(e),e.colorMode(e.RGB,255)},(t=e.call(this,o)).hue=void 0,t.sat=void 0,t.hue=.5,t.sat=0,t}return n}(L),G=function(){return 2*Math.random()-1},q=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(t,o){var i;return Object(s.a)(this,n),(i=e.call(this,o)).polySynth=void 0,i.createdAt=void 0,i.noteEvt=void 0,i.scaleOrig=void 0,i.voice=null,i.releasedAt=0,i.hue=Math.random(),i.lgt=.3,i.envValLast=1,i.release=function(){return i.releasedAt=(new Date).valueOf()/1e3},i.update=function(t){var e=1-i.polySynth.modwheel;e=1-e*e,i.lgt=.8*e+.2,i.hue+=(2*Math.random()-1)*t*e,i.hue<0?i.hue+=1:i.hue>1&&(i.hue-=1),i.xform.rot.applyAdd(new z(G(),G(),G()).applyMult(t*e))},i.render=function(t){t.colorMode(t.HSL,1),t.fill(i.hue,.8,i.lgt),t.stroke(i.hue,.8,i.lgt-.2),t.strokeWeight(1),t.sphere(1,3,4),t.colorMode(t.RGB,255)},i.polySynth=t,i.createdAt=(new Date).valueOf()/1e3,i.noteEvt=o.noteEvt,i.drawFunc=i.render,i.scaleOrig=i.xform.scale.clone(),i}return n}(L),K=function(t){Object(x.a)(n,t);var e=Object(O.a)(n);function n(){var t;return Object(s.a)(this,n),(t=e.call(this)).synth=void 0,t.filter=void 0,t.filterVol=void 0,t.reverb=void 0,t.panVol=void 0,t.ps=0,t.psSpread=7,t.attack=.01,t.decay=.07,t.sustain=.3,t.release=.6,t.modwheel=.3,t.objs=[],t.maxObjs=24,t.ii=0,t.setFilterGain=function(e){t.filter.set({gain:e}),t.filterVol.volume.set({value:Math.min(0,-e)})},t.noteon=function(e,n,o){t.synth.triggerAttack(I(o.note),n,o.attack),r.Draw.schedule((function(){return t.addSynthObj(e,o)}),n)},t.noteoff=function(e,n,o){t.synth.triggerRelease(I(o.note),n)},t.controlchange=function(e,n,o){var i=o.controller.number,a=null;switch(!0){case 1===i:a=function(){var e=o.value*o.value;t.filter.set({frequency:20+1e4*e}),t.modwheel=o.value};break;case 21===i:a=function(){var e=o.value*o.value;t.filter.set({Q:8*e})};break;case 27===i:a=function(){t.psSpread=12*o.value,t.updatePitchbend()};break;case 28===i:a=function(){t.panVol.set({pan:2*o.value-1})};break;case 71<=i&&i<=74:var s=o.value*o.value*o.value*o.value,c=["attack","decay","sustain","release"][i-71];a=function(){s="sustain"===c?o.value:10*s,Object(N.a)(t)[c]=s,t.synth.set({envelope:Object(U.a)({},c,s)})};break;case 75<=i&&i<=79:a=function(){t.panVol.mute=!o.value,t.panVol.set({volume:50*(o.value-1)})};break;case 15<=i&&i<=19:a=function(){t.panVol.mute=!o.value};break;default:console.log("[PolySynth #controlchange] Unsupported CC event on channel ".concat(o.channel,":"),o.controller,o.value)}a&&r.Draw.schedule(a,n)},t.pitchbend=function(e,n,o){r.Draw.schedule((function(){t.ps=o.value,t.updatePitchbend()}),n)},t.updatePitchbend=function(){t.synth.set({detune:100*t.ps*t.psSpread})},t.addSynthObj=function(e,n){var o=Object(N.a)(t),i=o.objs,a=o.maxObjs,s=e.xform.pos;i.length&&(s=i[0].xform.pos);var r=new z(G(),Math.random(),G()).applyMult(60);s=s.cloneAdd(r),t.ii++%8===0&&(s.x=e.xform.pos.x,s.y=e.xform.pos.y,s.z=e.xform.pos.z);var c=new z(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),u=new q(Object(N.a)(t),{noteEvt:n,pos:s,rot:c,scale:new z(100)});i.unshift(u),F.addObj(u),i.length>a&&(F.rmObj(i[i.length-1]),t.objs=i.slice(0,a))},t.panVol=new r.PanVol(0,0).toDestination(),t.reverb=new r.Reverb({decay:4,wet:.6}).connect(t.panVol),t.filterVol=new r.Volume(0).connect(t.reverb),t.filter=new r.Filter({type:"bandpass",frequency:1e3,Q:2}).connect(t.filterVol),t.synth=new r.PolySynth(r.Synth,{oscillator:{type:"fatsawtooth",count:3,spread:30},envelope:{attack:t.attack,decay:t.decay,sustain:t.sustain,release:t.release}}).connect(t.filter),t}return Object(k.a)(n,[{key:"loaded",value:function(){return!0}}]),n}(S),J=function t(e,n){var o=this;Object(s.a)(this,t),this.age=0,this.released=!1,this.firstUpdate=!0,this.ageReleased=0,this.x=-1,this.y=-1,this.velx=0,this.vely=0,this.young=2,this.health=1,this.youngDur=void 0,this.fadeOut=void 0,this.radius=void 0,this.radiusOrig=void 0,this.evt=void 0,this.avatar=void 0,this.release=function(){o.released=!0,o.ageReleased=o.age},this.isDead=function(){return o.released&&o.age-o.ageReleased>o.fadeOut},this.update=function(t,e){var n=o.avatar.xform.pos,i=n.x/1e3,s=n.z/1e3;o.firstUpdate&&(o.x=1e3*(i+.1*(2*Math.random()-1)),o.y=1e3*(s+.1*(2*Math.random()-1)),o.firstUpdate=!1),o.young=Math.max(1,2-o.age/o.youngDur),o.age++,o.released&&(o.health=1-(o.age-o.ageReleased)/o.fadeOut),o.radius=o.radiusOrig*o.health,o.velx*=.924,o.vely*=.924,o.velx-=.003*(o.x-1e3*i),o.vely-=.003*(o.y-1e3*s);var r,c=Object(a.a)(e);try{for(c.s();!(r=c.n()).done;){var u=r.value;if(u!==o){var l=o.x-u.x,d=o.y-u.y,h=l*l,p=d*d,f=l<0?-1:1,m=d<0?-1:1,v=Math.sqrt(h+p),y=2500,w=v-(o.radius+u.radius);w<0?(o.velx+=1.8*f*(7500-h)/y,o.vely+=1.8*m*(7500-p)/y):w<50?(o.velx+=.2*f*h/y,o.vely+=.2*m*p/y):u.evt.instrument===o.evt.instrument&&(o.velx-=2e-6*f*h,o.vely-=2e-6*m*p)}}}catch(b){c.e(b)}finally{c.f()}(o.x<-1e3+o.radius&&o.velx<0||o.x>1e3-o.radius&&o.velx>0)&&(o.velx*=-1),(o.y<-1e3+o.radius&&o.vely<0||o.y>1e3-o.radius&&o.vely>0)&&(o.vely*=-1),o.x+=o.velx,o.y+=o.vely},this.draw=function(t,e){e.colorMode(t.HSL,1);var n=o.evt,i=n.instrument,a=n.midiEvent,s=a.attack,r=a.note,c=.3*(s||.5)+.55,u=2*o.radius*o.young;switch(i){case"eightOhEight":case"metronome":var l=r%16/16;e.fill(.4*l+.05,c,.45,o.health),e.square(o.x-u/2,o.y-u/2,u);break;default:var d=r%12/12,h=Math.min(r/128+.2,.65);e.fill(.25*d+.55,c,h,o.health),e.circle(o.x,o.y,u)}e.colorMode(t.RGB,255)},this.evt=e,this.avatar=n;var i=this.evt.midiEvent.attack||.5;switch(this.radius=25*i+5,this.radiusOrig=this.radius,e.instrument){case"eightOhEight":this.youngDur=2,this.fadeOut=3;break;default:this.youngDur=5,this.fadeOut=10}},Q=function t(){var e=this;Object(s.a)(this,t),this.notes=[],this.noteon=function(t,n){e.notes.push(new J(t,n))},this.noteoff=function(t){var n=e.notes.filter((function(n){return!n.released&&e.isSameNote(n,t)}));n.length?n.forEach((function(t){return t.release()})):console.warn("[VisualNotes #noteoff] Unable to find note for event",t)},this.isSameNote=function(t,e){return t.evt.instrument===e.instrument&&t.evt.midiEvent.note===e.midiEvent.note},this.draw=function(t,n){e.notes=e.notes.filter((function(t){return!t.isDead()})),e.notes.forEach((function(t){return t.update(n,e.notes)})),n.perspective(Math.PI/3,n.width/n.height,.5,1e4),n.clear(),n.push(),n.noStroke(),n.translate(0,5,0),n.rotateX(Math.PI/2),e.notes.forEach((function(e){return e.draw(t,n)})),n.pop()}},$={},tt={LIBRARY:"p5.EasyCam",VERSION:"1.0.10",AUTHOR:"p5.EasyCam authors",SOURCE:"https://github.com/freshfork/p5.EasyCam",toString:function(){return this.LIBRARY+" v"+this.VERSION+" by "+this.AUTHOR+" ("+this.SOURCE+")"}},et=function(){function t(e,n){if(Object(s.a)(this,t),e instanceof window.p5.RendererGL){void 0===(n=n||{}).distance&&(n.distance=500),void 0===n.center&&(n.center=[0,0,0]),void 0===n.rotation&&(n.rotation=it.identity()),void 0===n.viewport&&(n.viewport=[0,0,e.width,e.height]),this.INFO=tt,this.setCanvas(e);var o=this;this.cam=o,this.LOOK=[0,0,1],this.UP=[0,1,0],this.AXIS=new function(){this.YAW=1,this.PITCH=2,this.ROLL=4,this.ALL=this.YAW|this.PITCH|this.ROLL},this.SHIFT_CONSTRAINT=0,this.FIXED_CONSTRAINT=0,this.DRAG_CONSTRAINT=0,this.scale_rotation=.001,this.scale_pan=2e-4,this.scale_zoom=.001,this.scale_zoomwheel=20,this.distance_min_limit=.01,this.distance_min=1,this.distance_max=Number.MAX_VALUE,this.state={distance:n.distance,center:n.center.slice(),rotation:n.rotation.slice(),copy:function(t){return(t=t||{}).distance=this.distance,t.center=this.center.slice(),t.rotation=this.rotation.slice(),t}},this.state_reset=this.state.copy(),this.state_pushed=this.state.copy(),this.viewport=n.viewport.slice(),this.mouse={cam:o,curr:[0,0,0],prev:[0,0,0],dist:[0,0,0],mwheel:0,isPressed:!1,istouchdown:!1,ismousedown:!1,BUTTON:{LMB:1,MMB:2,RMB:4},button:0,mouseDragLeft:o.mouseDragRotate.bind(o),mouseDragCenter:o.mouseDragPan.bind(o),mouseDragRight:o.mouseDragZoom.bind(o),mouseWheelAction:o.mouseWheelZoom.bind(o),touchmoveSingle:o.mouseDragRotate.bind(o),touchmoveMulti:function(){o.mouseDragPan(),o.mouseDragZoom()},insideViewport:function(t,e){var n=o.viewport[0],i=n+o.viewport[2],a=o.viewport[1],s=a+o.viewport[3];return t>n&&t<i&&e>a&&e<s},solveConstraint:function(){var t=this.dist[0],e=this.dist[1];this.shiftKey&&!o.SHIFT_CONSTRAINT&&Math.abs(t-e)>1&&(o.SHIFT_CONSTRAINT=Math.abs(t)>Math.abs(e)?o.AXIS.YAW:o.AXIS.PITCH),o.DRAG_CONSTRAINT=o.AXIS.ALL,o.FIXED_CONSTRAINT&&(o.DRAG_CONSTRAINT=o.FIXED_CONSTRAINT),o.SHIFT_CONSTRAINT&&(o.DRAG_CONSTRAINT=o.SHIFT_CONSTRAINT)},updateInput:function(t,e,n){var i=o.mouse,a=o.P5.pixelDensity();i.prev[0]=i.curr[0],i.prev[1]=i.curr[1],i.prev[2]=i.curr[2],i.curr[0]=t,i.curr[1]=e,i.curr[2]=n,i.dist[0]=-(i.curr[0]-i.prev[0])/a,i.dist[1]=-(i.curr[1]-i.prev[1])/a,i.dist[2]=-(i.curr[2]-i.prev[2])/a},mousedown:function(t){var e=o.mouse;0===t.button&&(e.button|=e.BUTTON.LMB),1===t.button&&(e.button|=e.BUTTON.MMB),2===t.button&&(e.button|=e.BUTTON.RMB),e.insideViewport(t.x,t.y)&&(e.updateInput(t.x,t.y,t.y),e.ismousedown=e.button>0,e.isPressed=e.ismousedown,o.SHIFT_CONSTRAINT=0)},mousedrag:function(){var t=o.mouse;if(t.ismousedown){var e=o.P5.mouseX,n=o.P5.mouseY,i=n;t.updateInput(e,n,i),t.solveConstraint();var a=t.button&t.BUTTON.LMB,s=t.button&t.BUTTON.MMB,r=t.button&t.BUTTON.RMB;a&&t.mouseDragLeft&&t.mouseDragLeft(),s&&t.mouseDragCenter&&t.mouseDragCenter(),r&&t.mouseDragRight&&t.mouseDragRight()}},mouseup:function(t){var e=o.mouse;0===t.button&&(e.button&=~e.BUTTON.LMB),1===t.button&&(e.button&=~e.BUTTON.MMB),2===t.button&&(e.button&=~e.BUTTON.RMB),e.ismousedown=e.button>0,e.isPressed=e.istouchdown||e.ismousedown,o.SHIFT_CONSTRAINT=0},dblclick:function(t){var e=t.x,n=t.y;o.mouse.insideViewport(e,n)&&o.reset()},wheel:function(t){var e=t.x,n=t.y,i=o.mouse;i.insideViewport(e,n)&&(i.mwheel=.01*t.deltaY,i.mouseWheelAction&&i.mouseWheelAction())},evaluateTouches:function(t){var e,n,i,a=t.touches,s=0,r=0,c=0,u=a.length;for(e=0;e<u;e++)s+=a[e].clientX,r+=a[e].clientY;for(s/=u,r/=u,e=0;e<u;e++)n=s-a[e].clientX,i=r-a[e].clientY,c+=Math.sqrt(n*n+i*i);c/=u,o.mouse.updateInput(s,r,-c)},touchstart:function(t){t.preventDefault(),t.stopPropagation();var e=o.mouse;e.evaluateTouches(t),e.istouchdown=e.insideViewport(e.curr[0],e.curr[1]),e.isPressed=o.mouse.istouchdown||o.mouse.ismousedown,e.dbltap(t)},touchmove:function(t){t.preventDefault(),t.stopPropagation();var e=o.mouse;e.istouchdown&&(e.evaluateTouches(t),e.solveConstraint(),1===t.touches.length?e.touchmoveSingle():(e.touchmoveMulti(),e.tapcount=0))},touchend:function(t){t.preventDefault(),t.stopPropagation();var e=o.mouse;e.istouchdown=!1,e.isPressed=e.istouchdown||e.ismousedown,o.SHIFT_CONSTRAINT=0,e.tapcount>=2&&(e.insideViewport(e.curr[0],e.curr[1])&&o.reset(),e.tapcount=0)},tapcount:0,dbltap:function(t){0===o.mouse.tapcount++&&setTimeout((function(){o.mouse.tapcount=0}),350)},shiftKey:!1,keydown:function(t){var e=o.mouse;e.shiftKey||(e.shiftKey=16===t.keyCode)},keyup:function(t){var e=o.mouse;e.shiftKey&&(e.shiftKey=16!==t.keyCode,e.shiftKey||(o.SHIFT_CONSTRAINT=0))}},this.attachMouseListeners(),this.auto_update=!0,this.P5.registerMethod("pre",(function(){o.auto_update&&o.update()})),this.dampedZoom=new nt((function(t){o.zoom(t*o.getZoomMult())})),this.dampedPanX=new nt((function(t){o.panX(t*o.getPanMult())})),this.dampedPanY=new nt((function(t){o.panY(t*o.getPanMult())})),this.dampedPanZ=new nt((function(t){o.panZ(t*o.getPanMult())})),this.dampedRotX=new nt((function(t){o.rotateX(t*o.getRotationMult())})),this.dampedRotY=new nt((function(t){o.rotateY(t*o.getRotationMult())})),this.dampedRotZ=new nt((function(t){o.rotateZ(t*o.getRotationMult())})),this.timedRot=new ot(o.setInterpolatedRotation.bind(o)),this.timedPan=new ot(o.setInterpolatedCenter.bind(o)),this.timedzoom=new ot(o.setInterpolatedDistance.bind(o))}else console.log("renderer needs to be an instance of p5.RendererGL")}return Object(k.a)(t,[{key:"setCanvas",value:function(t){t instanceof window.p5.RendererGL?(this.renderer=t,t._pInst instanceof window.p5?this.graphics=t:this.graphics=t._pInst,this.P5=this.graphics._pInst):(this.graphics=void 0,this.renderer=void 0)}},{key:"getCanvas",value:function(){return this.renderer}},{key:"attachListener",value:function(t,e,n,o){t&&t!==n.el&&(this.detachListener(n),n.el=t,n.ev=e,n.op=o,n.el.addEventListener(n.ev,n,n.op))}},{key:"detachListener",value:function(t){t.el&&(t.el.removeEventListener(t.ev,t,t.op),t.el=void 0)}},{key:"attachMouseListeners",value:function(t){var e=this.cam,n=e.mouse;if(t=t||e.renderer){var o={passive:!1},i=t.elt;e.attachListener(i,"mousedown",n.mousedown,o),e.attachListener(i,"mouseup",n.mouseup,o),e.attachListener(i,"wheel",n.wheel,o),e.attachListener(i,"touchstart",n.touchstart,o),e.attachListener(i,"touchend",n.touchend,o),e.attachListener(i,"touchmove",n.touchmove,o),e.attachListener(window,"keydown",n.keydown,o),e.attachListener(window,"keyup",n.keyup,o)}}},{key:"removeMouseListeners",value:function(){var t=this.cam,e=t.mouse;t.detachListener(e.mousedown),t.detachListener(e.mouseup),t.detachListener(e.wheel),t.detachListener(e.keydown),t.detachListener(e.keyup),t.detachListener(e.touchstart),t.detachListener(e.touchend),t.detachListener(e.touchmove)}},{key:"dispose",value:function(){}},{key:"getAutoUpdate",value:function(){return this.auto_update}},{key:"setAutoUpdate",value:function(t){this.auto_update=t}},{key:"update",value:function(){var t=this.cam;t.mouse.mousedrag();var e=!1;e|=t.dampedZoom.update(),e|=t.dampedPanX.update(),e|=t.dampedPanY.update(),e|=t.dampedPanZ.update(),e|=t.dampedRotX.update(),e|=t.dampedRotY.update(),(e|=t.dampedRotZ.update())?(t.timedRot.stop(),t.timedPan.stop(),t.timedzoom.stop()):(t.timedRot.update(),t.timedPan.update(),t.timedzoom.update()),t.apply()}},{key:"apply",value:function(t){var e=this.cam;(t=t||e.renderer)&&(this.camEYE=this.getPosition(this.camEYE),this.camLAT=this.getCenter(this.camLAT),this.camRUP=this.getUpVector(this.camRUP),void 0===t._curCamera?t.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]):t._curCamera.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]))}},{key:"setViewport",value:function(t){this.viewport=t.slice()}},{key:"getViewport",value:function(){return this.viewport}},{key:"mouseWheelZoom",value:function(){var t=this.mouse;this.dampedZoom.addForce(t.mwheel*this.scale_zoomwheel)}},{key:"mouseDragZoom",value:function(){var t=this.mouse;this.dampedZoom.addForce(-t.dist[2])}},{key:"mouseDragPan",value:function(){var t=this.mouse;this.dampedPanX.addForce(this.DRAG_CONSTRAINT&this.AXIS.YAW?t.dist[0]:0),this.dampedPanY.addForce(this.DRAG_CONSTRAINT&this.AXIS.PITCH?t.dist[1]:0)}},{key:"mouseDragRotate",value:function(){var t=this,e=t.mouse,n=e.curr[0],o=e.curr[1],i=e.dist[0],a=e.dist[1],s=2*Math.min(Math.max((n-t.viewport[0])/t.viewport[2],0),1)-1,r=2*Math.min(Math.max((o-t.viewport[1])/t.viewport[3],0),1)-1;t.DRAG_CONSTRAINT&t.AXIS.YAW&&t.dampedRotY.addForce(+i*(1-r*r)),t.DRAG_CONSTRAINT&t.AXIS.PITCH&&t.dampedRotX.addForce(-a*(1-s*s)),t.DRAG_CONSTRAINT&t.AXIS.ROLL&&(t.dampedRotZ.addForce(-i*r),t.dampedRotZ.addForce(+a*s))}},{key:"getZoomMult",value:function(){return this.state.distance*this.scale_zoom}},{key:"getPanMult",value:function(){return this.state.distance*this.scale_pan}},{key:"getRotationMult",value:function(){return Math.pow(Math.log10(1+this.state.distance),.5)*this.scale_rotation}},{key:"zoom",value:function(t){var e=this.cam,n=e.state.distance+t;n<e.distance_min&&(n=e.distance_min,e.dampedZoom.stop()),n>e.distance_max&&(n=e.distance_max,e.dampedZoom.stop()),e.state.distance=n}},{key:"panX",value:function(t){var e=this.cam.state;if(t){var n=it.applyToVec3(e.rotation,[t,0,0]);st.add(e.center,n,e.center)}}},{key:"panY",value:function(t){var e=this.cam.state;if(t){var n=it.applyToVec3(e.rotation,[0,t,0]);st.add(e.center,n,e.center)}}},{key:"panZ",value:function(t){var e=this.cam.state;if(t){var n=it.applyToVec3(e.rotation,[0,0,t]);st.add(e.center,n,e.center)}}},{key:"panGround",value:function(t,e,n){var o=this.centerAxes();st.mult(o.x,t,o.x),st.mult(o.z,n,o.z);var i=[0,0,0];st.add(o.x,o.z,i),i[1]=e,st.add(this.cam.state.center,i,this.cam.state.center)}},{key:"centerAxes",value:function(){var t=this.cam.state,e=it.applyToVec3(t.rotation,[1,0,0]);e[1]=0;var n=st.mag(e);0===n&&(console.warn("[EasyCam] No magnitude for screenX vector",e),n=1),st.mult(e,1/n,e);var o=[0,0,0];return st.cross(e,[0,1,0],o),{x:e,y:[0,1,0],z:o}}},{key:"pan",value:function(t,e,n){this.cam.panX(t),this.cam.panY(e),this.cam.panZ(n)}},{key:"rotateX",value:function(t){this.cam.rotate([1,0,0],t)}},{key:"rotateY",value:function(t){this.cam.rotate([0,1,0],t)}},{key:"rotateZ",value:function(t){this.cam.rotate([0,0,1],t)}},{key:"rotate",value:function(t,e){var n=this.cam.state;if(e){var o=it.create({axis:t,angle:e});it.applyToRotation(n.rotation,o,n.rotation)}}},{key:"setInterpolatedDistance",value:function(t,e,n){this.cam.state.distance=at.mix(t,e,at.smoothstep(n))}},{key:"setInterpolatedCenter",value:function(t,e,n){this.cam.state.center=st.mix(t,e,at.smoothstep(n))}},{key:"setInterpolatedRotation",value:function(t,e,n){this.cam.state.rotation=it.slerp(t,e,n)}},{key:"setDistanceMin",value:function(t){this.distance_min=Math.max(t,this.distance_min_limit),this.zoom(0)}},{key:"setDistanceMax",value:function(t){this.distance_max=t,this.zoom(0)}},{key:"setDistance",value:function(t,e){this.timedzoom.start(this.state.distance,t,e,[this.dampedZoom])}},{key:"getDistance",value:function(){return this.state.distance}},{key:"setCenter",value:function(t,e){this.timedPan.start(this.state.center,t,e,[this.dampedPanX,this.dampedPanY])}},{key:"getCenter",value:function(){return this.state.center}},{key:"setRotation",value:function(t,e){this.timedRot.start(this.state.rotation,t,e,[this.dampedRotX,this.dampedRotY,this.dampedRotZ])}},{key:"getRotation",value:function(){return this.state.rotation}},{key:"getPosition",value:function(t){var e=this.cam,n=e.state;return t=st.assert(t),it.applyToVec3(n.rotation,e.LOOK,t),st.mult(t,n.distance,t),st.add(t,n.center,t),t}},{key:"getUpVector",value:function(t){var e=this.cam,n=e.state;return t=st.assert(t),it.applyToVec3(n.rotation,e.UP,t),t}},{key:"getState",value:function(){return this.state.copy()}},{key:"setState",value:function(t,e){t&&(this.setDistance(t.distance,e),this.setCenter(t.center,e),this.setRotation(t.rotation,e))}},{key:"pushState",value:function(){return this.state_pushed=this.getState()}},{key:"popState",value:function(t){this.setState(this.state_pushed,t)}},{key:"pushResetState",value:function(){return this.state_reset=this.getState()}},{key:"reset",value:function(t){this.setState(this.state_reset,t)}},{key:"setRotationScale",value:function(t){this.scale_rotation=t}},{key:"setPanScale",value:function(t){this.scale_pan=t}},{key:"setZoomScale",value:function(t){this.scale_zoom=t}},{key:"setWheelScale",value:function(t){this.scale_zoomwheel=t}},{key:"getRotationScale",value:function(){return this.scale_rotation}},{key:"getPanScale",value:function(){return this.scale_pan}},{key:"getZoomScale",value:function(){return this.scale_zoom}},{key:"getWheelScale",value:function(){return this.scale_zoomwheel}},{key:"setDamping",value:function(t){this.dampedZoom.damping=t,this.dampedPanX.damping=t,this.dampedPanY.damping=t,this.dampedPanZ.damping=t,this.dampedRotX.damping=t,this.dampedRotY.damping=t,this.dampedRotZ.damping=t}},{key:"setDefaultInterpolationTime",value:function(t){this.timedRot.default_duration=t,this.timedPan.default_duration=t,this.timedzoom.default_duration=t}},{key:"setRotationConstraint",value:function(t,e,n){var o=this.cam;o.FIXED_CONSTRAINT=0,o.FIXED_CONSTRAINT|=t?o.AXIS.YAW:0,o.FIXED_CONSTRAINT|=e?o.AXIS.PITCH:0,o.FIXED_CONSTRAINT|=n?o.AXIS.ROLL:0}},{key:"beginHUD",value:function(t,e,n){var o=this.cam;if(t=t||o.renderer){this.pushed_rendererState=t.push();var i=t.drawingContext,a=void 0!==e?e:t.width,s=void 0!==n?n:t.height,r=Number.MAX_VALUE;i.flush(),i.disable(i.DEPTH_TEST),this.pushed_uMVMatrix=t.uMVMatrix.copy(),this.pushed_uPMatrix=t.uPMatrix.copy(),t.resetMatrix(),t._curCamera.ortho(0,a,-s,0,-r,+r)}}},{key:"endHUD",value:function(t){var e=this.cam;if(t=t||e.renderer){var n=t.drawingContext;n.flush(),t.uMVMatrix.set(this.pushed_uMVMatrix),t.uPMatrix.set(this.pushed_uPMatrix),n.enable(n.DEPTH_TEST),t.pop(this.pushed_rendererState)}}}]),t}(),nt=function(){function t(e){Object(s.a)(this,t),this.value=0,this.damping=.85,this.action=e}return Object(k.a)(t,[{key:"addForce",value:function(t){this.value+=t}},{key:"update",value:function(){var t=this.value*this.value>1e-6;return t?(this.action(this.value),this.value*=this.damping):this.stop(),t}},{key:"stop",value:function(){this.value=0}}]),t}(),ot=function(){function t(e){Object(s.a)(this,t),this.default_duration=300,this.action=e}return Object(k.a)(t,[{key:"start",value:function(t,e,n,o){for(var i in o)o[i].stop();this.valA=t,this.valB=e,this.duration=void 0===n?this.default_duration:n,this.timer=(new Date).getTime(),this.active=this.duration>0,this.active||this.interpolate(1)}},{key:"update",value:function(){if(this.active){var t=((new Date).getTime()-this.timer)/this.duration;t>.995?(this.interpolate(1),this.stop()):this.interpolate(t)}}},{key:"interpolate",value:function(t){this.action(this.valA,this.valB,t)}},{key:"stop",value:function(){this.active=!1}}]),t}(),it={assert:function(t){return void 0===t||t.constructor!==Array?[1,0,0,0]:t},identity:function(){return[1,0,0,0]},applyToVec3:function(t,e,n){var o=Object(c.a)(e,3),i=o[0],a=o[1],s=o[2],r=Object(c.a)(t,4),u=r[0],l=r[1],d=r[2],h=r[3],p=l*i+d*a+h*s;return(n=st.assert(n))[0]=2*(u*(i*u-(d*s-h*a))+p*l)-i,n[1]=2*(u*(a*u-(h*i-l*s))+p*d)-a,n[2]=2*(u*(s*u-(l*a-d*i))+p*h)-s,n},applyToRotation:function(t,e,n){var o=Object(c.a)(t,4),i=o[0],a=o[1],s=o[2],r=o[3],u=Object(c.a)(e,4),l=u[0],d=u[1],h=u[2],p=u[3];return(n=it.assert(n))[0]=l*i-(d*a+h*s+p*r),n[1]=d*i+l*a+(h*r-p*s),n[2]=h*i+l*s+(p*a-d*r),n[3]=p*i+l*r+(d*s-h*a),n},slerp:function(t,e,n,o){var i=Object(c.a)(t,4),a=i[0],s=i[1],r=i[2],u=i[3],l=Object(c.a)(e,4),d=l[0],h=l[1],p=l[2],f=l[3],m=a*d+s*h+r*p+u*f;m<0&&(d=-d,h=-h,p=-p,f=-f,m=-m);var v,y,w=Math.acos(m),b=Math.sqrt(1-m*m);return b>.001?(v=Math.sin((1-n)*w)/b,y=Math.sin(n*w)/b):(v=1-n,y=n),(o=it.assert(o))[0]=v*a+y*d,o[1]=v*s+y*h,o[2]=v*r+y*p,o[3]=v*u+y*f,it.create({rotation:o,normalize:!0},o)},create:function(t,e){if(e=it.assert(e),t.axis){var n=t.axis,o=t.angle,i=st.mag(n);if(0===i)return;var a=-.5*o,s=Math.sin(a)/i;return e[0]=Math.cos(a),e[1]=s*n[0],e[2]=s*n[1],e[3]=s*n[2],e}if(t.rotation){if(e[0]=t.rotation[0],e[1]=t.rotation[1],e[2]=t.rotation[2],e[3]=t.rotation[3],t.normalize){var r=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r}return e}if(t.angles_xyz){var c=-.5*t.angles_xyz[0],u=-.5*t.angles_xyz[1],l=-.5*t.angles_xyz[2],d=[Math.cos(c),Math.sin(c),0,0],h=[Math.cos(u),0,Math.sin(u),0],p=[Math.cos(l),0,0,Math.sin(l)];return it.applyToRotation(h,p,e),it.applyToRotation(d,e,e),e}}},at={mix:function(t,e,n){return t*(1-n)+e*n},smoothstep:function(t){return t*t*(3-2*t)},smootherstep:function(t){return t*t*t*(t*(6*t-15)+10)}},st={assert:function(t){return void 0===t||t.constructor!==Array?[0,0,0]:t},isScalar:function(t){return void 0!==t&&t.constructor!==Array},add:function(t,e,n){return n=this.assert(n),this.isScalar(e)?(n[0]=t[0]+e,n[1]=t[1]+e,n[2]=t[2]+e):(n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2]),n},mult:function(t,e,n){return n=this.assert(n),this.isScalar(e)?(n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e):(n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2]),n},magSq:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},mag:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},cross:function(t,e,n){return(n=this.assert(n))[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0],n},angle:function(t,e){var n=this.mag(t)*this.mag(e);if(0===n)return 0;var o=this.dot(t,e),i=.9999*n;if(o<-i||o>i){var a=this.cross(t,e);return o>=0?Math.asin(this.mag(a)/n):Math.PI-Math.asin(this.mag(a)/n)}return Math.acos(o/n)},mix:function(t,e,n,o){return(o=this.assert(o))[0]=at.mix(t[0],e[0],n),o[1]=at.mix(t[1],e[1],n),o[2]=at.mix(t[2],e[2],n),o}};et.INFO=tt,Object.freeze(tt),$.EasyCam=et,$.DampedAction=nt,$.Interpolation=ot,$.Rotation=it,$.Vec3=st,$.Scalar=at;var rt=function t(e){var n=this;Object(s.a)(this,t),this.parent=void 0,this.pp=void 0,this.nameCustomized=!1,this.inputs={},this.hidden=!1,this.clockOpts={bpm:95},this.bpm=function(){return n.inputs.bpm?n.inputs.bpm.value():n.clockOpts.bpm},this.isFocused=function(){for(var t in n.inputs){var e=n.inputs[t];if(e&&e.focused)return!0}return!1},this.toggleHide=function(){n.pp&&(n.hidden=!n.hidden,n.setup(n.pp),n.hidden||n.setupInputsBPM())},this.setup=function(t){if(n.pp=t,n.hidden){for(var e in n.inputs){var o=n.inputs[e];o&&(o.remove(),delete n.inputs[e])}n.setupInputsHide(n.pp)}else n.setupInputsUser(n.parent.ws.clientId),n.setupInputsInstrument(),n.inputs.inputDevice||n.setupInputsMidi(n.parent.midi.webMidi),n.setupInputsHide(t)},this.setupInputsHide=function(t){n.inputs.hide&&n.inputs.hide.remove();var e=t.createButton(n.hidden?"Show Settings":"Hide Settings");e.position(t.width-e.width-50,t.height-e.height-10),e.mousePressed(n.toggleHide),n.inputs.hide=e},this.setupInputsUser=function(t){console.log("[SketchInputs #setupInputsUser] clientId",t);var e=n.parent.user,o=n.nameCustomized?e.name:"User ".concat(n.parent.ws.clientId);if(n.hidden)""===e.name&&n.parent.updateUser({name:o});else if(n.pp){if(!n.inputs.name||!n.nameCustomized){n.inputs.name&&n.inputs.name.remove(),n.inputs.offset&&n.inputs.offset.remove();var i=n.pp.createInput(o);i.size(80),i.position(20,40),i.input((function(){console.log("[SketchInputs #inputs.name] Changed:",i.value()),n.nameCustomized=!0,n.parent.updateUser({name:i.value()})})),i.elt.onfocus=function(){return i.focused=!0},i.elt.onblur=function(){return i.focused=!1},i.elt.focus(),i.elt.select(),n.inputs.name=i,n.parent.updateUser({name:i.value()},!1);var a=n.pp.createInput("".concat(n.parent.user.offset));a.size(50),a.position(i.x+i.width+10,40);var s=function(){var t=parseFloat(a.value());Number.isNaN(t)||n.parent.updateUser({offset:t})};a.input((function(){console.log("[SketchInputs #inputs.offset] Changed:",a.value()),s()})),a.elt.onfocus=function(){return a.focused=!0},a.elt.onblur=function(){return a.focused=!1},n.inputs.offset=a,s()}}else console.warn("[SketchInputs #setupInputsUser] Attempted to setup user input before sketch was initialized")},this.setupInputsInstrument=function(){if(n.pp&&n.inputs.offset&&!n.hidden){n.inputs.instrument&&n.inputs.instrument.remove();var t=n.pp.createSelect();t.position(n.inputs.offset.x+n.inputs.offset.width+10,40);var e=n.parent.user.instrument;for(var o in t.size(130),n.parent.instruments)t.option(o),o===e&&t.selected(o);t.changed((function(){console.log("[SketchInputs #inputs.instrument] Changed:",t.value()),n.parent.updateUser({instrument:t.value()})})),t.elt.onfocus=function(){return t.focused=!0},t.elt.onblur=function(){return t.focused=!1},n.inputs.instrument=t,n.parent.updateUser({instrument:t.value()},!1)}},this.setupInputsMidi=function(t){if(n.pp&&n.inputs.instrument&&!n.hidden){n.inputs.inputDevice&&n.inputs.inputDevice.remove();var e=(t||{inputs:[]}).inputs,o=n.pp.createSelect(),i=n.inputs.instrument;o.position(i.x+i.width+10,40),o.option("keyboard");var s,r=Object(a.a)(e);try{for(r.s();!(s=r.n()).done;){var c=s.value._midiInput;c?o.option(c.name):console.error("[SketchInputs #setupInputsMidi] Received a midi input with missing data")}}catch(u){r.e(u)}finally{r.f()}o.selected(n.parent.user.inputDevice),o.changed((function(){console.log("[SketchInputs #setupInputsMidi] Changed:",o.value()),n.parent.updateUser({inputDevice:o.value()})})),o.elt.onfocus=function(){return o.focused=!0},o.elt.onblur=function(){return o.focused=!1},n.inputs.inputDevice=o,n.parent.updateUser({inputDevice:o.value()},!1)}},this.setupInputsBPM=function(){if(n.pp&&!n.hidden){n.inputs.bpm&&n.inputs.bpm.remove();var t=n.pp.createSlider(30,200,n.clockOpts.bpm);t.position(20,n.pp.height-40),t.size(n.pp.width/2),t.input((function(){n.clockOpts.bpm=t.value(),n.sendClockUpdate(n.clockOpts)})),t.elt.onfocus=function(){return t.focused=!0},t.elt.onblur=function(){return t.focused=!1},n.inputs.bpm=t}},this.draw=function(t){for(var e in t.textSize(12),t.fill(255),t.strokeWeight(1),t.stroke(0),t.textAlign(t.LEFT,t.BOTTOM),t.textStyle(t.BOLD),n.inputs)if("hide"!==e){var o=n.inputs[e];if(o){var i=o.x+3,a=o.y-5;switch(!0){case"offset"===e:var s=parseFloat(o.value()),r="";Number.isNaN(s)&&(t.fill(255,0,0),r=" (NaN!)"),t.text("".concat(e.toUpperCase()).concat(r,"\n","(in beats)"),i,a),Number.isNaN(s)&&t.fill(255);break;case e in n.parent.user:t.text(e.toUpperCase(),i,a);break;default:t.text("".concat(e.toUpperCase(),": ").concat(o.value()),i,a)}}}},this.sendClockUpdate=function(t){var e=n.parent.ws,o=e.conn;(0,e.ready)()?o.send(Object(l.e)(t)):console.warn("[SketchInputs #sendClockUpdate] Can't send bpm update, websocket connection is not open")},this.onClockUpdate=function(t){n.clockOpts=t,n.inputs.bpm&&n.inputs.bpm.value(t.bpm)},this.parent=e},ct=n(689),ut=n.n(ct),lt=function t(e){var n=this;Object(s.a)(this,t),this.parent=void 0,this.audioKeys=void 0,this.keyPressed=function(t){var e=t.note,o=t.velocity;if(!n.parent.keyboardInputDisabled()&&"keyboard"===n.parent.user.inputDevice){var i={kind:"noteon",note:e,attack:o/128};n.parent.sendUserEvent("keyboard","noteon",i)}},this.keyReleased=function(t){var e=t.note;if(!n.parent.keyboardInputDisabled()&&"keyboard"===n.parent.user.inputDevice){var o={kind:"noteoff",note:e};n.parent.sendUserEvent("keyboard","noteoff",o)}},this.parent=e,this.audioKeys=new ut.a({polyphony:1/0}),this.audioKeys.down(this.keyPressed),this.audioKeys.up(this.keyReleased)},dt=function(){var t=function(){return 1.8*Math.random()-.9};return new z(1e3*t(),100,1e3*t())},ht=function t(e){var n=this;Object(s.a)(this,t),this.width=0,this.height=0,this.visualNotes=new Q,this.started=!1,this.syncing=!0,this.instruments=void 0,this.ws=void 0,this.midi=void 0,this.audioKeys=void 0,this.pp=void 0,this.pg=void 0,this.cam=void 0,this.user={clientId:0,name:"",instrument:"synth",inputDevice:"keyboard",offset:2},this.avatar=void 0,this.users=[],this.avatars=[],this.inputs=void 0,this.ground=new Z({pos:new z(0,-1,0),scale:new z(1e3)}),this.engine3d=F,this.bgCol={hue:.5,sat:0,lgt:.2},this.destroy=function(){n.ws.conn.close(888,"sketch destroyed")},this.timeGlobalToTone=function(t){var e=r.context.rawContext._nativeAudioContext.getOutputTimestamp(),o=e.contextTime,i=e.performanceTime;return o+(n.ws.clock.toLocal(t)-i)/1e3},this.timeToneToGlobal=function(t){var e=r.context.rawContext._nativeAudioContext.getOutputTimestamp(),o=e.contextTime,i=e.performanceTime+1e3*(t-o);return n.ws.clock.toGlobal(i)},this.setSize=function(t,e){n.width=t,n.height=e},this.sketch=function(t){n.pp=t,t.setup=function(){return n.setup(t)},t.draw=function(){return n.draw(t)},t.mousePressed=function(){return n.mousePressed(t)},t.keyPressed=function(){return n.keyPressed(t)},t.keyReleased=function(){return n.keyReleased(t)}},this.setup=function(t){console.log("[Sketch #setup] ".concat(n.width," x ").concat(n.height)),t.createCanvas(n.width,n.height),n.pg=t.createGraphics(n.width,n.height,"webgl"),n.cam=new et(n.pg._renderer,{distance:600}),n.cam.setDistanceMin(1),n.cam.setDistanceMax(1e3),n.cam.attachMouseListeners(t._renderer),n.cam.setViewport([0,0,n.width,n.height]),n.cam.rotateY(Math.PI),n.cam.rotateZ(Math.PI),n.cam.state.center[2]=40,n.avatar.addFollowCam(n.cam),n.inputs.setup(t)},this.draw=function(t){F.update();var e=!1;for(var o in n.instruments)if(!n.instruments[o].loaded()){e=!0;break}t.colorMode(t.HSL,1),t.background(n.bgCol.hue,n.bgCol.sat,n.bgCol.lgt),t.colorMode(t.RGB,255),n.pg&&(n.visualNotes.draw(t,n.pg),F.draw(n.pg),t.image(n.pg,0,0),F.draw2D(t,n.pg)),n.inputs.draw(t),e?n.drawMessage(t,"Loading instruments..."):n.syncing?n.drawMessage(t,"Syncing clock with server..."):n.started||n.drawMessage(t,"Click to enable audio")},this.drawMessage=function(t,e){t.fill(200),t.strokeWeight(0),t.textSize(20),t.textAlign(t.CENTER,t.CENTER),t.textStyle(t.BOLDITALIC),t.text(e,t.width/2,t.height/2)},this.mousePressed=function(t){n.started||(n.started=!0,r.start(),console.log("[Sketch #mousePressed] Started Tone"))},this.keyboardInputDisabled=function(){return n.inputs.isFocused()},this.keyPressed=function(t){n.keyboardInputDisabled()||n.avatar.keyPressed(t)},this.keyReleased=function(t){n.keyboardInputDisabled()||n.avatar.keyReleased(t)},this.updateUser=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n.user=Object.assign(n.user,t),e&&n.sendUserUpdate()},this.getUser=function(t){if(t===n.user.clientId)return n.user;var e,o=Object(a.a)(n.users);try{for(o.s();!(e=o.n()).done;){var i=e.value;if(t===i.clientId)return i}}catch(s){o.e(s)}finally{o.f()}return n.user},this.getAvatar=function(t){if(t===n.user.clientId)return n.avatar;var e,o=Object(a.a)(n.avatars);try{for(o.s();!(e=o.n()).done;){var i=e.value;if(t===i.user.clientId)return i}}catch(s){o.e(s)}finally{o.f()}return null},this.getAvatarSafe=function(t){var e=n.getAvatar(t);return e||n.avatar},this.sendUserUpdate=function(){var t=n.ws,e=t.conn;(0,t.ready)()?e.send(Object(u.n)(n.user)):console.warn("[Sketch #sendUserUpdate] Can't send user update, websocket connection is not open")},this.sendUserXform=function(t){var e=n.ws,o=e.conn;(0,e.ready)()?o.send(Object(u.o)(t)):console.warn("[Sketch #sendUserXform] Can't send user xform, websocket connection is not open")},this.sendUserEvent=function(t,e,o){var i=n.user.instrument;if(o.controller)switch(o.controller.number){case 79:r.Destination.volume.value=50*(o.value-1);case 19:return void(r.Destination.mute=!o.value);case 18:case 78:i="metronome";break;case 17:case 77:i="synth";break;case 16:case 76:i="eightOhEight";break;case 15:case 75:i="piano"}var a={clientId:n.user.clientId,instrument:i,midiEvent:o,timestamp:n.ws.now()+n.offsetMs()},s=n.ws,c=s.conn;(0,s.ready)()?c.send(Object(u.m)(a)):n.onUserEvent(a)},this.onUsers=function(t){var e,o=Object(a.a)(t);try{var i=function(){var t=e.value;if(t.clientId===n.user.clientId)return"continue";var o=n.users.filter((function(e){return e.clientId===t.clientId}));if(!o.length)return n.users.push(t),n.avatars.push(new H({user:t,pos:dt(),scale:new z(20),phys:{worldScale:1e3}})),"continue";o.length>1&&console.warn("[Sketch #onUsers] Found more than one user for clientId #".concat(t.clientId),t.clientId,t.name);var i=o[0];Object.assign(i,t)};for(o.s();!(e=o.n()).done;)i()}catch(u){o.e(u)}finally{o.f()}var s,r=Object(a.a)(n.users);try{var c=function(){var e=s.value;if(t.some((function(t){return t.clientId===e.clientId})))return"continue";var o=n.getAvatar(e.clientId);o?F.rmObj(o):console.warn("[Sketch #onUsers] Unable to find avatar for dropped user #".concat(e.clientId),e.name),n.users=n.users.filter((function(t){return t.clientId!==e.clientId})),n.avatars=n.avatars.filter((function(t){return t.user.clientId!==e.clientId}))};for(r.s();!(s=r.n()).done;)c()}catch(u){r.e(u)}finally{r.f()}},this.onUserForce=function(t){var e=t.clientId,o=n.getAvatar(e);o?o.setUserForce(t):console.warn("[Sketch #onUserForce] No avatar for user",e)},this.onUserXform=function(t){var e=t.clientId,o=n.getAvatar(e);o?o.setUserXform(t):console.warn("[Sketch #onUserXform] No avatar for user",e)},this.onUserEvent=function(t){var e=t.clientId,o=t.instrument,i=t.midiEvent,a=t.timestamp,s=i.data,c=i.channel,u=i.kind,l=n.instruments[o];if(l){if(l.loaded()){var d=n.timeGlobalToTone(a);if(d-r.immediate()<-1)console.warn("[Sketch #onUserEvent] Received event ".concat(d-r.immediate()," seconds late"));else{var h=n.getAvatarSafe(e);switch(u){case"noteon":var p=i;l.noteon(h,d,p);break;case"noteoff":var f=i;l.noteoff(h,d,f);break;case"controlchange":var m=i;l.controlchange(h,d,m);break;case"pitchbend":var v=i;l.pitchbend(h,d,v);break;default:console.warn("[Sketch #onUserEvent] Unhandled MIDI event on channel ".concat(c,":"),u,s,t)}}}}else console.error("[Sketch #onUserEvent] Unable to find instrument",o)},this.offsetMs=function(){var t=n.inputs.bpm()/60;return t?1e3/t*n.user.offset:0},console.log("[Sketch #ctor]"),this.inputs=new rt(this),this.ws=new h(window,{clock:{onSynced:function(){n.syncing=!1,n.inputs.setupInputsBPM()}},onClientId:function(t){n.user.clientId=t,n.inputs.setupInputsUser(t),n.sendUserXform(n.avatar.getUserXform())},onClockUpdate:this.inputs.onClockUpdate,onUsers:this.onUsers,onUserEvent:this.onUserEvent,onUserForce:this.onUserForce,onUserXform:this.onUserXform}),this.instruments={synth:new K,eightOhEight:new C(this),piano:new D,metronome:new T(this)},this.midi=new g({onEnabled:this.inputs.setupInputsMidi,onMessage:this.sendUserEvent}),this.audioKeys=new lt(this),this.avatar=new H({user:this.user,pos:dt(),scale:new z(40),phys:{worldScale:1e3},onForce:this.sendUserXform}),window.Tone=r,window.me=this},pt=function(){var t=Object(o.useRef)(null),e=Object(o.useRef)(new ht(window)),n=Object(o.useRef)("Loading");return Object(o.useEffect)((function(){if(!t.current)return n.current="Internal component error",void console.warn("[VideoOutput #useEffect] Can't find component reference");var o=t.current;o.childNodes[0]&&o.removeChild(o.childNodes[0]);var i=o.clientWidth,a=o.clientHeight,s=e.current;s.setSize(i,a);var r=new window.p5(s.sketch,o);return function(){s.destroy(),r.remove(),console.log("[VideoOutput #useEffect.return]")}})),i.a.createElement("div",{ref:t,style:{display:"flex",flex:1,alignItems:"center",justifyContent:"center",color:"white"}},n.current)};n(724),e.default=function(){return i.a.createElement("div",{className:"App",style:{display:"flex",flexDirection:"column",position:"absolute",backgroundColor:"#383838",top:0,left:0,right:0,bottom:0}},i.a.createElement(pt,null))}}},[[701,1,2]]]);
//# sourceMappingURL=main.5f3c1f46.chunk.js.map