(this["webpackJsonpthump-web-client"]=this["webpackJsonpthump-web-client"]||[]).push([[0],{22:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i})),n.d(t,"i",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"h",(function(){return l})),n.d(t,"g",(function(){return h})),n.d(t,"m",(function(){return d})),n.d(t,"j",(function(){return p})),n.d(t,"k",(function(){return f})),n.d(t,"l",(function(){return v})),n.d(t,"p",(function(){return m})),n.d(t,"n",(function(){return y})),n.d(t,"q",(function(){return b})),n.d(t,"o",(function(){return w}));var o="wss://thumpy.space/api",a="#",i="client/id";function s(e){return JSON.parse(e).clientId}var r="user/all",c="user/event",u="user/force",l="user/xform",h="user/request_xforms";function d(e){return JSON.parse(e)}function p(e){return JSON.parse(e)}function f(e){return JSON.parse(e)}function v(e){return JSON.parse(e)}function m(e){return"user/update"+a+JSON.stringify(e)}function y(e){return c+a+JSON.stringify(e)}function b(e){return l+a+JSON.stringify(e)}function w(){return h+a}},28:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return l})),n.d(t,"h",(function(){return h}));var o=n(22),a="clock/now",i="clock/origin",s="clock/update",r=32,c=34,u=function(){return a+o.b},l=function(e){return s+o.b+JSON.stringify(e)};function h(e){return JSON.parse(e)}},70:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));var o=n(0),a=n(1),i=n(28),s=function(){function t(e,n){var a=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(o.a)(this,t),this.global=void 0,this.conn=void 0,this.localOrigin=void 0,this.correction=0,this.precision=0,this.correction2=0,this.precision2=0,this.lowpass=.3,this.lastReqAt=0,this.lastRespAt=0,this.loopId=-1,this.syncInitial=0,this.serverOrigin=0,this.precisionNow=0,this.pingMs=0,this.syncPeriod=500,this.synced=!1,this.options=void 0,this.update=function(){a.conn.readyState===WebSocket.OPEN?(a.lastReqAt=a.nowRaw(),a.conn.send(Object(i.f)())):a.global.clearTimeout(a.loopId)},this.destroy=function(){a.global.clearTimeout(a.loopId)},this.global=e,this.options=s,this.localOrigin=e.performance.timeOrigin,this.conn=n,this.loopId=e.setInterval(this.update,this.syncPeriod)}return Object(a.a)(t,[{key:"nowRaw",value:function(){return e.performance.now()}},{key:"onClockOrigin",value:function(e){var t=JSON.parse(e).originMs;t?this.serverOrigin=t:console.error("[workerClock #onClockOrigin] Received empty response")}},{key:"onClockNow",value:function(e){var t=(JSON.parse(e)||{}).nowMs;if(t){this.lastRespAt=this.nowRaw();var n=this.lastRespAt-this.lastReqAt;this.pingMs=n;var o=t-(n/2+this.lastReqAt);0===this.correction?this.correction=o:this.correction=o*this.lowpass+this.correction*(1-this.lowpass);var a=o-this.correction;0===this.precision?this.precision=a:this.precision=a*this.lowpass+this.precision*(1-this.lowpass),this.correction2=this.precision*this.lowpass+this.correction2*(1-this.lowpass);var i=o-this.correction-this.correction2;0===this.precision2?this.precision2=i:this.precision2=i*this.lowpass+this.precision2*(1-this.lowpass);var s=this.now()-n/2-t;this.precisionNow=s*this.lowpass+this.precisionNow*(1-this.lowpass),!this.synced&&this.syncInitial++>6&&(this.synced=!0,this.global.clearTimeout(this.loopId),this.correction+=this.correction2,this.syncPeriod=2e3,this.loopId=this.global.setInterval(this.update,this.syncPeriod),this.options.onSynced&&this.options.onSynced())}else console.error("[workerClock #onClockNow] Received empty response")}},{key:"now",value:function(){var e=this.nowRaw(),t=1+(e-this.lastRespAt)/this.syncPeriod;return e+this.correction+this.correction2*t}},{key:"toGlobal",value:function(e){return e+this.correction+this.correction2}},{key:"toLocal",value:function(e){return e-this.correction-this.correction2}}]),t}()}).call(this,n(721))},705:function(e,t,n){e.exports=n(706)},706:function(e,t,n){"use strict";n.r(t);var o=n(32),a=n.n(o),i=n(542),s=n.n(i);n(711);!function(){var e=n(737).default;s.a.render(a.a.createElement(e,null),document.getElementById("root"))}()},711:function(e,t,n){},729:function(e,t){},736:function(e,t,n){},737:function(e,t,n){"use strict";n.r(t);var o=n(32),a=n.n(o),i=n(10),s=n(0),r=n(9),c=[1,3,6,8,10],u=n(14),l=n(22),h=n(28),d=n(70),p=function e(t,n){var o=this;Object(s.a)(this,e),this.conn=void 0,this.clock=void 0,this.global=void 0,this.options=void 0,this.clientId=0,this.users=[],this.reopen=function(){o.conn.readyState===WebSocket.CLOSED&&(o.conn=o.newConn())},this.ready=function(){return o.conn&&o.conn.readyState===WebSocket.OPEN},this.newConn=function(){var e=new WebSocket(l.c);return e.onclose=function(e){888!==e.code?(console.warn("WebSocket closed, will attempt to reopen in a few seconds",e),setTimeout(o.reopen,5e3)):console.warn("Closing for good",e)},e.onopen=function(e){console.log("WebSocket opened",e),o.clock.destroy(),o.clock=new d.a(o.global,o.conn,o.options.clock)},e.onerror=function(e){console.error("WebSocket error",e)},e.onmessage=o.onMessage,e},this.onMessage=function(e){var t=function(e,t,n){var o=[],a=new RegExp(t,"g");for(;n--;){var i=a.lastIndex,s=a.exec(e);if(!s)break;o.push(e.slice(i,s.index))}return o.push(e.slice(a.lastIndex)),o}(e.data,l.b,1),n=Object(u.a)(t,2),a=n[0],i=n[1];switch(a){case h.c:case h.d:if(!o.clock)return void console.error("[WSClient #onMessage] No local clock ready to handle server clock message");a===h.d?o.clock.onClockOrigin(i):o.clock.onClockNow(i);break;case h.e:var s=Object(h.h)(i);o.options.onClockUpdate(s),console.log("[WSClient #onMessage] Received clockUpdate",s);break;case l.a:o.clientId=Object(l.i)(i),console.log("[WSClient #onMessage] Received clientId",o.clientId),o.options.onClientId(o.clientId);break;case l.d:o.users=Object(l.m)(i).filter((function(e){return!!e})),o.options.onUsers(o.users);break;case l.e:var r=Object(l.j)(i);o.options.onUserEvent(r);break;case l.f:var c=Object(l.k)(i);o.options.onUserForce(c);break;case l.h:var d=Object(l.l)(i);o.options.onUserXform(d);break;case l.g:console.log("[WSClient #onMessage] Received Xform request"),o.options.onUserRequestXforms();break;default:console.log("[WSClient #onMessage] Unhandled message",{head:a,body:i,parts:t},e)}},this.now=function(){return o.clock?o.clock.now():(console.error("[WSClient #now] No clock!"),-1)},this.getUser=function(e){var t,n=Object(i.a)(o.users);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.clientId===e)return a}}catch(s){n.e(s)}finally{n.f()}},this.global=t,this.options=n,this.conn=this.newConn(),this.clock=new d.a(this.global,this.conn,this.options.clock)};var f=n(7),v=n.n(f),m=n(11),y=n(13);function b(e){return{data:e.data,channel:e.target.number,kind:e.type,attack:e.attack,note:e.note&&e.note._number,release:e.release,value:e.value,controller:e.controller}}var w=Object(y.a)(Array(16).keys()).map((function(e){return e+1})),g=["controlchange","noteoff","noteon","pitchbend"],k=function e(t){var n=this;Object(s.a)(this,e),this.webMidi=null,this.enabled=!1,this.enable=function(){var e=Object(m.a)(v.a.mark((function e(t){var o,a,s,r,c,u,l,h,d,p;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.onMessage,a=t.onEnabled,s=window,r=s.WebMidi,e.prev=2,e.next=5,r.enable();case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),console.error("[MIDI #enable] Failed to enable MIDI",e.t0),e.abrupt("return");case 11:n.webMidi=r,n.enabled=!0,c=n.webMidi,u=c.inputs,l=c.outputs,console.log("[MIDI #enable] inputs",u),console.log("[MIDI #enable] outputs",l),a&&a(n.webMidi),h=Object(i.a)(u);try{for(p=function(){var e,t=d.value,n=Object(i.a)(g);try{var a=function(){var n=e.value;t.addListener(n,(function(e){return o(t.name,n,b(e))}),{channels:w})};for(n.s();!(e=n.n()).done;)a()}catch(s){n.e(s)}finally{n.f()}},h.s();!(d=h.n()).done;)p()}catch(f){h.e(f)}finally{h.f()}case 19:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),this.enable(t)},x=n(27),O=n(1),M=n(6),S=n(3),I=n(2),A=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(s.a)(this,n),(e=t.call(this)).w=0,e.clone=function(){return new n(e.x,e.y,e.z)},e.cloneMult=function(t){return e.clone().applyMult(t)},e.cloneAdd=function(t){return e.clone().applyAdd(t)},e.cloneSub=function(t){return e.clone().applySub(t)},e.isZero=function(){return 0===e.x&&0===e.y&&0===e.z},e.isOne=function(){return 1===e.x&&1===e.y&&1===e.z},e.isEqual=function(t){return e.x===t.x&&e.y===t.y&&e.z===t.z},e.normalize=function(){return e.applyMult(1/e.mag())},e.toArray=function(){return[e.x,e.y,e.z]},e.setFromArray=function(t){return e.x=t.length>0?t[0]:0,e.y=t.length>1?t[1]:e.x,e.z=t.length>2?t[2]:2===t.length?0:e.x,Object(M.a)(e)},e.applyMult=function(t){return t instanceof n?(e.x*=t.x,e.y*=t.y,e.z*=t.z,Object(M.a)(e)):(e.x*=t,e.y*=t,e.z*=t,Object(M.a)(e))},e.applyAdd=function(t){return t instanceof n?(e.x+=t.x,e.y+=t.y,e.z+=t.z,Object(M.a)(e)):(e.x+=t,e.y+=t,e.z+=t,Object(M.a)(e))},e.applySub=function(t){return t instanceof n?(e.x-=t.x,e.y-=t.y,e.z-=t.z,Object(M.a)(e)):(e.x-=t,e.y-=t,e.z-=t,Object(M.a)(e))},e.cloneMultMat=function(t){if(!t.length||16!==t.length)return console.error("[Vec #applyMult] invalid matrix provided for mult",t),e.clone();var o=new n;return o.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12],o.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13],o.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14],o.w=t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15],Math.abs(o.w)>Number.EPSILON&&o.applyMult(1/o.w),o};for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e.setFromArray(a),e}return n}(window.p5.Vector),C=function e(t,n){var o=this;Object(s.a)(this,e),this.min=new A(-1),this.max=new A(1),this.clone=function(){return new e(o.min.clone(),o.max.clone())},this.cloneXform=function(e){return o.clone().applyXform(e)},this.applyXform=function(e){return e.applyTo(o.min),e.applyTo(o.max),o.sanitize(),o},this.sanitize=function(){if(o.min.x>o.max.x){var e=o.min.x;o.min.x=o.max.x,o.max.x=e}if(o.min.y>o.max.y){var t=o.min.y;o.min.y=o.max.y,o.max.y=t}if(o.min.z>o.max.z){var n=o.min.z;o.min.z=o.max.z,o.max.z=n}return o},this.pushInside=function(e){var t=new A;return o.min.x<e.min.x?t.x=e.min.x-o.min.x:o.max.x>e.max.x&&(t.x=e.max.x-o.max.x),o.min.y<e.min.y?t.y=e.min.y-o.min.y:o.max.y>e.max.y&&(t.y=e.max.y-o.max.y),o.min.z<e.min.z?t.z=e.min.z-o.min.z:o.max.z>e.max.z&&(t.z=e.max.z-o.max.z),t},this.centerAndSize=function(){return{center:new A((o.max.x+o.min.x)/2,(o.max.y+o.min.y)/2,(o.max.z+o.min.z)/2),size:new A(o.max.x-o.min.x,o.max.y-o.min.y,o.max.z-o.min.z)}},t&&(this.min=t),n&&(this.max=n)},R=function e(t,n,o){var a=this;Object(s.a)(this,e),this.pos=void 0,this.rot=void 0,this.scale=void 0,this.applyTo=function(e){e.applyMult(a.scale),e.applyAdd(a.pos)},this.pos=t||new A,this.rot=n||new A,this.scale=o||new A(1)},j=function(){function e(t){Object(s.a)(this,e),this.parent=void 0,this.drawDebug=void 0,this.parent=t}return Object(O.a)(e,[{key:"destroy",value:function(){console.log("[Component] destroyed")}},{key:"update",value:function(e){console.warn("[Component] update")}}]),e}(),T=new function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.objs=[],this.debug=!1,this.lastUpdate=void 0,this.addObj=function(e){return t.objs.unshift(e)},this.rmObj=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.objs=t.objs.filter((function(t){return t!==e||(n&&t.destroy(),!1)}))},this.getObjs=function(e){return t.objs.filter((function(t){return t instanceof e}))},this.getObj=function(e){return t.getObjs(e)[0]},this.update=function(){if(t.lastUpdate){var e=(new Date).valueOf(),n=(e-t.lastUpdate)/1e3;t.lastUpdate=e,t.objs.forEach((function(e){return e.update(n)}))}else t.lastUpdate=(new Date).valueOf()},this.draw=function(e){var n,o=Object(i.a)(t.objs);try{for(o.s();!(n=o.n()).done;){var a=n.value;a.draw(e),a.drawShadow(e),t.debug&&a.drawDebug(e)}}catch(s){o.e(s)}finally{o.f()}},this.draw2D=function(e,n){var o,a=n,s=a._renderer.uMVMatrix.copy().mult(a._renderer.uPMatrix),r=Object(i.a)(t.objs);try{for(r.s();!(o=r.n()).done;){o.value.draw2D(e,n,s.mat4)}}catch(c){r.e(c)}finally{r.f()}},n.debug&&(this.debug=!0)}({debug:!1}),N=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.children=[],this.comps=[],this.xform=new R,this.parent=void 0,this.drawFunc=void 0,this.drawShadowFunc=void 0,this.drawFunc2D=void 0,this.destroy=function(){t.comps.forEach((function(e){return e.destroy()})),t.children.forEach((function(e){return e.destroy()}))},this.rm=function(){t.parent?t.parent.rmChild(t):T.rmObj(t)},this.addChild=function(e){T.rmObj(e,!1),e.parent=t,t.children.push(e)},this.rmChild=function(e){t.children=t.children.filter((function(t){return t!==e||(t.destroy(),!1)}))},this.getChildren=function(e){return t.children.filter((function(t){return t instanceof e}))},this.getChild=function(e){return t.getChildren(e)[0]},this.addComp=function(e){t.comps.push(e)},this.rmComp=function(e){t.comps=t.comps.filter((function(t){return t!==e||(t.destroy(),!1)}))},this.getComps=function(e){return t.comps.filter((function(t){return t instanceof e}))},this.getComp=function(e){return t.getComps(e)[0]},this.drawDebug=function(e){t.comps.forEach((function(t){return t.drawDebug&&t.drawDebug(e)}))},this.applyXformToGraphics=function(e){var n=t.xform,o=n.pos,a=n.rot,i=n.scale;o.isZero()||e.translate(o.x,o.y,o.z),0!==a.z&&e.rotateZ(a.z),0!==a.y&&e.rotateY(a.y),0!==a.x&&e.rotateX(a.x),i.isOne()||e.scale(i.x,i.y,i.z)},this.drawFunc=n.draw,this.drawFunc2D=n.draw2D,this.parent=n.parent,n.children&&(this.children=n.children),n.comps&&(this.comps=n.comps),n.pos&&(this.xform.pos=n.pos),n.rot&&(this.xform.rot=n.rot),n.scale&&(this.xform.scale=n.scale),T.addObj(this)}return Object(O.a)(e,[{key:"update",value:function(e){this.comps.forEach((function(t){return t.update(e)})),this.children.forEach((function(t){return t.update(e)}))}},{key:"draw",value:function(e){e.push(),this.applyXformToGraphics(e),this.drawFunc&&this.drawFunc(e),this.children.forEach((function(t){return t.draw(e)})),e.pop()}},{key:"drawShadow",value:function(e){e.push();var t=this.xform,n=t.pos,o=t.rot,a=t.scale;e.translate(n.x,0,n.z),0!==o.y&&e.rotateY(o.y),e.scale(a.x,1,a.z),this.drawShadowFunc&&this.drawShadowFunc(e),this.children.forEach((function(t){return t.drawShadow(e)})),e.pop()}},{key:"draw2D",value:function(e,t,n){if(this.children.forEach((function(o){return o.draw2D(e,t,n)})),this.drawFunc2D){var o=this.xform,a=o.pos,i=o.scale,s=a.cloneMultMat(n);if(!(s.w<0||s.x<-1.2||s.x>1.2||s.y<-1.2||s.y>1.2)){for(var r=a.cloneAdd(i).cloneMultMat(n),c=a.cloneAdd(i.cloneMult(new A(1,-1,-1))).cloneMultMat(n),u=a.cloneAdd(i.cloneMult(new A(-1,-1,1))).cloneMultMat(n),l=0,h=[s,r,c,u];l<h.length;l++){var d=h[l];d.x=(d.x+1)*e.width/2,d.y=(1-d.y)*e.height/2,d.z=0}var p=Math.max(s.cloneSub(r).mag(),s.cloneSub(c).mag(),s.cloneSub(u).mag());e.push(),this.drawFunc2D(e,s,p),e.pop()}}}}]),e}(),L=new A(0,-9.82,0),D=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,n),(o=t.call(this,e)).force=new A,o.vel=new A,o.bounds=void 0,o.world=void 0,o.update=function(e){o.vel.applyAdd(L.cloneAdd(o.force).applyMult(e)),o.vel.applyMult(new A(.8,1,.8)),o.vel.magSq()<.01&&o.vel.applyMult(0);var t=o.parent.xform.pos;t.applyAdd(o.vel);var n=o.worldBounds().pushInside(o.world);n.isZero()||(t.applyAdd(n),0!==n.x&&(o.vel.x*=-.5),0!==n.y&&(o.vel.y*=-.5),0!==n.z&&(o.vel.z*=-.5))},o.drawDebug=function(e){var t=o.worldBounds().centerAndSize(),n=t.center,a=t.size;e.push(),e.noFill(),e.stroke(255,0,0),e.strokeWeight(1),e.translate(n.x,n.y,n.z),e.box(a.x,a.y,a.z),e.pop()},o.worldBounds=function(){return o.bounds.cloneXform(o.parent.xform)},o.bounds=a.bounds?a.bounds:new C,a.worldScale||(a.worldScale=1e3),o.world=new C(new A(-a.worldScale,0,-a.worldScale),new A(a.worldScale,a.worldScale,a.worldScale)),o}return n}(j),P=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e,o){var a;return Object(s.a)(this,n),(a=t.call(this,e)).cam=void 0,a.last=void 0,a.update=function(e){if(a.cam.state&&a.cam.state.center){var t=a.parent.xform.pos,n=t.x,o=t.y,i=t.z;a.cam.setCenter([n,o,i],0)}},a.cam=o,a}return n}(j),E=n(5),U=n(4),z={attack:"16n",attackCurve:"linear",sustain:1,release:"8n",releaseCurve:"linear"},F=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(s.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).dip=new r.Envelope(z),e.stepLeft=new r.Envelope(z),e.stepRight=new r.Envelope(z),e.spinLeft=new r.Envelope(z),e.spinRight=new r.Envelope(z),e.headbang=new r.Envelope(z),e.arms={l:{upper:{y:new r.Envelope(z),z:new r.Envelope(z)},lower:{x:new r.Envelope(z)}},r:{upper:{y:new r.Envelope(z),z:new r.Envelope(z)},lower:{x:new r.Envelope(z)}}},e.update=function(t){var n=e.parent;n.xform.pos.y=-e.dip.value*V.leg.y*.8,n.stepLeftRight=.7*(e.stepRight.value-e.stepLeft.value),(n.parent||n).xform.rot.y+=20*t*(e.spinRight.value-e.spinLeft.value),n.rotHead.x=e.headbang.value*Math.PI/4,n.rotArms.l.upper.y=Math.PI*(.4-.7*e.arms.l.upper.y.value),n.rotArms.r.upper.y=Math.PI*(.4-.7*e.arms.r.upper.y.value),n.rotArms.l.upper.z=Math.PI*(1.1+e.arms.l.upper.z.value),n.rotArms.r.upper.z=Math.PI*(1.1+e.arms.r.upper.z.value),n.rotArms.l.lower.x=Math.PI*(.1+.7*e.arms.l.lower.x.value),n.rotArms.r.lower.x=Math.PI*(.1+.7*e.arms.r.lower.x.value)},e.noteEnvMap={0:e.dip,1:e.spinLeft,2:e.headbang,3:e.spinRight,4:e.stepLeft,5:e.stepRight,6:e.arms.l.upper.z,7:e.arms.r.upper.z,8:e.arms.l.lower.x,9:e.arms.r.lower.x,10:e.arms.l.upper.y,11:e.arms.r.upper.y},e.noteEvent=function(t,n){var o=n.kind,a=n.note,i=n.attack,s=e.noteEnvMap[a%12];"noteon"===o?s.triggerAttack(t,i):s.triggerRelease(t)},e}return n}(j),V={leg:new A(.1,.5,.1),armUpper:new A(.1,.3,.1),armLower:new A(.1,.3,.1),body:new A(.4),neck:new A(.05),head:new A(.25)},_=function(){return{upper:new A(0,.4*Math.PI,1.1*Math.PI),lower:new A(.1*Math.PI,0,0)}},H=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,n),(e=t.call(this,o)).moves=void 0,e.rotHead=new A,e.rotArms={l:_(),r:_()},e.stepLeftRight=0,e.drawFunc=function(t){t.fill(0).stroke(255).strokeWeight(2);var n=V.leg,o=V.body;t.translate(e.stepLeftRight,-1+n.y+o.y,0),t.sphere(V.body.y,7,4),e.drawHead(t),e.drawArm(t,!0),e.drawArm(t,!1)},e.drawHead=function(t){var n=V.body,o=V.neck,a=V.head;t.push(),t.rotateX(e.rotHead.x),t.push(),t.translate(0,n.y+o.y+a.y,0),t.box(1.8*a.y,1.8*a.y,1.8*a.y),t.pop(),t.pop()},e.drawArm=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=V.body,a=V.armUpper,i=V.armLower,s=n?e.rotArms.l:e.rotArms.r;t.push(),n&&t.scale(-1,1,1),t.translate(o.x,.8*o.y,0),t.rotateZ(s.upper.z).rotateY(s.upper.y),t.translate(0,a.y/2,0),t.box(a.x,a.y,a.z),t.translate(0,.025+a.y/2,0),t.rotateX(s.lower.x),t.translate(0,.025+i.y/2,0),t.box(i.x,i.y,i.z),t.translate(0,.05+i.y/2+i.x/2,0),t.box(i.x,i.x,i.x),t.pop()},e.drawShadowFunc=function(t){t.push(),t.fill(30).noStroke(),t.rotateX(Math.PI/2),t.circle(e.stepLeftRight,0,2*V.body.x),t.pop()},e.moves=new F(Object(M.a)(e)),e.addComp(e.moves),e}return n}(N),B=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).phys=void 0,o.user=void 0,o.followCam=void 0,o.onForce=void 0,o.dancer=void 0,o.facing=void 0,o.keys={up:!1,down:!1,left:!1,right:!1,jump:!1,jumpInitial:!1,gain:100},o.drawFunc2D=function(e,t,n){var a=o.user,i=a.name,s=a.instrument,r=a.offset;if(!(n<15)){var c=Math.min(n,50),u=Math.min(n,200);e.translate(t.x,t.y),e.textAlign(e.CENTER,e.BOTTOM),e.fill(255),e.noStroke(),e.textSize(c/2),e.textStyle(e.BOLD),n<35?e.text(i,0,.8*-c):(e.text(i,0,.8*-u),e.fill(225),e.textSize(.3*c),e.textStyle(e.ITALIC),e.text("".concat(s," (@").concat(r>0?"+":"").concat(r,")"),0,.8*-u+.35*c))}},o.addFollowCam=function(e){o.followCam=new P(Object(M.a)(o),e),o.followCam.update(0),o.addComp(o.followCam)},o.getUserXform=function(){return{clientId:o.user.clientId,pos:o.xform.pos.toArray(),rot:o.xform.rot.toArray(),scale:o.xform.scale.toArray(),force:o.phys.force.toArray(),vel:o.phys.vel.toArray()}},o.setUserXform=function(e){o.xform.pos.setFromArray(e.pos),o.xform.rot.setFromArray(e.rot),o.xform.scale.setFromArray(e.scale),o.phys.force.setFromArray(e.force),o.phys.vel.setFromArray(e.vel)},o.setUserForce=function(e){o.phys.force.setFromArray(e.force)},o.keyPressed=function(e){return o.keyChanged(e,!0)},o.keyReleased=function(e){return o.keyChanged(e,!1)},o.keyChanged=function(e,t){switch(e.key){case"ArrowUp":o.keys.up=t;break;case"ArrowDown":o.keys.down=t;break;case"ArrowLeft":o.keys.left=t;break;case"ArrowRight":o.keys.right=t;break;case" ":o.keys.jump=t,o.keys.jumpInitial=t;break;default:return}o.keysUpdated()},o.keysUpdated=function(){var e=o.keys,t=e.up,n=e.down,a=e.left,i=e.right,s=e.jump,r=e.jumpInitial,c=e.gain,u=new A;if(u.x=a&&i?0:a?-c:i?c:0,u.y=r&&o.xform.pos.y<1.5*o.xform.scale.y?3*c:s?6:0,u.z=n&&t?0:t?c:n?-c:0,!o.followCam)return o.phys.force=u,void(o.onForce&&o.onForce(o.getUserXform()));var l=o.followCam.cam.centerAxes(),h=new A(l.x[0],0,l.x[2]),d=new A(l.z[0],0,l.z[2]),p=new A(0,u.y,0);p.applyAdd(h.applyMult(u.x)),p.applyAdd(d.applyMult(u.z)),o.phys.force=p,0===p.x&&0===p.z||(o.xform.rot.y=Math.atan2(p.x,p.z),o.facing=p.clone().normalize()),o.onForce&&o.onForce(o.getUserXform())},o.user=e.user,o.phys=new D(Object(M.a)(o),e.phys),o.comps=[o.phys],o.onForce=e.onForce,o.dancer=new H,o.facing=new A(0,0,-1),o.addChild(o.dancer),console.log("[Avatar] ctor",Object(M.a)(o)),o}return Object(O.a)(n,[{key:"update",value:function(e){Object(E.a)(Object(U.a)(n.prototype),"update",this).call(this,e),this.keys.jumpInitial&&(this.keys.jumpInitial=!1,this.keysUpdated())}}]),n}(N),X=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(s.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).hue=0,e.sat=0,e.lgt=.25,e.drawFunc=function(t){t.colorMode(t.HSL,1).noFill().strokeWeight(4).stroke(e.hue,e.sat,.25),t.rotateX(Math.PI/2),t.rect(-1,-1,2,2);var n=.05;t.rect(-n,-n,.1,.1),t.rect(-.55,-.55,.1,.1),t.rect(.45,-.55,.1,.1),t.rect(.45,.45,.1,.1),t.rect(-.55,.45,.1,.1)},e}return n}(N),W=n(692),G=n.n(W);function q(e){return r.Frequency(e,"midi").toFrequency()}var Y=function(){return 2*Math.random()-1},Z=function(){return new A(Y(),Y(),Y())},J=function(e){var t=e;switch(e){case"73":t="73##";break;case"77":t="77#"}return{hue:G()(t).quick(),sat:.8,lgt:.4}},K=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sliders:{}};Object(s.a)(this,e),this.sliders=void 0,this.update=function(e){for(var n=0,o=Object.values(t.sliders);n<o.length;n++){o[n].update(e)}},this.draw=function(e){e.push();var n=t.sliders,o=30;for(var a in n){var i=n[a];i.xx=o,i.draw(e),o+=i.width,["mod","r"].includes(a)&&(o+=i.width)}e.pop()},this.mousePressed=function(e){for(var n=(Le.cam||{}).mouse,o=0,a=Object.values(t.sliders);o<a.length;o++){if(a[o].mousePressed(e.mouseX,e.mouseY))return n&&(n.ismousedown=!1),!0}return!1},this.mouseReleased=function(e){Object.values(t.sliders).forEach((function(e){return e.mouseReleased()}))},this.controlchangeNext=function(e){var n=t.sliderForCtrl(e.controller.number);return n&&!n.pressed&&(n.valueNext=e.value),n},this.controlchange=function(e){var n=t.sliderForCtrl(e.controller.number);return n&&(n.value.value=e.value),n},this.sliderForCtrl=function(e){return Object.values(t.sliders).filter((function(t){return t.ctrl===e}))[0]},this.sliders=n.sliders},Q=function(){function e(t){var n=this;Object(s.a)(this,e),this.height=150,this.width=20,this.value=new r.Signal(.5),this.valueNext=.5,this.strokeWeight=4,this.xx=40,this.yy=100,this.pressed=!1,this.label=void 0,this.ctrl=void 0,this.valueLastSent=0,this.mouseReleased=function(){return n.pressed=!1},this.label=t.label,this.ctrl=t.ctrl}return Object(O.a)(e,[{key:"draw",value:function(e){e.colorMode(e.HSL,1),e.fill(0,0,.1).stroke(0,0,.7).strokeWeight(this.strokeWeight),e.rect(this.xx,this.yy,this.width,this.height);var t=J("".concat(this.ctrl));e.fill(t.hue,.3*t.sat,t.lgt).noStroke(),this.drawVal(e,this.valueNext),e.fill(t.hue,t.sat,t.lgt).noStroke(),this.drawVal(e,this.value.value),e.fill(0,0,.8).stroke(0).strokeWeight(1),e.textSize(10).textAlign(e.CENTER,e.TOP).textStyle(e.BOLD),e.text(this.label.toUpperCase(),this.xx+this.width/2,this.yy+this.height+5)}},{key:"drawVal",value:function(e,t){var n=this.width-this.strokeWeight,o=this.xx+this.strokeWeight/2;e.square(o,this.valueY(t),n)}},{key:"mousePressed",value:function(e,t){return!(e<this.xx||e>this.xx+this.width)&&(!(t<this.yy||t>this.yy+this.height)&&(this.setValueNextMouse(t),this.pressed=!0,!0))}},{key:"update",value:function(e){this.pressed&&this.setValueNextMouse(e.mouseY)}},{key:"setValueNextMouse",value:function(e){var t=this.yy+this.width/2,n=this.height-this.width-this.strokeWeight/2;this.valueNext=1-Math.max(0,Math.min(1,(e-t)/n)),this.sendValue()}},{key:"sendValue",value:function(){if(this.valueNext!==this.valueLastSent){this.valueLastSent=this.valueNext;var e={kind:"controlchange",controller:{number:this.ctrl,name:this.label},value:this.valueNext};Le.sendUserEvent("keyboard",e.kind,e)}}},{key:"valueY",value:function(e){var t=this.yy+this.width/2;return(1-e)*(this.height-this.width)+t-this.width/2+this.strokeWeight/2}}]),e}(),$=function(){function e(){Object(s.a)(this,e),this.ctrls=new K({sliders:{mod:new Q({label:"mod",ctrl:1}),a:new Q({label:"a",ctrl:71}),d:new Q({label:"d",ctrl:72}),s:new Q({label:"s",ctrl:73}),r:new Q({label:"r",ctrl:74}),vol:new Q({label:"vol",ctrl:28})}}),this.envelope=void 0,this.panVol=void 0}return Object(O.a)(e,[{key:"loaded",value:function(){return!1}},{key:"noteon",value:function(e,t,n){}},{key:"noteoff",value:function(e,t,n){}},{key:"controlchange",value:function(e,t,n){var o=this;this.ctrls.controlchangeNext(n),r.Draw.schedule((function(){var t=o.ctrls.controlchange(n),a={avatar:e,evt:n,slider:t};o.updateValForCtrl(a)}),t)}},{key:"pitchbend",value:function(e,t,n){}},{key:"updateValsFromSliders",value:function(){for(var e in this.ctrls.sliders){var t=this.ctrls.sliders[e];this.updateValForCtrl({slider:t})}}},{key:"updateValForCtrl",value:function(e){var t=e.slider;if(t){var n=t.label,o=t.value.value;if("vol"!==n){if(this.envelope)switch(["a","d","r"].includes(n)&&(o*=10*o*o*o),n){case"a":this.envelope.attack=o;break;case"d":this.envelope.decay=o;break;case"s":this.envelope.sustain=o;break;case"r":this.envelope.release=o}}else this.panVol&&(this.panVol.mute=!o,this.panVol.set({volume:66*o-60}))}}}]),e}(),ee=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(s.a)(this,n),(e=t.call(this)).synth=void 0,e.gain=void 0,e.freqNode=new r.Add,e.freq=new r.Signal(440),e.noiseGain=void 0,e.noise=void 0,e.reverb=void 0,e.panVol=void 0,e.ps=0,e.psSpread=7,e.attack=.01,e.decay=.07,e.sustain=.3,e.release=.6,e.modwheel=.3,e.objs=[],e.maxObjs=32,e.ii=0,e.noteon=function(t,n,o){var a=q(o.note);e.freq.exponentialRampToValueAtTime(a,n);try{e.synth.triggerAttack(a,n,o.attack)}catch(i){}r.Draw.schedule((function(){return e.addBHObj(t,o)}),n)},e.noteoff=function(t,n,o){e.synth.triggerRelease(n)},e.controlchange=function(t,n,o){var a=o.controller.number,i=null;switch(!0){case 1===a:i=function(){var t=o.value*o.value;e.noiseGain.set({gain:t*e.freq.value*3}),e.modwheel=o.value};break;case 21===a:i=function(){var t=o.value*o.value;e.noise.set({playbackRate:2*t})};break;case 27===a:i=function(){e.psSpread=12*o.value,e.updatePitchbend()};break;case 28===a:i=function(){e.panVol.set({pan:2*o.value-1})};break;case 71<=a&&a<=74:var s=o.value*o.value*o.value*o.value,c=["attack","decay","sustain","release"][a-71];i=function(){s="sustain"===c?o.value:10*s,Object(M.a)(e)[c]=s,e.synth.envelope.set(Object(x.a)({},c,s))};break;case 75<=a&&a<=79:i=function(){e.panVol.mute=!o.value,e.panVol.set({volume:50*(o.value-1)})};break;case 15<=a&&a<=19:i=function(){e.panVol.mute=!o.value}}i&&r.Draw.schedule(i,n)},e.pitchbend=function(t,n,o){r.Draw.schedule((function(){e.ps=o.value,e.updatePitchbend()}),n)},e.updatePitchbend=function(){e.synth.set({detune:100*e.ps*e.psSpread})},e.lastPos={},e.addBHObj=function(t,n){var o=Le.blackHole;if(o){var a=Object(M.a)(e),s=a.objs,r=a.maxObjs,c=t.user.clientId,u=t.xform.pos;e.lastPos[c]&&(u=e.lastPos[c]);var l=new A(Y(),Math.random(),Y()).applyMult(78);if(u=u.cloneAdd(l),e.ii++%16===0||u.y>1e3){var h,d=Object(i.a)(s);try{for(d.s();!(h=d.n()).done;){h.value.xform.scale.applyMult(.8)}}catch(x){d.e(x)}finally{d.f()}var p=t.facing,f=t.xform,v=f.pos,m=f.scale,y=Math.random()*Math.PI*2,b=p.cloneMult(520);u.x=v.x+b.x+3*m.x*Math.sin(y),u.y=v.y,u.z=v.z+b.z+3*m.x*Math.cos(y)}e.lastPos[c]=u;var w=new A(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),g=u.y/1e3;g*=g*g*10*130;var k=new te(Object(M.a)(e),{noteEvt:n,pos:u,rot:w,scale:new A(91+g),twist:e.modwheel*e.modwheel,mass:n.attack||.7});s.unshift(k),o.addChild(k),s.length>r&&(o.rmChild(s[s.length-1]),e.objs=s.slice(0,r))}},e.ctrls.sliders={},e.panVol=new r.PanVol(0,0).toDestination(),e.reverb=new r.Reverb({decay:4,wet:.6}).connect(e.panVol);var o=new r.Filter({type:"lowpass",frequency:8e3,Q:.5}).connect(e.reverb),a=new r.PingPongDelay({delayTime:"4n",feedback:.6,wet:.3}).connect(o);return e.gain=new r.Gain(1).connect(a),e.synth=(new r.Synth).connect(e.gain),e.freqNode.connect(e.synth.frequency),e.freq.connect(e.freqNode),e.noiseGain=new r.Gain(100).connect(e.freqNode.addend),e.noise=new r.Noise({volume:0,playbackRate:.5,type:"brown"}).start().connect(e.noiseGain),e}return Object(O.a)(n,[{key:"loaded",value:function(){return!0}}]),n}($),te=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e,o){var a;return Object(s.a)(this,n),(a=t.call(this,o)).inst=void 0,a.createdAt=void 0,a.noteEvt=void 0,a.scaleOrig=void 0,a.voice=null,a.hue=Math.random(),a.mass=void 0,a.twist=0,a.update=function(e){var t=1-a.inst.modwheel;t=1-t*t,a.xform.rot.applyAdd(Z().applyMult(e*t))},a.origin2D=new A,a.scale2D=1,a.drawFunc=function(e){Le.shaderBlackHole&&(Le.shaderBlackHole.setUniform("origin",[a.origin2D.x/e.width,a.origin2D.y/e.height]),Le.shaderBlackHole.setUniform("scale",a.scale2D/e.width),Le.shaderBlackHole.setUniform("rotate",a.twist*Math.PI),Le.shaderBlackHole.setUniform("mass",a.mass)),e.sphere(1,3,4)},a.drawFunc2D=function(e,t,n){a.origin2D=t,a.scale2D=Math.min(2*e.height,n)},a.inst=e,a.createdAt=(new Date).valueOf()/1e3,a.noteEvt=o.noteEvt,a.scaleOrig=a.xform.scale.clone(),a.mass=1-o.mass,a.mass=1-a.mass*a.mass,o.twist&&(a.twist=Math.random()>.5?o.twist:-o.twist),a}return n}(N),ne=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;return Object(s.a)(this,n),(e=t.call(this)).lr=-1,e.noteon=function(e,t,n){e.dancer.moves.noteEvent(t,n)},e.noteoff=function(e,t,n){e.dancer.moves.noteEvent(t,n)},e.ctrls.sliders={},e}return Object(O.a)(n,[{key:"loaded",value:function(){return!0}}]),n}($),oe=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this)).sampler=void 0,o.pitchShift=void 0,o.panVol=void 0,o.ps=0,o.psSpread=7,o.noteon=function(e,t,n){o.sampler.triggerAttack(q(n.note),t,n.attack)},o.noteoff=function(e,t,n){o.sampler.triggerRelease(q(n.note),t)},o.controlchange=function(e,t,n){var a=n.controller.number,i=null;switch(!0){case 1===a:i=function(){o.psSpread=12*n.value,o.pitchShift.pitch=o.ps*o.psSpread};break;case 75<=a&&a<=79:i=function(){o.panVol.mute=!n.value,o.panVol.volume.value=50*(n.value-1)};break;case 15<=a&&a<=19:i=function(){o.panVol.mute=!n.value};break;case 28===a:i=function(){o.panVol.pan.value=2*n.value-1};break;default:console.log("[Sampler #controlchange] Unsupported CC event on channel ".concat(n.channel,":"),n.controller,n.value)}i&&r.Draw.schedule(i,t)},o.pitchbend=function(e,t,n){r.Draw.schedule((function(){o.ps=n.value,o.pitchShift.pitch=o.ps*o.psSpread}),t)},o.ctrls.sliders={},o.panVol=new r.PanVol(0,0).toDestination(),o.pitchShift=(new r.PitchShift).connect(o.panVol),o.sampler=e.connect(o.pitchShift),o}return Object(O.a)(n,[{key:"loaded",value:function(){return this.sampler.loaded}}]),n}($),ae=["BD0010.WAV","BD0050.WAV","SD7510.WAV","CP.WAV","CH.WAV","OH10.WAV","LT00.WAV","MT00.WAV","HT00.WAV","LC00.WAV","MC00.WAV","HC00.WAV","CB.WAV","CY0075.WAV","MA.WAV","RS.WAV"];var ie=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,function(){for(var e={},t=0;t<ae.length;++t)e[t]=ae[t%ae.length];return new r.Sampler({urls:e,release:1,baseUrl:"/samples/808/"})}())).sketch=void 0,o.noteon=function(e,t,n){var a=o.modNote(n.note);o.sampler.triggerAttack(q(a),t,n.attack),r.Draw.schedule((function(){var e=o.sketch,t=e.bgCol,n=e.ground;t.hue=Math.random(),t.sat=.4*Math.random()+.5,n.hue=t.hue,n.sat=t.sat,n.lgt=1.35*t.lgt}),t)},o.noteoff=function(e,t,n){var a=o.modNote(n.note);o.sampler.triggerRelease(q(a),t)},o.sketch=e,o}return Object(O.a)(n,[{key:"modNote",value:function(e){return(e+12)%ae.length}}]),n}(oe),se=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;for(var o in Object(s.a)(this,n),(e=t.call(this)).chorus=void 0,e.filter=void 0,e.amGain=void 0,e.synth=void 0,e.amOsc=void 0,e.panVol=void 0,e.ps=0,e.psSpread=7,e.harmonicity=new r.Multiply(3.03),e.freq=440,e.attacks=0,e.obj=void 0,e.wave=void 0,e.fft=void 0,e.noteon=function(t,n,o){e.freq=q(o.note)/2;try{e.attacks?e.synth.setNote(e.freq,n):e.synth.triggerAttack(e.freq,n,o.attack)}catch(a){}e.attacks++},e.noteoff=function(t,n,o){e.attacks=Math.max(0,e.attacks-1),e.attacks||e.synth.triggerRelease(n)},e.pitchbend=function(t,n,o){r.Draw.schedule((function(){e.ps=o.value,e.updatePitchbend()}),n)},e.updateModwheel=function(t){var n=Math.sin(t*Math.PI),o=1-n;o=1-o*o;var a=Math.pow(2,Math.floor(32*(1-t))/8-1);e.harmonicity.value=a,e.filter.Q.value=n*n*n*1,e.filter.frequency.value=Math.pow(10,3*(1-t)+1),e.amOsc.volume.value=t<.5?60*o-60:0},e.updatePitchbend=function(){e.synth.set({detune:100*e.ps*e.psSpread})},e.ctrls.sliders){var a=e.ctrls.sliders[o],i=a.value;switch(o){case"mod":i.value=a.valueNext=0;break;case"a":i.value=a.valueNext=.6;break;case"d":i.value=a.valueNext=.07;break;case"s":i.value=a.valueNext=1;break;case"r":i.value=a.valueNext=.6;break;case"vol":i.value=a.valueNext=.9}}e.panVol=new r.PanVol(0,0).toDestination(),e.chorus=new r.Chorus(.15,30,1).connect(e.panVol),e.filter=new r.Filter({type:"bandpass",frequency:1e3,Q:0}).connect(e.chorus),e.amGain=new r.Gain(1).connect(e.filter),e.synth=new r.Synth({oscillator:{type:"fatsawtooth",count:4,spread:59},portamento:.25}).connect(e.amGain),e.envelope=e.synth.envelope;var c=(new r.AudioToGain).connect(e.amGain.gain);e.amOsc=new r.OmniOscillator({type:"fatsquare",count:3,spread:30}).start().connect(c),e.synth.frequency.chain(e.harmonicity,e.amOsc.frequency),e.wave=new r.Waveform(32),e.panVol.connect(e.wave),e.fft=new r.FFT({size:16,normalRange:!0}),e.panVol.connect(e.fft);var u=T.getObj(re);return e.obj=u||new re(Object(M.a)(e),{scale:new A(4)}),e.updateValsFromSliders(),e}return Object(O.a)(n,[{key:"updateValForCtrl",value:function(e){Object(E.a)(Object(U.a)(n.prototype),"updateValForCtrl",this).call(this,e);var t=e.evt,o=e.slider;if(o&&"mod"===o.label)this.updateModwheel(o.value.value);else if(t){var a=t.controller.number,i=t.value*t.value;switch(!0){case 21===a:this.harmonicity.value=20*i;break;case 22===a:this.filter.frequency.rampTo(20+1e4*i,.005);break;case 23===a:this.filter.set({Q:8*i});break;case 24===a:this.synth.set({portamento:2*i});break;case 27===a:this.panVol.set({pan:2*t.value-1});break;case 75<=a&&a<=79:this.panVol.mute=!t.value,this.panVol.set({volume:50*(t.value-1)});break;case 15<=a&&a<=19:this.panVol.mute=!t.value}}}},{key:"loaded",value:function(){return!0}}]),n}($),re=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e,o){var a;return Object(s.a)(this,n),(a=t.call(this,o)).inst=void 0,a.hue=0,a.every=0,a.ff=0,a.drawFunc=function(e){e.rotateX(a.ff/59371),e.rotateY(a.ff/-37523),e.rotateZ(a.ff/294783);for(var t=a.inst.fft.getValue(),n=[],o=2;o<t.length;o++)n[o-2]=t[o]*o*100;var i=Math.max.apply(Math,[.001].concat(Object(y.a)(n)));n=n.map((function(e){return e/i})).filter((function(e){return e>.05}));var s=a.inst.wave.getValue();e.colorMode(e.HSL,1),e.noFill().strokeWeight(3);for(var r=0;r<s.length;r++){var c=2e3*s[r];a.ff++;var u=a.ff%n.length||0,l=(u/t.length*6.7+a.ff/1e5%1)%1,h=(n[u]||0)/2+.5;e.stroke(l,h,.5),e.rotateZ(2*Math.PI/s.length),e.line(0,0,0,c)}e.rotateX(-Math.PI/2);for(var d=0;d<s.length;d++){var p=2e3*s[d];a.ff++;var f=a.ff%n.length||0,v=(f/t.length*6.7+a.ff/1e5%1)%1,m=(n[f]||0)/2+.5;e.stroke(v,m,.5),e.rotateZ(2*Math.PI/s.length),e.line(0,0,0,p)}e.rotateY(-Math.PI/2);for(var b=0;b<s.length;b++){var w=2e3*s[b];a.ff++;var g=a.ff%n.length||0,k=(g/t.length*6.7+a.ff/1e5%1)%1,x=(n[g]||0)/2+.5;e.stroke(k,x,.5),e.rotateZ(2*Math.PI/s.length),e.line(0,0,0,w)}},a.inst=e,a}return n}(N),ce=["MA.WAV","RS.WAV"];var ue=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,function(){for(var e={},t=0;t<ce.length;++t)e[t]=ce[t%ce.length];return new r.Sampler({urls:e,release:1,baseUrl:"/samples/808/"})}())).sketch=void 0,o.noteon=function(e,t,n){var a=o.modNote(n.note);o.sampler.triggerAttack(q(a),t,n.attack)},o.noteoff=function(e,t,n){var a=o.modNote(n.note);o.sampler.triggerRelease(q(a),t)},o.sketch=e,o.panVol.set({volume:-10}),o.panVol.mute=!0,o}return Object(O.a)(n,[{key:"modNote",value:function(e){return e%ce.length}}]),n}(oe),le={A0:"A0.mp3",C1:"C1.mp3","D#1":"Ds1.mp3","F#1":"Fs1.mp3",A1:"A1.mp3",C2:"C2.mp3","D#2":"Ds2.mp3","F#2":"Fs2.mp3",A2:"A2.mp3",C3:"C3.mp3","D#3":"Ds3.mp3","F#3":"Fs3.mp3",A3:"A3.mp3",C4:"C4.mp3","D#4":"Ds4.mp3","F#4":"Fs4.mp3",A4:"A4.mp3",C5:"C5.mp3","D#5":"Ds5.mp3","F#5":"Fs5.mp3",A5:"A5.mp3",C6:"C6.mp3","D#6":"Ds6.mp3","F#6":"Fs6.mp3",A6:"A6.mp3",C7:"C7.mp3","D#7":"Ds7.mp3","F#7":"Fs7.mp3",A7:"A7.mp3",C8:"C8.mp3"};var he=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){return Object(s.a)(this,n),t.call(this,new r.Sampler({urls:le,release:1,baseUrl:"https://tonejs.github.io/audio/salamander/"}))}return n}(oe),de=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(e,o){var a;return Object(s.a)(this,n),(a=t.call(this,o)).polySynth=void 0,a.createdAt=void 0,a.noteEvt=void 0,a.scaleOrig=void 0,a.voice=null,a.hue=Math.random(),a.lgt=.3,a.envValLast=1,a.update=function(e){var t=1-a.polySynth.modwheel;t=1-t*t,a.lgt=.8*t+.2,a.hue+=(2*Math.random()-1)*e*t,a.hue<0?a.hue+=1:a.hue>1&&(a.hue-=1),a.xform.rot.applyAdd(Z().applyMult(e*t))},a.render=function(e){e.colorMode(e.HSL,1),e.fill(a.hue,.8,a.lgt),e.stroke(a.hue,.8,a.lgt-.2),e.strokeWeight(1),e.sphere(1,3,4),e.colorMode(e.RGB,255)},a.polySynth=e,a.createdAt=(new Date).valueOf()/1e3,a.noteEvt=o.noteEvt,a.drawFunc=a.render,a.scaleOrig=a.xform.scale.clone(),a}return n}(N),pe=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;return Object(s.a)(this,n),(e=t.call(this)).synth=void 0,e.filter=void 0,e.filterVol=void 0,e.reverb=void 0,e.panVol=void 0,e.ps=0,e.psSpread=7,e.attack=.01,e.decay=.07,e.sustain=.3,e.release=.6,e.modwheel=.3,e.objs=[],e.maxObjs=24,e.ii=0,e.setFilterGain=function(t){e.filter.set({gain:t}),e.filterVol.volume.set({value:Math.min(0,-t)})},e.noteon=function(t,n,o){e.synth.triggerAttack(q(o.note),n,o.attack),r.Draw.schedule((function(){return e.addSynthObj(t,o)}),n)},e.noteoff=function(t,n,o){var a=q(o.note);r.Draw.schedule((function(){var t,n=Object(i.a)(e.synth._activeVoices);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.released||o.midi!==a||o.voice.triggerRelease(r.immediate())}}catch(s){n.e(s)}finally{n.f()}}),"+".concat(n-r.immediate()))},e.controlchange=function(t,n,o){var a=o.controller.number,i=null;switch(!0){case 1===a:i=function(){var t=o.value*o.value;e.filter.frequency.rampTo(20+1e4*t,.005),e.modwheel=o.value};break;case 21===a:i=function(){var t=o.value*o.value;e.filter.set({Q:8*t})};break;case 27===a:i=function(){e.psSpread=12*o.value,e.updatePitchbend()};break;case 28===a:i=function(){e.panVol.set({pan:2*o.value-1})};break;case 71<=a&&a<=74:var s=o.value*o.value*o.value*o.value,c=["attack","decay","sustain","release"][a-71];i=function(){s="sustain"===c?o.value:10*s,Object(M.a)(e)[c]=s,e.synth.set({envelope:Object(x.a)({},c,s)})};break;case 75<=a&&a<=79:i=function(){e.panVol.mute=!o.value,e.panVol.set({volume:50*(o.value-1)})};break;case 15<=a&&a<=19:i=function(){e.panVol.mute=!o.value};break;default:console.log("[PolySynth #controlchange] Unsupported CC event on channel ".concat(o.channel,":"),o.controller,o.value)}i&&r.Draw.schedule(i,n)},e.pitchbend=function(t,n,o){r.Draw.schedule((function(){e.ps=o.value,e.updatePitchbend()}),n)},e.updatePitchbend=function(){e.synth.set({detune:100*e.ps*e.psSpread})},e.lastPos={},e.addSynthObj=function(t,n){var o=Object(M.a)(e),a=o.objs,s=o.maxObjs,r=t.user.clientId,c=t.xform.pos;e.lastPos[r]&&(c=e.lastPos[r]);var u=new A(Y(),Math.random(),Y()).applyMult(60);if(c=c.cloneAdd(u),e.ii++%8===0||c.y>1e3){var l,h=Object(i.a)(a);try{for(h.s();!(l=h.n()).done;){l.value.xform.scale.applyMult(.6)}}catch(g){h.e(g)}finally{h.f()}var d=t.facing,p=t.xform,f=p.pos,v=p.scale,m=Math.random()*Math.PI*2,y=d.cloneMult(400);c.x=f.x+y.x+3*v.x*Math.sin(m),c.y=f.y,c.z=f.z+y.z+3*v.x*Math.cos(m)}e.lastPos[r]=c;var b=new A(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),w=new de(Object(M.a)(e),{noteEvt:n,pos:c,rot:b,scale:new A(100)});a.unshift(w),T.addObj(w),a.length>s&&(T.rmObj(a[a.length-1]),e.objs=a.slice(0,s))},e.ctrls.sliders={},e.panVol=new r.PanVol(0,0).toDestination(),e.reverb=new r.Reverb({decay:4,wet:.6}).connect(e.panVol),e.filterVol=new r.Volume(0).connect(e.reverb),e.filter=new r.Filter({type:"bandpass",frequency:1e3,Q:2}).connect(e.filterVol),e.synth=new r.PolySynth(r.Synth,{oscillator:{type:"fatsquare",count:3,spread:30},envelope:{attack:e.attack,decay:e.decay,sustain:e.sustain,release:e.release}}).connect(e.filter),e}return Object(O.a)(n,[{key:"loaded",value:function(){return!0}}]),n}($),fe={},ve={LIBRARY:"p5.EasyCam",VERSION:"1.0.10",AUTHOR:"p5.EasyCam authors",SOURCE:"https://github.com/freshfork/p5.EasyCam",toString:function(){return this.LIBRARY+" v"+this.VERSION+" by "+this.AUTHOR+" ("+this.SOURCE+")"}},me=function(){function e(t,n){if(Object(s.a)(this,e),t instanceof window.p5.RendererGL){void 0===(n=n||{}).distance&&(n.distance=500),void 0===n.center&&(n.center=[0,0,0]),void 0===n.rotation&&(n.rotation=we.identity()),void 0===n.viewport&&(n.viewport=[0,0,t.width,t.height]),this.INFO=ve,this.setCanvas(t);var o=this;this.cam=o,this.LOOK=[0,0,1],this.UP=[0,1,0],this.AXIS=new function(){this.YAW=1,this.PITCH=2,this.ROLL=4,this.ALL=this.YAW|this.PITCH|this.ROLL},this.SHIFT_CONSTRAINT=0,this.FIXED_CONSTRAINT=0,this.DRAG_CONSTRAINT=0,this.scale_rotation=.001,this.scale_pan=2e-4,this.scale_zoom=.001,this.scale_zoomwheel=20,this.distance_min_limit=.01,this.distance_min=1,this.distance_max=Number.MAX_VALUE,this.state={distance:n.distance,center:n.center.slice(),rotation:n.rotation.slice(),copy:function(e){return(e=e||{}).distance=this.distance,e.center=this.center.slice(),e.rotation=this.rotation.slice(),e}},this.state_reset=this.state.copy(),this.state_pushed=this.state.copy(),this.viewport=n.viewport.slice(),this.mouse={cam:o,curr:[0,0,0],prev:[0,0,0],dist:[0,0,0],mwheel:0,isPressed:!1,istouchdown:!1,ismousedown:!1,BUTTON:{LMB:1,MMB:2,RMB:4},button:0,mouseDragLeft:o.mouseDragRotate.bind(o),mouseDragCenter:o.mouseDragPan.bind(o),mouseDragRight:o.mouseDragZoom.bind(o),mouseWheelAction:o.mouseWheelZoom.bind(o),touchmoveSingle:o.mouseDragRotate.bind(o),touchmoveMulti:function(){o.mouseDragPan(),o.mouseDragZoom()},insideViewport:function(e,t){var n=o.viewport[0],a=n+o.viewport[2],i=o.viewport[1],s=i+o.viewport[3];return e>n&&e<a&&t>i&&t<s},solveConstraint:function(){var e=this.dist[0],t=this.dist[1];this.shiftKey&&!o.SHIFT_CONSTRAINT&&Math.abs(e-t)>1&&(o.SHIFT_CONSTRAINT=Math.abs(e)>Math.abs(t)?o.AXIS.YAW:o.AXIS.PITCH),o.DRAG_CONSTRAINT=o.AXIS.ALL,o.FIXED_CONSTRAINT&&(o.DRAG_CONSTRAINT=o.FIXED_CONSTRAINT),o.SHIFT_CONSTRAINT&&(o.DRAG_CONSTRAINT=o.SHIFT_CONSTRAINT)},updateInput:function(e,t,n){var a=o.mouse,i=o.P5.pixelDensity();a.prev[0]=a.curr[0],a.prev[1]=a.curr[1],a.prev[2]=a.curr[2],a.curr[0]=e,a.curr[1]=t,a.curr[2]=n,a.dist[0]=-(a.curr[0]-a.prev[0])/i,a.dist[1]=-(a.curr[1]-a.prev[1])/i,a.dist[2]=-(a.curr[2]-a.prev[2])/i},mousedown:function(e){var t=o.mouse;0===e.button&&(t.button|=t.BUTTON.LMB),1===e.button&&(t.button|=t.BUTTON.MMB),2===e.button&&(t.button|=t.BUTTON.RMB),t.insideViewport(e.x,e.y)&&(t.updateInput(e.x,e.y,e.y),t.ismousedown=t.button>0,t.isPressed=t.ismousedown,o.SHIFT_CONSTRAINT=0)},mousedrag:function(){var e=o.mouse;if(e.ismousedown){var t=o.P5.mouseX,n=o.P5.mouseY,a=n;e.updateInput(t,n,a),e.solveConstraint();var i=e.button&e.BUTTON.LMB,s=e.button&e.BUTTON.MMB,r=e.button&e.BUTTON.RMB;i&&e.mouseDragLeft&&e.mouseDragLeft(),s&&e.mouseDragCenter&&e.mouseDragCenter(),r&&e.mouseDragRight&&e.mouseDragRight()}},mouseup:function(e){var t=o.mouse;0===e.button&&(t.button&=~t.BUTTON.LMB),1===e.button&&(t.button&=~t.BUTTON.MMB),2===e.button&&(t.button&=~t.BUTTON.RMB),t.ismousedown=t.button>0,t.isPressed=t.istouchdown||t.ismousedown,o.SHIFT_CONSTRAINT=0},dblclick:function(e){var t=e.x,n=e.y;o.mouse.insideViewport(t,n)&&o.reset()},wheel:function(e){var t=e.x,n=e.y,a=o.mouse;a.insideViewport(t,n)&&(a.mwheel=.01*e.deltaY,a.mouseWheelAction&&a.mouseWheelAction())},evaluateTouches:function(e){var t,n,a,i=e.touches,s=0,r=0,c=0,u=i.length;for(t=0;t<u;t++)s+=i[t].clientX,r+=i[t].clientY;for(s/=u,r/=u,t=0;t<u;t++)n=s-i[t].clientX,a=r-i[t].clientY,c+=Math.sqrt(n*n+a*a);c/=u,o.mouse.updateInput(s,r,-c)},touchstart:function(e){e.preventDefault(),e.stopPropagation();var t=o.mouse;t.evaluateTouches(e),t.istouchdown=t.insideViewport(t.curr[0],t.curr[1]),t.isPressed=o.mouse.istouchdown||o.mouse.ismousedown,t.dbltap(e)},touchmove:function(e){e.preventDefault(),e.stopPropagation();var t=o.mouse;t.istouchdown&&(t.evaluateTouches(e),t.solveConstraint(),1===e.touches.length?t.touchmoveSingle():(t.touchmoveMulti(),t.tapcount=0))},touchend:function(e){e.preventDefault(),e.stopPropagation();var t=o.mouse;t.istouchdown=!1,t.isPressed=t.istouchdown||t.ismousedown,o.SHIFT_CONSTRAINT=0,t.tapcount>=2&&(t.insideViewport(t.curr[0],t.curr[1])&&o.reset(),t.tapcount=0)},tapcount:0,dbltap:function(e){0===o.mouse.tapcount++&&setTimeout((function(){o.mouse.tapcount=0}),350)},shiftKey:!1,keydown:function(e){var t=o.mouse;t.shiftKey||(t.shiftKey=16===e.keyCode)},keyup:function(e){var t=o.mouse;t.shiftKey&&(t.shiftKey=16!==e.keyCode,t.shiftKey||(o.SHIFT_CONSTRAINT=0))}},this.attachMouseListeners(),this.auto_update=!0,this.P5.registerMethod("pre",(function(){o.auto_update&&o.update()})),this.dampedZoom=new ye((function(e){o.zoom(e*o.getZoomMult())})),this.dampedPanX=new ye((function(e){o.panX(e*o.getPanMult())})),this.dampedPanY=new ye((function(e){o.panY(e*o.getPanMult())})),this.dampedPanZ=new ye((function(e){o.panZ(e*o.getPanMult())})),this.dampedRotX=new ye((function(e){o.rotateX(e*o.getRotationMult())})),this.dampedRotY=new ye((function(e){o.rotateY(e*o.getRotationMult())})),this.dampedRotZ=new ye((function(e){o.rotateZ(e*o.getRotationMult())})),this.timedRot=new be(o.setInterpolatedRotation.bind(o)),this.timedPan=new be(o.setInterpolatedCenter.bind(o)),this.timedzoom=new be(o.setInterpolatedDistance.bind(o))}else console.log("renderer needs to be an instance of p5.RendererGL")}return Object(O.a)(e,[{key:"setCanvas",value:function(e){e instanceof window.p5.RendererGL?(this.renderer=e,e._pInst instanceof window.p5?this.graphics=e:this.graphics=e._pInst,this.P5=this.graphics._pInst):(this.graphics=void 0,this.renderer=void 0)}},{key:"getCanvas",value:function(){return this.renderer}},{key:"attachListener",value:function(e,t,n,o){e&&e!==n.el&&(this.detachListener(n),n.el=e,n.ev=t,n.op=o,n.el.addEventListener(n.ev,n,n.op))}},{key:"detachListener",value:function(e){e.el&&(e.el.removeEventListener(e.ev,e,e.op),e.el=void 0)}},{key:"attachMouseListeners",value:function(e){var t=this.cam,n=t.mouse;if(e=e||t.renderer){var o={passive:!1},a=e.elt;t.attachListener(a,"mousedown",n.mousedown,o),t.attachListener(a,"mouseup",n.mouseup,o),t.attachListener(a,"wheel",n.wheel,o),t.attachListener(a,"touchstart",n.touchstart,o),t.attachListener(a,"touchend",n.touchend,o),t.attachListener(a,"touchmove",n.touchmove,o),t.attachListener(window,"keydown",n.keydown,o),t.attachListener(window,"keyup",n.keyup,o)}}},{key:"removeMouseListeners",value:function(){var e=this.cam,t=e.mouse;e.detachListener(t.mousedown),e.detachListener(t.mouseup),e.detachListener(t.wheel),e.detachListener(t.keydown),e.detachListener(t.keyup),e.detachListener(t.touchstart),e.detachListener(t.touchend),e.detachListener(t.touchmove)}},{key:"dispose",value:function(){}},{key:"getAutoUpdate",value:function(){return this.auto_update}},{key:"setAutoUpdate",value:function(e){this.auto_update=e}},{key:"update",value:function(){var e=this.cam;e.mouse.mousedrag();var t=!1;t|=e.dampedZoom.update(),t|=e.dampedPanX.update(),t|=e.dampedPanY.update(),t|=e.dampedPanZ.update(),t|=e.dampedRotX.update(),t|=e.dampedRotY.update(),(t|=e.dampedRotZ.update())?(e.timedRot.stop(),e.timedPan.stop(),e.timedzoom.stop()):(e.timedRot.update(),e.timedPan.update(),e.timedzoom.update()),e.apply()}},{key:"apply",value:function(e){var t=this.cam;(e=e||t.renderer)&&(this.camEYE=this.getPosition(this.camEYE),this.camLAT=this.getCenter(this.camLAT),this.camRUP=this.getUpVector(this.camRUP),void 0===e._curCamera?e.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]):e._curCamera.camera(this.camEYE[0],this.camEYE[1],this.camEYE[2],this.camLAT[0],this.camLAT[1],this.camLAT[2],this.camRUP[0],this.camRUP[1],this.camRUP[2]))}},{key:"setViewport",value:function(e){this.viewport=e.slice()}},{key:"getViewport",value:function(){return this.viewport}},{key:"mouseWheelZoom",value:function(){var e=this.mouse;this.dampedZoom.addForce(e.mwheel*this.scale_zoomwheel)}},{key:"mouseDragZoom",value:function(){var e=this.mouse;this.dampedZoom.addForce(-e.dist[2])}},{key:"mouseDragPan",value:function(){var e=this.mouse;this.dampedPanX.addForce(this.DRAG_CONSTRAINT&this.AXIS.YAW?e.dist[0]:0),this.dampedPanY.addForce(this.DRAG_CONSTRAINT&this.AXIS.PITCH?e.dist[1]:0)}},{key:"mouseDragRotate",value:function(){var e=this,t=e.mouse,n=t.curr[0],o=t.curr[1],a=t.dist[0],i=t.dist[1],s=2*Math.min(Math.max((n-e.viewport[0])/e.viewport[2],0),1)-1,r=2*Math.min(Math.max((o-e.viewport[1])/e.viewport[3],0),1)-1;e.DRAG_CONSTRAINT&e.AXIS.YAW&&e.dampedRotY.addForce(+a*(1-r*r)),e.DRAG_CONSTRAINT&e.AXIS.PITCH&&e.dampedRotX.addForce(-i*(1-s*s)),e.DRAG_CONSTRAINT&e.AXIS.ROLL&&(e.dampedRotZ.addForce(-a*r),e.dampedRotZ.addForce(+i*s))}},{key:"getZoomMult",value:function(){return this.state.distance*this.scale_zoom}},{key:"getPanMult",value:function(){return this.state.distance*this.scale_pan}},{key:"getRotationMult",value:function(){return Math.pow(Math.log10(1+this.state.distance),.5)*this.scale_rotation}},{key:"zoom",value:function(e){var t=this.cam,n=t.state.distance+e;n<t.distance_min&&(n=t.distance_min,t.dampedZoom.stop()),n>t.distance_max&&(n=t.distance_max,t.dampedZoom.stop()),t.state.distance=n}},{key:"panX",value:function(e){var t=this.cam.state;if(e){var n=we.applyToVec3(t.rotation,[e,0,0]);ke.add(t.center,n,t.center)}}},{key:"panY",value:function(e){var t=this.cam.state;if(e){var n=we.applyToVec3(t.rotation,[0,e,0]);ke.add(t.center,n,t.center)}}},{key:"panZ",value:function(e){var t=this.cam.state;if(e){var n=we.applyToVec3(t.rotation,[0,0,e]);ke.add(t.center,n,t.center)}}},{key:"panGround",value:function(e,t,n){var o=this.centerAxes();ke.mult(o.x,e,o.x),ke.mult(o.z,n,o.z);var a=[0,0,0];ke.add(o.x,o.z,a),a[1]=t,ke.add(this.cam.state.center,a,this.cam.state.center)}},{key:"centerAxes",value:function(){var e=this.cam.state,t=we.applyToVec3(e.rotation,[1,0,0]);t[1]=0;var n=ke.mag(t);0===n&&(console.warn("[EasyCam] No magnitude for screenX vector",t),n=1),ke.mult(t,1/n,t);var o=[0,0,0];return ke.cross(t,[0,1,0],o),{x:t,y:[0,1,0],z:o}}},{key:"pan",value:function(e,t,n){this.cam.panX(e),this.cam.panY(t),this.cam.panZ(n)}},{key:"rotateX",value:function(e){this.cam.rotate([1,0,0],e)}},{key:"rotateY",value:function(e){this.cam.rotate([0,1,0],e)}},{key:"rotateZ",value:function(e){this.cam.rotate([0,0,1],e)}},{key:"rotate",value:function(e,t){var n=this.cam.state;if(t){var o=we.create({axis:e,angle:t});we.applyToRotation(n.rotation,o,n.rotation)}}},{key:"setInterpolatedDistance",value:function(e,t,n){this.cam.state.distance=ge.mix(e,t,ge.smoothstep(n))}},{key:"setInterpolatedCenter",value:function(e,t,n){this.cam.state.center=ke.mix(e,t,ge.smoothstep(n))}},{key:"setInterpolatedRotation",value:function(e,t,n){this.cam.state.rotation=we.slerp(e,t,n)}},{key:"setDistanceMin",value:function(e){this.distance_min=Math.max(e,this.distance_min_limit),this.zoom(0)}},{key:"setDistanceMax",value:function(e){this.distance_max=e,this.zoom(0)}},{key:"setDistance",value:function(e,t){this.timedzoom.start(this.state.distance,e,t,[this.dampedZoom])}},{key:"getDistance",value:function(){return this.state.distance}},{key:"setCenter",value:function(e,t){this.timedPan.start(this.state.center,e,t,[this.dampedPanX,this.dampedPanY])}},{key:"getCenter",value:function(){return this.state.center}},{key:"setRotation",value:function(e,t){this.timedRot.start(this.state.rotation,e,t,[this.dampedRotX,this.dampedRotY,this.dampedRotZ])}},{key:"getRotation",value:function(){return this.state.rotation}},{key:"getPosition",value:function(e){var t=this.cam,n=t.state;return e=ke.assert(e),we.applyToVec3(n.rotation,t.LOOK,e),ke.mult(e,n.distance,e),ke.add(e,n.center,e),e}},{key:"getUpVector",value:function(e){var t=this.cam,n=t.state;return e=ke.assert(e),we.applyToVec3(n.rotation,t.UP,e),e}},{key:"getState",value:function(){return this.state.copy()}},{key:"setState",value:function(e,t){e&&(this.setDistance(e.distance,t),this.setCenter(e.center,t),this.setRotation(e.rotation,t))}},{key:"pushState",value:function(){return this.state_pushed=this.getState()}},{key:"popState",value:function(e){this.setState(this.state_pushed,e)}},{key:"pushResetState",value:function(){return this.state_reset=this.getState()}},{key:"reset",value:function(e){this.setState(this.state_reset,e)}},{key:"setRotationScale",value:function(e){this.scale_rotation=e}},{key:"setPanScale",value:function(e){this.scale_pan=e}},{key:"setZoomScale",value:function(e){this.scale_zoom=e}},{key:"setWheelScale",value:function(e){this.scale_zoomwheel=e}},{key:"getRotationScale",value:function(){return this.scale_rotation}},{key:"getPanScale",value:function(){return this.scale_pan}},{key:"getZoomScale",value:function(){return this.scale_zoom}},{key:"getWheelScale",value:function(){return this.scale_zoomwheel}},{key:"setDamping",value:function(e){this.dampedZoom.damping=e,this.dampedPanX.damping=e,this.dampedPanY.damping=e,this.dampedPanZ.damping=e,this.dampedRotX.damping=e,this.dampedRotY.damping=e,this.dampedRotZ.damping=e}},{key:"setDefaultInterpolationTime",value:function(e){this.timedRot.default_duration=e,this.timedPan.default_duration=e,this.timedzoom.default_duration=e}},{key:"setRotationConstraint",value:function(e,t,n){var o=this.cam;o.FIXED_CONSTRAINT=0,o.FIXED_CONSTRAINT|=e?o.AXIS.YAW:0,o.FIXED_CONSTRAINT|=t?o.AXIS.PITCH:0,o.FIXED_CONSTRAINT|=n?o.AXIS.ROLL:0}},{key:"beginHUD",value:function(e,t,n){var o=this.cam;if(e=e||o.renderer){this.pushed_rendererState=e.push();var a=e.drawingContext,i=void 0!==t?t:e.width,s=void 0!==n?n:e.height,r=Number.MAX_VALUE;a.flush(),a.disable(a.DEPTH_TEST),this.pushed_uMVMatrix=e.uMVMatrix.copy(),this.pushed_uPMatrix=e.uPMatrix.copy(),e.resetMatrix(),e._curCamera.ortho(0,i,-s,0,-r,+r)}}},{key:"endHUD",value:function(e){var t=this.cam;if(e=e||t.renderer){var n=e.drawingContext;n.flush(),e.uMVMatrix.set(this.pushed_uMVMatrix),e.uPMatrix.set(this.pushed_uPMatrix),n.enable(n.DEPTH_TEST),e.pop(this.pushed_rendererState)}}}]),e}(),ye=function(){function e(t){Object(s.a)(this,e),this.value=0,this.damping=.85,this.action=t}return Object(O.a)(e,[{key:"addForce",value:function(e){this.value+=e}},{key:"update",value:function(){var e=this.value*this.value>1e-6;return e?(this.action(this.value),this.value*=this.damping):this.stop(),e}},{key:"stop",value:function(){this.value=0}}]),e}(),be=function(){function e(t){Object(s.a)(this,e),this.default_duration=300,this.action=t}return Object(O.a)(e,[{key:"start",value:function(e,t,n,o){for(var a in o)o[a].stop();this.valA=e,this.valB=t,this.duration=void 0===n?this.default_duration:n,this.timer=(new Date).getTime(),this.active=this.duration>0,this.active||this.interpolate(1)}},{key:"update",value:function(){if(this.active){var e=((new Date).getTime()-this.timer)/this.duration;e>.995?(this.interpolate(1),this.stop()):this.interpolate(e)}}},{key:"interpolate",value:function(e){this.action(this.valA,this.valB,e)}},{key:"stop",value:function(){this.active=!1}}]),e}(),we={assert:function(e){return void 0===e||e.constructor!==Array?[1,0,0,0]:e},identity:function(){return[1,0,0,0]},applyToVec3:function(e,t,n){var o=Object(u.a)(t,3),a=o[0],i=o[1],s=o[2],r=Object(u.a)(e,4),c=r[0],l=r[1],h=r[2],d=r[3],p=l*a+h*i+d*s;return(n=ke.assert(n))[0]=2*(c*(a*c-(h*s-d*i))+p*l)-a,n[1]=2*(c*(i*c-(d*a-l*s))+p*h)-i,n[2]=2*(c*(s*c-(l*i-h*a))+p*d)-s,n},applyToRotation:function(e,t,n){var o=Object(u.a)(e,4),a=o[0],i=o[1],s=o[2],r=o[3],c=Object(u.a)(t,4),l=c[0],h=c[1],d=c[2],p=c[3];return(n=we.assert(n))[0]=l*a-(h*i+d*s+p*r),n[1]=h*a+l*i+(d*r-p*s),n[2]=d*a+l*s+(p*i-h*r),n[3]=p*a+l*r+(h*s-d*i),n},slerp:function(e,t,n,o){var a=Object(u.a)(e,4),i=a[0],s=a[1],r=a[2],c=a[3],l=Object(u.a)(t,4),h=l[0],d=l[1],p=l[2],f=l[3],v=i*h+s*d+r*p+c*f;v<0&&(h=-h,d=-d,p=-p,f=-f,v=-v);var m,y,b=Math.acos(v),w=Math.sqrt(1-v*v);return w>.001?(m=Math.sin((1-n)*b)/w,y=Math.sin(n*b)/w):(m=1-n,y=n),(o=we.assert(o))[0]=m*i+y*h,o[1]=m*s+y*d,o[2]=m*r+y*p,o[3]=m*c+y*f,we.create({rotation:o,normalize:!0},o)},create:function(e,t){if(t=we.assert(t),e.axis){var n=e.axis,o=e.angle,a=ke.mag(n);if(0===a)return;var i=-.5*o,s=Math.sin(i)/a;return t[0]=Math.cos(i),t[1]=s*n[0],t[2]=s*n[1],t[3]=s*n[2],t}if(e.rotation){if(t[0]=e.rotation[0],t[1]=e.rotation[1],t[2]=e.rotation[2],t[3]=e.rotation[3],e.normalize){var r=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]);t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r}return t}if(e.angles_xyz){var c=-.5*e.angles_xyz[0],u=-.5*e.angles_xyz[1],l=-.5*e.angles_xyz[2],h=[Math.cos(c),Math.sin(c),0,0],d=[Math.cos(u),0,Math.sin(u),0],p=[Math.cos(l),0,0,Math.sin(l)];return we.applyToRotation(d,p,t),we.applyToRotation(h,t,t),t}}},ge={mix:function(e,t,n){return e*(1-n)+t*n},smoothstep:function(e){return e*e*(3-2*e)},smootherstep:function(e){return e*e*e*(e*(6*e-15)+10)}},ke={assert:function(e){return void 0===e||e.constructor!==Array?[0,0,0]:e},isScalar:function(e){return void 0!==e&&e.constructor!==Array},add:function(e,t,n){return n=this.assert(n),this.isScalar(t)?(n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2]),n},mult:function(e,t,n){return n=this.assert(n),this.isScalar(t)?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t):(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2]),n},magSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},mag:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,n){return(n=this.assert(n))[0]=e[1]*t[2]-e[2]*t[1],n[1]=e[2]*t[0]-e[0]*t[2],n[2]=e[0]*t[1]-e[1]*t[0],n},angle:function(e,t){var n=this.mag(e)*this.mag(t);if(0===n)return 0;var o=this.dot(e,t),a=.9999*n;if(o<-a||o>a){var i=this.cross(e,t);return o>=0?Math.asin(this.mag(i)/n):Math.PI-Math.asin(this.mag(i)/n)}return Math.acos(o/n)},mix:function(e,t,n,o){return(o=this.assert(o))[0]=ge.mix(e[0],t[0],n),o[1]=ge.mix(e[1],t[1],n),o[2]=ge.mix(e[2],t[2],n),o}};me.INFO=ve,Object.freeze(ve),fe.EasyCam=me,fe.DampedAction=ye,fe.Interpolation=be,fe.Rotation=we,fe.Vec3=ke,fe.Scalar=ge;function xe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e,a=t,i=n?.1:1;a<i&&(a*=1e3,o="m".concat(e)),a<i&&(a*=1e3,o="\xb5".concat(e));var s=a>=10?0:a>=1?1:2;return"".concat(a.toFixed(s)).concat(o)}var Oe=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(s.a)(this,e),this.pp=void 0,this.nameCustomized=!1,this.inputs={},this.hidden=!1,this.clockOpts={bpm:95},this.help=!1,this.helpRetoggle={loops:!0,dial:!0},this.helpImg=void 0,this.pingBeats=0,this.sliders=new K,this.bpm=function(){return t.inputs.bpm?t.inputs.bpm.value():t.clockOpts.bpm},this.isFocused=function(){for(var e in t.inputs){var n=t.inputs[e];if(n&&n.focused)return!0}return!1},this.toggleHide=function(){t.pp&&(t.hidden=!t.hidden,t.setup(t.pp),t.hidden||t.setupInputsBPM())},this.toggleHelp=function(){if(t.pp){var e=Le.loops;t.help=!t.help,t.help&&(t.helpRetoggle.loops=!e.hidden,t.helpRetoggle.dial=!e.hiddenDial),t.helpRetoggle.loops&&e.toggleHide(),t.helpRetoggle.dial&&e.toggleHideDial(),t.setup(t.pp),t.help||t.hidden||t.setupInputsBPM()}},this.setup=function(e){if(t.pp=e,t.helpImg||(t.helpImg=e.loadImage("/help-overlay.png")),t.hidden||t.help){for(var n in t.inputs){var o=t.inputs[n];o&&(o.remove(),delete t.inputs[n])}t.setupInputsHide(t.pp)}else t.setupInputsUser(Le.ws.clientId),t.setupInputsInstrument(),t.setupInputsHide(e)},this.setupInputsHide=function(e){t.inputs.hide&&t.inputs.hide.remove(),t.inputs.hideLoops&&t.inputs.hideLoops.remove(),t.inputs.hideDial&&t.inputs.hideDial.remove(),t.inputs.showHelp&&t.inputs.showHelp.remove();var n=Le.loops;t.inputs.showHelp=e.createButton(t.help?"Hide Help":"Show Help");var o=t.inputs.showHelp,a=e.width-o.width-50,i=e.height-o.height-10;if(o.position(a,i),o.mousePressed(t.toggleHelp),!t.help){a-=100,t.inputs.hide=e.createButton(t.hidden?"Show Settings":"Hide Settings"),t.inputs.hideLoops=e.createButton(n.toggleHideText()),t.inputs.hideDial=e.createButton(n.toggleHideDialText());var s=t.inputs,r=s.hide,c=s.hideLoops,u=s.hideDial;c.position(a,i),c.mousePressed((function(){n.toggleHide(),c.elt.innerHTML=n.toggleHideText()})),a-=130,u.position(a,i),u.mousePressed((function(){n.toggleHideDial(),u.elt.innerHTML=n.toggleHideDialText()})),a-=110,r.position(a,i),r.mousePressed(t.toggleHide)}},this.setupInputsUser=function(e){var n=Le.user,o=t.nameCustomized?n.name:"User ".concat(Le.ws.clientId);if(t.hidden)""===n.name&&Le.updateUser({name:o});else if(t.pp){t.inputs.name&&t.inputs.name.remove(),t.inputs.latency&&t.inputs.latency.remove(),t.inputs.name=t.pp.createInput(o),t.inputs.latency=t.pp.createInput("".concat(Le.user.offset));var a=t.inputs,i=a.name,s=a.latency;i.size(80),i.position(20,40),i.input((function(){t.nameCustomized=!0,Le.updateUser({name:i.value()})})),i.elt.onfocus=function(){return i.focused=!0},i.elt.onblur=function(){return i.focused=!1},Le.updateUser({name:i.value()},!1),s.size(50),s.position(i.x+i.width+10,40);var r=function(){var e=parseFloat(s.value());Number.isNaN(e)||(Le.updateUser({offset:e}),Le.loops.updateRecOffset(e))};s.input((function(){console.log("[SketchInputs #inputs.latency] Changed:",s.value()),r()})),s.elt.onfocus=function(){return s.focused=!0},s.elt.onblur=function(){return s.focused=!1},r()}else console.log("[SketchInputs #setupInputsUser] Attempted to setup user input before sketch was initialized")},this.setupInputsInstrument=function(){if(t.pp&&t.inputs.latency&&!t.hidden){t.inputs.instrument&&t.inputs.instrument.remove();var e=t.pp.createSelect();e.position(t.inputs.latency.x+t.inputs.latency.width+10,40);var n=Le.user.instrument;for(var o in e.size(130),Le.instruments)e.option(o),o===n&&e.selected(o);e.changed((function(){Le.updateUser({instrument:e.value()})})),e.elt.onfocus=function(){return e.focused=!0},e.elt.onblur=function(){return e.focused=!1},t.inputs.instrument=e,Le.updateUser({instrument:e.value()},!1)}},this.setupInputsMidi=function(e){if(t.pp&&t.inputs.instrument&&!t.hidden){t.inputs.inputDevice&&t.inputs.inputDevice.remove();var n=(e||{inputs:[]}).inputs,o=t.pp.createSelect(),a=t.inputs.instrument;o.position(a.x+a.width+10,40),o.option("keyboard");var s,r=Object(i.a)(n);try{for(r.s();!(s=r.n()).done;){var c=s.value._midiInput;c?o.option(c.name):console.error("[SketchInputs #setupInputsMidi] Received a midi input with missing data")}}catch(u){r.e(u)}finally{r.f()}o.selected(Le.user.inputDevice),o.changed((function(){Le.updateUser({inputDevice:o.value()})})),o.elt.onfocus=function(){return o.focused=!0},o.elt.onblur=function(){return o.focused=!1},t.inputs.inputDevice=o,Le.updateUser({inputDevice:o.value()},!1)}},this.setupInputsBPM=function(){if(t.pp&&!t.hidden){t.inputs.bpm&&t.inputs.bpm.remove();var e=t.pp.createSlider(30,200,t.clockOpts.bpm);e.position(20,t.pp.height-40),e.size(300),e.input((function(){t.clockOpts.bpm=e.value(),t.clockOpts.clientId=Le.user.clientId,t.sendClockUpdate(t.clockOpts)})),e.elt.onfocus=function(){return e.focused=!0},e.elt.onblur=function(){return e.focused=!1},t.inputs.bpm=e}},this.draw=function(e){if(t.help)t.drawHelp(e);else if(!t.hidden)for(var n in t.drawClockStats(e),t.sliders.draw(e),e.textSize(12).textAlign(e.LEFT,e.BOTTOM).textStyle(e.BOLD),e.fill(255).strokeWeight(1).stroke(0),t.inputs){var o=t.inputs[n];if(o){var a=o.x+3,i=o.y-5;switch(!0){case"hide"===n:case"hideLoops"===n:case"hideDial"===n:case"showHelp"===n:continue;case"latency"===n:e.push();var s=parseFloat(o.value()),r="";Number.isNaN(s)?(e.fill(255,40,40),r=" (NaN!)"):t.pingBeats>s/2&&(e.fill(255,128,0),r=" (check ping)"),e.text("".concat(n.toUpperCase()).concat(r,"\n","in beats"),a,i),e.pop();break;case n in Le.user:e.text(n.toUpperCase(),a,i);break;default:e.text("".concat(n.toUpperCase(),": ").concat(o.value()),a,i)}}}},this.drawClockStats=function(e){e.push(),e.colorMode(e.HSL,1);var n=function(){return e.fill(0,0,.7).textAlign(e.RIGHT,e.BOTTOM)},o=function(t){return e.textAlign(e.LEFT,e.BOTTOM).fill(0,t?1:0,t?.65:.85)},a=Le.beatMs(),i=e.height-140;if(e.fill(.58,.8,.65).strokeWeight(1).stroke(0),e.textAlign(e.LEFT,e.BOTTOM).textSize(13).textStyle(e.BOLD),e.text("Clock stats (B = beat = ".concat(xe("s",a/1e3),")"),20,i),e.textSize(12).strokeWeight(1),i+=20,!Le.ws.ready())return o(!0).text("NO CONNECTION TO SERVER",20,i),void e.pop();var s=Le.user.offset,r=Le.ws.clock,c=r.precisionNow,u=r.pingMs;t.pingBeats=u/a;var l=Math.abs(c),h="".concat(xe("s",l/1e3)," (").concat(xe("B",l/a,!0),")"),d="".concat(xe("s",u/1e3)," (").concat(xe("B",t.pingBeats,!0),")");n().text("precision:",80,i),o(l/a>=1/32).text(h,85,i),i+=20,n().text("ping:",80,i),o(t.pingBeats>s/2).text(d,85,i),e.pop()},this.drawHelp=function(e){if(t.helpImg){var n=t.helpImg.height/t.helpImg.width,o=e.width-80,a=n*o,i=(e.height-a)/2;e.background(60,220),e.image(t.helpImg,40,i,o,a)}},this.sendClockUpdate=function(e){var t=Le.ws,n=t.conn;(0,t.ready)()?n.send(Object(h.g)(e)):console.warn("[SketchInputs #sendClockUpdate] Can't send bpm update, websocket connection is not open")},this.onClockUpdate=function(e){t.clockOpts=e,t.inputs.bpm&&t.inputs.bpm.value(e.bpm)},this.nameCustomized=n},Me=n(693),Se=n.n(Me),Ie=function e(t){var n=this;Object(s.a)(this,e),this.sketch=void 0,this.audioKeys=void 0,this.customs={mod:.5,a:.02,d:.1,s:1,r:.3},this.customToCtrl={mod:1,a:71,d:72,s:73,r:74},this.keyPressed=function(e){var t=e.note,o=e.velocity;if(!n.sketch.keyboardInputDisabled()){var a=n.sketch.pp;if((!a||!a.keyIsDown(17))&&"keyboard"===n.sketch.user.inputDevice){var i={kind:"noteon",note:t,attack:o/128};n.sketch.sendUserEvent("keyboard","noteon",i)}}},this.keyReleased=function(e){var t=e.note;if(!n.sketch.keyboardInputDisabled()&&"keyboard"===n.sketch.user.inputDevice){var o={kind:"noteoff",note:t};n.sketch.sendUserEvent("keyboard","noteoff",o)}},this.keyPressedP5=function(e){switch(e.key){case"[":case"{":n.handleCustom("mod",!1);break;case"]":case"}":n.handleCustom("mod",!0);break;case"c":case"C":n.handleCustom("a",!1);break;case"v":case"V":n.handleCustom("a",!0);break;case"b":case"B":n.handleCustom("d",!1);break;case"n":case"N":n.handleCustom("d",!0);break;case"m":case"M":n.handleCustom("s",!1);break;case",":case"<":n.handleCustom("s",!0);break;case".":case">":n.handleCustom("r",!1);break;case"/":case"?":n.handleCustom("r",!0)}},this.handleCustom=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=n.customs,a=n.audioKeys._state.velocity/127;o[e]=t?Math.min(1,o[e]+a/4):Math.max(0,o[e]-a/4),n.sketch.sendUserEvent("keyboard","controlchange",{kind:"controlchange",channel:1,controller:{number:n.customToCtrl[e]},value:o[e]})},this.keyReleasedP5=function(e){},this.sketch=t,this.audioKeys=new Se.a({polyphony:1/0}),this.audioKeys.down(this.keyPressed),this.audioKeys.up(this.keyReleased)},Ae=n(8),Ce=n(739),Re=function e(t){var n=this;if(Object(s.a)(this,e),this.opts=void 0,this.id=void 0,this.xx=0,this.yy=0,this.evts=[],this.headPlay=0,this.headRec=0,this.isActive=!1,this.isDial=!1,this.isRecording=!1,this.isMuted=!1,this.loaded=!1,this.pgControls=void 0,this.pgNotes=void 0,this.needsRenderControls=!1,this.needsRenderNotes=!1,this.save=function(){var e=n.id,t=n.isMuted,o=n.evts,a=n.opts,i={id:e,beats:a.beats,evts:o,isMuted:t};a.sketch.localStorage.setItem(e,JSON.stringify(i))},this.load=function(){var e=n.id,t=n.opts,o=t.sketch.localStorage.getItem(e);if(!o||""===o)return n.loaded=!1,!1;var a=JSON.parse(o);return t.beats=a.beats,n.evts=a.evts,n.evts.forEach((function(e){return e.evt.timestamp=0})),n.isMuted=a.isMuted,n.loaded=!0,!0},this.remove=function(){n.opts.sketch.localStorage.removeItem(n.id)},this.setRadius=function(e){e!==n.opts.radius&&(n.opts.radius=e,n.pgControls&&(n.needsRenderControls=!0),n.pgNotes&&(n.needsRenderNotes=!0))},this.loopLenMs=function(){return n.opts.beats*n.opts.sketch.beatMs()},this.loopUserEvent=function(e){var t=n.opts.sketch,o=t.offsetMs(),a=t.nowMs(),s=n.timeGlobalToLoopNorm(a+o),r={evt:e,loopTime:s},c=e.midiEvent,u=c.kind,l=c.note;if("noteoff"===u){var h,d=n.filterNote(n.attackEvents(),l),p=null,f=1,v=s+1,m=Object(i.a)(d);try{for(m.s();!(h=m.n()).done;){var y=h.value,b=v-(y.loopTime>s?y.loopTime:y.loopTime+1);b<f&&(f=b,p=y)}}catch(w){m.e(w)}finally{m.f()}return p?p.release=r:console.warn("[Loop #loopUserEvent] No attack event found for release",r),void(n.needsRenderNotes=!0)}"controlchange"!==u&&"pitchbend"!==u||(n.needsRenderControls=!0),"noteon"!==u&&"noteoff"!==u||(n.needsRenderNotes=!0),n.evts.push(r)},this.sanitizeEvents=function(){n.evts=n.evts.filter((function(e){return"noteon"!==e.evt.midiEvent.kind||e.release}))},this.updateClientId=function(e){var t,o=Object(i.a)(n.evts);try{for(o.s();!(t=o.n()).done;){var a=t.value;a.evt.clientId=e,a.release&&(a.release.evt.clientId=e)}}catch(s){o.e(s)}finally{o.f()}},this.attackEvents=function(){return n.evts.filter((function(e){return"noteon"===e.evt.midiEvent.kind}))},this.releaseEvents=function(){return n.evts.filter((function(e){return"noteoff"===e.evt.midiEvent.kind}))},this.controlEvents=function(){return n.evts.filter((function(e){return"controlchange"===e.evt.midiEvent.kind||"pitchbend"===e.evt.midiEvent.kind}))},this.sortByLoopTime=function(e){return e.sort((function(e,t){return e.loopTime>t.loopTime?1:-1}))},this.groupByController=function(e){var t,n={},o=Object(i.a)(e);try{for(o.s();!(t=o.n()).done;){var a=t.value,s=a.evt.midiEvent.controller,r=s?s.number:0;n[r]||(n[r]=[]),n[r].push(a)}}catch(c){o.e(c)}finally{o.f()}return n},this.filterNote=function(e,t){return e.filter((function(e){return e.evt.midiEvent.note===t}))},this.clearAllEvents=function(){n.evts=[],n.save(),n.pgControls&&(n.needsRenderControls=!0),n.pgNotes&&(n.needsRenderNotes=!0)},this.update=function(){var e=n.opts.sketch,t=e.nowMs(),o=e.offsetMs(),a=n.timeGlobalToLoopNorm(t),s=n.timeGlobalToLoopNorm(t+o),r=n.headRec;if(n.headPlay=a,n.headRec=s,!n.isMuted){var c,u=Object(i.a)(n.evts);try{for(u.s();!(c=u.n()).done;){var l=c.value,h=l.evt,d=l.loopTime,p=l.release,f=d;if(!(h.timestamp>t-e.beatMs()/2)&&(s<r&&(f<=s&&(f+=1),s+=1),r<f&&f<=s&&(e._sendUserEvent(Object(Ae.a)(Object(Ae.a)({},l.evt),{},{timestamp:n.timeLoopNormToGlobal(t+o,f)})),p))){var v=p.loopTime-d;v<=0&&(v+=1),e._sendUserEvent(Object(Ae.a)(Object(Ae.a)({},p.evt),{},{timestamp:n.timeLoopNormToGlobal(t+o,f+v)}))}}}catch(m){u.e(m)}finally{u.f()}}},this.recStartedAt=null,this.draw=function(e,t,o){var a=n.opts,i=a.beats,s=a.radius,r=n.isActive,c=n.isDial,u=n.isMuted,l=n.isRecording;n.xx=t,n.yy=o,l?(null===n.recStartedAt&&(n.recStartedAt=n.headRec),e.fill(30).stroke(255,0,0).strokeWeight(4)):(n.recStartedAt=null,e.fill(30).stroke(0).strokeWeight(2)),e.circle(n.xx,n.yy,2*s+(l?2:0));for(var h=0;h<i;h++){var d=h%4===0,p=0===h;e.stroke(p?180:d?130:80),e.strokeWeight(p?3:d?2:1);var f=h/i;n.drawLine(e,s,f)}n.drawEvents(e),u&&(e.fill(30,150).noStroke(),e.circle(n.xx,n.yy,2*s));var v=n.headPlay,m=n.headRec;if(c||l){var y=Math.ceil(v*i)%i/i,b=Math.ceil(m*i)%i/i,w=100;if(c&&(e.fill(0,200,0,60).noStroke(),n.drawArc(e,s,y),w=140),e.fill(180,0,0,w).noStroke(),m!==v){var g=l?s:.7*s;l&&null!==n.recStartedAt?n.drawArc(e,g,m,n.recStartedAt):n.drawArc(e,g,b,v)}}if(!r&&u||(u?e.stroke(100).strokeWeight(3):e.stroke(0,200,0).strokeWeight(3),n.drawLine(e,s,v)),c||r){e.stroke(200,0,0).strokeWeight(4);var k=l?s:.7*s;n.drawLine(e,k,m)}},this.drawEvents=function(e){n.isDial||(n.drawControls(e),n.drawNotes(e))},this.drawControls=function(e){var t=n.opts.radius;if(n.needsRenderControls){n.needsRenderControls=!1,n.pgControls||(n.pgControls=e.createGraphics(100,100));var o=[n.xx,n.yy],a=o[0],i=o[1];n.xx=t,n.yy=t,n.renderControls(),n.xx=a,n.yy=i}n.pgControls&&e.image(n.pgControls,n.xx-t,n.yy-t)},this.drawNotes=function(e){var t=n.opts.radius;if(n.needsRenderNotes){n.needsRenderNotes=!1,n.pgNotes||(n.pgNotes=e.createGraphics(100,100));var o=[n.xx,n.yy],a=o[0],i=o[1];n.xx=t,n.yy=t,n.renderNotes(),n.xx=a,n.yy=i}n.pgNotes&&e.image(n.pgNotes,n.xx-t,n.yy-t),n.isRecording&&n._drawNotes(e,!0)},this.drawLine=function(e,t,o){var a=2*Math.PI*o,i=n.xx+(t-2)*Math.sin(a),s=n.yy-(t-2)*Math.cos(a);e.line(n.xx,n.yy,i,s)},this.drawArc=function(e,t,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=Math.PI*(2*o-.5),s=Math.PI*(2*a-.5);e.arc(n.xx,n.yy,2*t,2*t,s,i)},this.renderControls=function(){if(n.pgControls){var e=n.pgControls;e.clear();var t=n.groupByController(n.sortByLoopTime(n.controlEvents()));if(Object.keys(t).length){var o=n.opts.radius;for(var a in e.strokeWeight(2).noFill(),e.colorMode(e.HSL,1),t)for(var i=J(a),s=t[a].length,r=0;r<s;r++){var c=t[a][r],u=c.loopTime,l=c.evt,h=r===s-1?0:r+1,d=t[a][h].loopTime,p=l.midiEvent,f=p.kind,v=p.value,m=o*(.3+.65*("pitchbend"===f?v/2+.5:v));e.stroke(i.hue,i.sat,i.lgt),n.drawArc(e,m,d,u)}}}},this.renderNotes=function(){n.pgNotes&&(n.pgNotes.clear(),n._drawNotes(n.pgNotes))},this._drawNotes=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=12,a=n.opts.radius;e.strokeWeight(a/o).noFill(),e.colorMode(e.HSL,1);var s,r=Object(i.a)(n.attackEvents());try{for(r.s();!(s=r.n()).done;){var u=s.value,l=u.loopTime,h=u.evt,d=u.release,p=h.midiEvent,f=p.note,v=p.attack,m=n.headRec;if(d){if(t)continue;m=d.loopTime}var y=a*(.3+f%o*.7/o),b=f%12,w=c.includes(b)?.5+b/36:b/36,g=v?1-v:.5;g=1-g*g,e.stroke(w,g,.4),n.drawArc(e,y,m,l)}}catch(k){r.e(k)}finally{r.f()}e.colorMode(e.RGB,255)},this.timeGlobalToLoop=function(e){return(e-n.opts.sketch.downbeat)/n.loopLenMs()},this.timeGlobalToLoopNorm=function(e){var t=n.timeGlobalToLoop(e);return t-Math.floor(t)},this.timeLoopToGlobal=function(e){var t=n.opts.sketch,o=n.loopLenMs();return t.downbeat+e*o},this.timeLoopNormToGlobal=function(e,t){var o=n.loopLenMs();return n.timeLastLoopStartMs(e)+t*o},this.timeLastLoopStartMs=function(e){var t=n.opts.sketch,o=n.loopLenMs(),a=n.timeGlobalToLoop(e);return t.downbeat+Math.floor(a)*o},this.hitTest=function(e,t){var o=n.opts.radius;return!(e<n.xx-o||e>n.xx+o)&&!(t<n.yy-o||t>n.yy+o)},this.opts=t,t.id){if(this.id=t.id,this.load())return console.log("[Loop #ctor] Loaded loop ".concat(t.id," from local storage")),this.needsRenderControls=!0,void(this.needsRenderNotes=!0);console.error("[Loop #ctor] Failed to load loop ".concat(t.id," from local storage"))}else this.id=Object(Ce.a)();t.isDial?this.isDial=!0:this.isActive=!0},je=function e(t){var n=this;Object(s.a)(this,e),this.sketch=void 0,this.dial=void 0,this.loops=[],this.activeLoop=void 0,this.inputs={},this.recLock=!1,this.hidden=!1,this.hiddenDial=!1,this.saveLoopRefs=function(){var e=n.sketch.localStorage;e.setItem("activeLoop",n.activeLoop.id),e.setItem("loops",JSON.stringify(n.loops.map((function(e){return e.id}))))},this.load=function(){var e=n.sketch,t=e.localStorage,o=t.getItem("loops"),a={beats:8,radius:35,sketch:e},s=t.getItem("activeLoop"),r=null;if(o&&""!==o){var c,u=JSON.parse(o),l=Object(i.a)(u);try{for(l.s();!(c=l.n()).done;){var h=c.value,d=new Re(Object(Ae.a)({id:h},a));d.loaded&&(n.loops.push(d),h===s&&(r=d))}}catch(p){l.e(p)}finally{l.f()}}return r?(n.activeLoop=r,r):(n.activeLoop=new Re(a),n.loops.push(n.activeLoop),n.activeLoop)},this.update=function(){n.dial.update(),n.loops.forEach((function(e){return e.update()}))},this.draw=function(e){var t=n.activeLoop,o=n.didSetup,a=n.hidden,s=n.hiddenDial;a?o&&(n.inputs.loopLen.remove(),n.inputs.newLoopBtn.remove(),n.didSetup=!1):o||n.setupInputs(e);var r=n.inputs,c=r.loopLen,u=r.newLoopBtn,l=50,h=l+20,d=e.width-20;if(!a){t.isActive=!0,t.setRadius(l),t.isRecording=n.isRecording(e),d-=l+20,t.draw(e,d,h),e.fill(210).stroke(0).strokeWeight(1),e.textSize(14).textAlign(e.CENTER,e.TOP),e.text("Active loop: ".concat(c.value()," beats"),d,h+l+10),c.position(d-60,h+l+30);var p=Math.max(48,Math.floor(u.elt.offsetWidth/2));u.position(d-p,h+l+60),d-=l+20}if(s||(d-=(l=n.dial.opts.radius)+20,n.dial.draw(e,d,h),e.fill(210).stroke(0).strokeWeight(1),e.textSize(14).textAlign(e.CENTER,e.TOP),e.text("Metronome",d,h+l+10)),!a){var f=h=u.y+u.elt.offsetHeight+20;l=35,d=e.width-l-20;var v,m=Object(i.a)(n.inactiveLoops());try{for(m.s();!(v=m.n()).done;){var y=v.value;y.isActive=!1,y.setRadius(35),h+=l,y.draw(e,d,h),e.keyIsDown(16)&&(e.fill(50,150).noStroke(),e.circle(d,h,2*l),e.fill(200).textSize(12).textStyle(e.NORMAL).textAlign(e.CENTER,e.CENTER),e.text("Click to\ndelete",d,h)),(h+=l+20)>e.height-3*l&&(h=f,d-=2*l+20)}}catch(b){m.e(b)}finally{m.f()}}},this.didSetup=!1,this.setupInputs=function(e){n.didSetup=!0,n.inputs.loopLen=e.createSlider(1,64,n.activeLoop.opts.beats),n.inputs.newLoopBtn=e.createButton("Add new loop");var t=n.inputs,o=t.loopLen,a=t.newLoopBtn;o.size(120),o.input((function(){n.activeLoop.opts.beats=o.value(),n.activeLoop.save()})),a.mousePressed(n.addLoop)},this.dialBeats=function(e){return 4*Math.ceil((e+1)/4)},this.updateRecOffset=function(e){n.dial.opts.beats=n.dialBeats(e)},this.loopUserEvent=function(e){n.activeLoop.loopUserEvent(e)},this.clearAll=function(){n.loops.forEach((function(e){return e.clearAllEvents()}))},this.clearActiveLoop=function(){n.activeLoop.clearAllEvents()},this.updateClientId=function(e){n.loops.forEach((function(t){return t.updateClientId(e)}))},this.toggleActiveLoopMute=function(){var e=n.activeLoop;e.isMuted=!e.isMuted,e.save()},this.toggleHide=function(){return n.hidden=!n.hidden},this.toggleHideText=function(){return n.hidden?"Show Loops":"Hide Loops"},this.toggleHideDial=function(){return n.hiddenDial=!n.hiddenDial},this.toggleHideDialText=function(){return n.hiddenDial?"Show Metronome":"Hide Metronome"},this.stopRecording=function(){n.activeLoop.sanitizeEvents(),n.activeLoop.save()},this.addLoop=function(){n.activeLoop=new Re({beats:n.inputs.loopLen.value(),radius:50,sketch:n.sketch}),n.loops.push(n.activeLoop),n.saveLoopRefs()},this.inactiveLoops=function(){return n.loops.filter((function(e){return e!==n.activeLoop}))},this.mousePressed=function(e){var t,o=!1,a=Object(i.a)(n.inactiveLoops());try{var s=function(){var a=t.value;if(a.hitTest(e.mouseX,e.mouseY))return o=!0,e.keyIsDown(16)?(a.remove(),n.loops=n.loops.filter((function(e){return e!==a})),"break"):(n.inputs.loopLen.value(a.opts.beats),n.activeLoop.isActive=!1,n.activeLoop=a,a.isActive=!0,"break")};for(a.s();!(t=a.n()).done;){if("break"===s())break}}catch(r){a.e(r)}finally{a.f()}o&&n.saveLoopRefs()},this.keyPressed=function(e){8!==e.keyCode&&46!==e.keyCode||(e.keyIsDown(16)?n.clearAll():n.clearActiveLoop()),13!==e.keyCode&&3!==e.keyCode||(n.recLock=!n.recLock,n.recLock||n.stopRecording()),("m"===e.key&&e.keyIsDown(17)||"\\"===e.key||"|"===e.key)&&n.toggleActiveLoopMute()},this.keyReleased=function(e){16===e.keyCode&&n.stopRecording()},this.isRecording=function(e){return n.recLock||!!e&&e.keyIsDown(16)},this.sketch=t.sketch,this.dial=new Re({beats:this.dialBeats(t.recOffset),radius:50,sketch:t.sketch,isDial:!0}),this.activeLoop=this.load()},Te=function(e){Object(S.a)(n,e);var t=Object(I.a)(n);function n(){var e;Object(s.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).origin2D=new A,e.scale2D=1,e}return Object(O.a)(n,[{key:"draw",value:function(e){if(Le&&Le.shaderBlackHole&&Le.backbuffer){var t=Le.instruments.blackHole;e.shader(Le.shaderBlackHole),Le.shaderBlackHole.setUniform("backbuffer",Le.backbuffer),Le.shaderBlackHole.setUniform("size",[e.width,e.height]),Le.shaderBlackHole.setUniform("rotate",t.modwheel*Math.PI)}e.fill(0,0).noStroke(),Object(E.a)(Object(U.a)(n.prototype),"draw",this).call(this,e),e.resetShader()}}]),n}(N),Ne=function(){var e=function(){return Math.random()-.5};return new A(1e3*e(),31,1e3*e())};var Le=new function e(t){var n=this;Object(s.a)(this,e),this.width=0,this.height=0,this.started=!1,this.syncing=!0,this.instruments=void 0,this.ws=void 0,this.midi=void 0,this.audioKeys=void 0,this.pp=void 0,this.pg=void 0,this.backbuffer=void 0,this.cam=void 0,this.user={clientId:0,name:"",instrument:"dancer",inputDevice:"keyboard",offset:2},this.avatar=void 0,this.users=[],this.avatars=[],this.inputs=void 0,this.ground=new X({pos:new A(0,-1,0),scale:new A(1e3)}),this.engine3d=T,this.bgCol={hue:.5,sat:0,lgt:.2},this.loops=void 0,this.downbeat=0,this.transportStarted=!1,this._bpm=95,this._bpmNext=95,this.localStorage=void 0,this.blackHole=new Te,this.loadFromStorage=function(){var e=n.localStorage.getItem("user");return e&&""!==e?(n.user=JSON.parse(e),!0):(console.error("No stored user"),!1)},this.destroy=function(){n.ws.conn.close(888,"sketch destroyed")},this.timeGlobalToTone=function(e){var t=r.context.rawContext._nativeAudioContext.getOutputTimestamp(),o=t.contextTime,a=t.performanceTime;return o+(n.ws.clock.toLocal(e)-a)/1e3},this.timeToneToGlobal=function(e){var t=r.context.rawContext._nativeAudioContext.getOutputTimestamp(),o=t.contextTime,a=t.performanceTime+1e3*(e-o);return n.ws.clock.toGlobal(a)},this.setSize=function(e,t){n.width=e,n.height=t},this.shaderBlackHole=void 0,this.sketch=function(e){n.pp=e,e.pixelDensity(1),e.preload=function(){n.shaderBlackHole=e.loadShader("/shaders/simple.vert","/shaders/blackHole.frag")},e.setup=function(){return n.setup(e)},e.draw=function(){return n.draw(e)},e.mousePressed=function(){return n.mousePressed(e)},e.mouseReleased=function(){return n.mouseReleased(e)},e.keyPressed=function(){return n.keyPressed(e)},e.keyReleased=function(){return n.keyReleased(e)}},this.setup=function(e){console.log("[Sketch #setup] ".concat(n.width," x ").concat(n.height)),e.createCanvas(n.width,n.height),n.pg=e.createGraphics(n.width,n.height,"webgl"),n.pg.textureWrap(e.REPEAT);var t,o=(t=n.width,1<<31-Math.clz32(t));n.backbuffer=e.createGraphics(o,o,e.WEBGL),console.log("bbsize",o,n.backbuffer.width,n.backbuffer.height),n.cam=new me(n.pg._renderer,{distance:100}),n.cam.setDistanceMin(40),n.cam.setDistanceMax(3e3),n.cam.rotateX(-Math.PI/8),n.cam.attachMouseListeners(e._renderer),n.cam.setViewport([0,0,n.width,n.height]),n.cam.rotateZ(Math.PI),n.avatar.addFollowCam(n.cam),n.inputs.setup(e)},this.draw=function(e){n.inputs.sliders.update(e),n.loops.update(),T.update(),e.colorMode(e.HSL,1).background(n.bgCol.hue,n.bgCol.sat,n.bgCol.lgt,.2).colorMode(e.RGB,255);var t=n.pg;if(t){t.perspective(Math.PI/3,t.width/t.height,1,1e4),t.clear(),T.draw(t),e.image(t,0,0);var o=n.backbuffer;if(o){var a=o.width,i=o.height;o.image(t,-a/2,-i/2,a,i)}n.inputs.help||T.draw2D(e,t)}if(n.inputs.draw(e),n.loops.draw(e),!n.inputs.help){var s=!1;for(var r in n.instruments)if(!n.instruments[r].loaded()){s=!0;break}s?n.drawMessage(e,"Loading instruments..."):n.syncing&&n.drawMessage(e,"Syncing clock with server...")}},this.drawMessage=function(e,t){e.fill(200),e.strokeWeight(0),e.textSize(20),e.textAlign(e.CENTER,e.CENTER),e.textStyle(e.BOLDITALIC),e.text(t,e.width/2,e.height/2)},this.mousePressed=function(e){n.started||(n.started=!0,r.start(),console.log("[Sketch #mousePressed] Started Tone")),n.inputs.sliders.mousePressed(e)||n.loops.mousePressed(e)},this.mouseReleased=function(e){n.inputs.sliders.mouseReleased(e)},this.keyboardInputDisabled=function(){return n.inputs.isFocused()},this.keyPressed=function(e){n.keyboardInputDisabled()||(e.keyIsDown(27)?n.inputs.toggleHelp():(n.avatar.keyPressed(e),n.loops.keyPressed(e),n.audioKeys.keyPressedP5(e)))},this.keyReleased=function(e){n.keyboardInputDisabled()||(n.avatar.keyReleased(e),n.loops.keyReleased(e),n.audioKeys.keyReleasedP5(e))},this.updateUser=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(n.user=Object.assign(n.user,e),n.localStorage.setItem("user",JSON.stringify(n.user)),t&&n.sendUserUpdate(),e.instrument){var o=n.instruments[e.instrument];n.inputs.sliders=o.ctrls}},this.getUser=function(e){if(e===n.user.clientId)return n.user;var t,o=Object(i.a)(n.users);try{for(o.s();!(t=o.n()).done;){var a=t.value;if(e===a.clientId)return a}}catch(s){o.e(s)}finally{o.f()}return n.user},this.getAvatar=function(e){if(e===n.user.clientId)return n.avatar;var t,o=Object(i.a)(n.avatars);try{for(o.s();!(t=o.n()).done;){var a=t.value;if(e===a.user.clientId)return a}}catch(s){o.e(s)}finally{o.f()}return null},this.getAvatarSafe=function(e){var t=n.getAvatar(e);return t||(console.warn("[Sketch #getAvatarSafe] Can't find avatar for client",e),n.avatar)},this.sendUserUpdate=function(){var e=n.ws,t=e.conn;(0,e.ready)()?t.send(Object(l.p)(n.user)):console.warn("[Sketch #sendUserUpdate] Can't send user update, websocket connection is not open")},this.sendUserXform=function(e){var t=n.ws,o=t.conn;(0,t.ready)()?o.send(Object(l.q)(e)):console.warn("[Sketch #sendUserXform] Can't send user xform, websocket connection is not open")},this.sendUserRequestXforms=function(){var e=n.ws,t=e.conn;(0,e.ready)()?t.send(Object(l.o)()):console.warn("[Sketch #sendUserRequestXforms] Can't request other users' xforms, websocket connection is not open")},this.sendUserEvent=function(e,t,o){var a=n.user.instrument;if(o.controller)switch(o.controller.number){case 79:r.Destination.volume.value=50*(o.value-1);case 19:return void(r.Destination.mute=!o.value);case 117:return void(o.value&&(n.loops.recLock=!n.loops.recLock));case 18:case 78:a="metronome";break;case 17:case 77:a="synth";break;case 16:case 76:a="eightOhEight";break;case 15:case 75:a="piano"}var i=n.offsetMs(),s={clientId:n.user.clientId,instrument:a,midiEvent:o,timestamp:n.nowMs()+i};n.loops.isRecording(n.pp)&&n.loops.loopUserEvent(s),n._sendUserEvent(s)},this._sendUserEvent=function(e){var t=n.ws,o=t.conn;(0,t.ready)()?o.send(Object(l.n)(e)):n.onUserEvent(e)},this.onUserEvent=function(e){var t=e.clientId,o=e.instrument,a=e.midiEvent,i=e.timestamp,s=a.data,c=a.channel,u=a.kind,l=n.instruments[o];if(l){if(l.loaded()){var h="metronome"===o;if(!h||!n.syncing){var d=n.timeGlobalToTone(i);if(!(d<0))if(d-r.immediate()<-1)console.log("[Sketch #onUserEvent] Received event ".concat(r.immediate()-d," seconds late"));else{var p=n.getAvatarSafe(t);switch(u){case"noteon":var f=a;l.noteon(p,d,f),h&&n.onMetronome(d,f.note);break;case"noteoff":var v=a;l.noteoff(p,d,v);break;case"controlchange":var m=a;l.controlchange(p,d,m);break;case"pitchbend":var y=a;l.pitchbend(p,d,y);break;default:console.warn("[Sketch #onUserEvent] Unhandled MIDI event on channel ".concat(c,":"),u,s,e)}}}}}else console.error("[Sketch #onUserEvent] Unable to find instrument",o)},this.onMetronome=function(e,t){if(!n.transportStarted&&t===h.b)return console.log("[Sketch #onUserEvent] Downbeat synced with server. BPM:",n._bpmNext),n.transportStarted=!0,void n.setNewDownbeat(e);t===h.a&&(console.log("[Sketch #onUserEvent] Received new downbeat from server, will update clock in ".concat((e-r.immediate()).toFixed(1)," seconds")),r.Draw.schedule((function(){console.log("[Sketch #onUserEvent] BPM updated:",n._bpmNext),n.setNewDownbeat(e)}),e))},this.setNewDownbeat=function(e){n.downbeat=n.timeToneToGlobal(e),n._bpm=n._bpmNext,n.inputs.onClockUpdate({bpm:n._bpm,clientId:0}),r.Transport.bpm.value=n._bpm},this.onUsers=function(e){var t,o=Object(i.a)(e);try{var a=function(){var e=t.value;if(e.clientId===n.user.clientId)return"continue";var o=n.users.filter((function(t){return t.clientId===e.clientId}));if(!o.length)return n.users.push(e),n.avatars.push(new B({user:e,pos:Ne(),scale:new A(20),phys:{worldScale:1e3}})),"continue";o.length>1&&console.warn("[Sketch #onUsers] Found more than one user for clientId #".concat(e.clientId),e.clientId,e.name);var a=o[0];Object.assign(a,e)};for(o.s();!(t=o.n()).done;)a()}catch(u){o.e(u)}finally{o.f()}var s,r=Object(i.a)(n.users);try{var c=function(){var t=s.value;if(e.some((function(e){return e.clientId===t.clientId})))return"continue";var o=n.getAvatar(t.clientId);o?T.rmObj(o):console.warn("[Sketch #onUsers] Unable to find avatar for dropped user #".concat(t.clientId),t.name),n.users=n.users.filter((function(e){return e.clientId!==t.clientId})),n.avatars=n.avatars.filter((function(e){return e.user.clientId!==t.clientId}))};for(r.s();!(s=r.n()).done;)c()}catch(u){r.e(u)}finally{r.f()}},this.onUserForce=function(e){var t=e.clientId,o=n.getAvatar(t);o?o.setUserForce(e):console.warn("[Sketch #onUserForce] No avatar for user",t)},this.onUserXform=function(e){var t=e.clientId,o=n.getAvatar(t);o?o.setUserXform(e):console.warn("[Sketch #onUserXform] No avatar for user",t)},this.bpm=function(){return n.transportStarted?n._bpm:n.inputs.bpm()},this.bps=function(){return n.bpm()/60},this.beatMs=function(){return 1e3/n.bps()},this.beatSec=function(){return 1/n.bps()},this.offsetMs=function(){return n.beatMs()*n.user.offset},this.offsetSec=function(){return n.beatSec()*n.user.offset},this.nowMs=function(){return n.ws.now()},console.log("[Sketch #ctor]"),this.localStorage=t.localStorage;var o=this.loadFromStorage();this.inputs=new Oe(o),this.loops=new je({sketch:this,recOffset:this.user.offset}),this.avatar=new B({user:this.user,pos:Ne(),scale:new A(30),phys:{worldScale:1e3},onForce:this.sendUserXform}),this.ws=new p(window,{clock:{onSynced:function(){n.syncing=!1,n.transportStarted=!1,n.inputs.setupInputsBPM()}},onClientId:function(e){n.user.clientId=e,n.inputs.setupInputsUser(e),n.loops.updateClientId(e),n.sendUserUpdate(),n.sendUserXform(n.avatar.getUserXform()),n.sendUserRequestXforms()},onClockUpdate:function(e){0===e.clientId?n._bpmNext=e.bpm:n.inputs.onClockUpdate(e)},onUsers:this.onUsers,onUserEvent:this.onUserEvent,onUserForce:this.onUserForce,onUserXform:this.onUserXform,onUserRequestXforms:function(){return n.sendUserXform(n.avatar.getUserXform())}}),this.instruments={dancer:new ne,synth:new pe,blackHole:new ee,hoover:new se,eightOhEight:new ie(this),piano:new he,metronome:new ue(this)},this.midi=new k({onEnabled:this.inputs.setupInputsMidi,onMessage:this.sendUserEvent}),this.audioKeys=new Ie(this),window.Tone=r,window.me=this}(window),De=function(){var e=Object(o.useRef)(null),t=Object(o.useRef)("Loading");return Object(o.useEffect)((function(){if(!e.current)return t.current="Internal component error",void console.warn("[VideoOutput #useEffect] Can't find component reference");var n=e.current;n.childNodes[0]&&n.removeChild(n.childNodes[0]);var o=n.clientWidth,a=n.clientHeight;Le.setSize(o,a);var i=new window.p5(Le.sketch,n);return function(){Le.destroy(),i.remove(),console.log("[VideoOutput #useEffect.return]")}})),a.a.createElement("div",{ref:e,style:{display:"flex",flex:1,alignItems:"center",justifyContent:"center",color:"white"}},t.current)};n(736),t.default=function(){return a.a.createElement("div",{className:"App",style:{display:"flex",flexDirection:"column",position:"absolute",backgroundColor:"#383838",top:0,left:0,right:0,bottom:0}},a.a.createElement(De,null))}}},[[705,1,2]]]);
//# sourceMappingURL=main.89672102.chunk.js.map